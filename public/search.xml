<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>zabbix 5.0 Agent安装 for Centos</title>
      <link href="2020/09/21/zabbix-5-0-Agent%E5%AE%89%E8%A3%85-for-Centos/"/>
      <url>2020/09/21/zabbix-5-0-Agent%E5%AE%89%E8%A3%85-for-Centos/</url>
      
        <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>CentOS Linux release 7.8.2003 (Core)</p><h2 id="安装agent"><a href="#安装agent" class="headerlink" title="安装agent"></a>安装agent</h2><p>采用rpm包安装方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span></span><br><span class="line">Retrieving https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span><br><span class="line">warning: /var/tmp/rpm-tmp.GUTI2l: Header V4 RSA/SHA512 Signature, key ID a14fe591: NOKEY</span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:zabbix-release-5.0-1.el7         <span class="comment">################################# [100%]</span></span><br><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># yum clean all</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Cleaning repos: base epel extras updates zabbix zabbix-non-supported</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># yum install zabbix-agent -y</span></span><br></pre></td></tr></table></figure><p>安装完成查看下软件包生成的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># rpm -ql zabbix-agent</span></span><br><span class="line">/etc/logrotate.d/zabbix-agent</span><br><span class="line">/etc/zabbix/zabbix_agentd.conf</span><br><span class="line">/etc/zabbix/zabbix_agentd.d</span><br><span class="line">/usr/lib/systemd/system/zabbix-agent.service</span><br><span class="line">/usr/lib/tmpfiles.d/zabbix-agent.conf</span><br><span class="line">/usr/sbin/zabbix_agentd</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/AUTHORS</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/COPYING</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/ChangeLog</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/NEWS</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/README</span><br><span class="line">/usr/share/doc/zabbix-agent-5.0.3/userparameter_mysql.conf</span><br><span class="line">/usr/share/man/man8/zabbix_agentd.8.gz</span><br><span class="line">/var/<span class="built_in">log</span>/zabbix</span><br><span class="line">/var/run/zabbix</span><br></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>/etc/zabbix/zabbix_agentd.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid   <span class="comment">#pid文件</span></span><br><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_agentd.log。 <span class="comment">#log文件</span></span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=x.x.x.x                        <span class="comment">#zabbix server ip 地址</span></span><br><span class="line">ServerActive=x.x.x.x                  <span class="comment">#主动监控 server ip 地址</span></span><br><span class="line">Hostname=webserver.roddypy.com        <span class="comment">#自己能被server端识别的地址</span></span><br><span class="line">Include=/etc/zabbix/zabbix_agentd.d/*.conf  <span class="comment"># 扩展配置文件</span></span><br></pre></td></tr></table></figure><h2 id="启动agentd"><a href="#启动agentd" class="headerlink" title="启动agentd"></a>启动agentd</h2><p>启动agent并开启自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># systemctl  start zabbix-agent             </span></span><br><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment"># systemctl  enable zabbix-agent </span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.</span><br><span class="line">[root@iZ2zecgq3cou36re3sxh4bZ ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="添加主机并关联模版"><a href="#添加主机并关联模版" class="headerlink" title="添加主机并关联模版"></a>添加主机并关联模版</h2><img src="/img/1600669628015.jpg"><img src="/img/1600669637643.jpg"><p>等待1-5分钟即可正常监控</p><img src="/img/1600669685470.jpg"><p>如果出现如下状态需要检查配置或者防火墙，确认是否是ip地址填写错误还是防火墙没有允许10050端口</p><img src="/img/1600669970480.jpg"><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><ul><li>客户端允许服务器来访问10050端口</li><li>ip切记不要填写错误</li><li>需要选择关联组及监控模版，模版里有默认的监控指标及报警规则，这个可以自己修改。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Zabbix </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix 5.0 Agent安装 for Ubuntu</title>
      <link href="2020/09/18/zabbix-5-0-Agent%E5%AE%89%E8%A3%85-for-Ubuntu/"/>
      <url>2020/09/18/zabbix-5-0-Agent%E5%AE%89%E8%A3%85-for-Ubuntu/</url>
      
        <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>系统环境是Ubuntu 16.4，采用apt源的安装方式。安装时软件版本最好和Server的版本相匹配，同时如果是大批量的安装的话建议采用saltstack 或者批量脚本安装并设置自动发现。</p><p>需要开放10050 和10051端口访问，在客户端上需要允许服务器访问 10050</p><h2 id="安装Agent"><a href="#安装Agent" class="headerlink" title="安装Agent"></a>安装Agent</h2><p>添加agent源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># wget https://repo.zabbix.com/zabbix/5.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_5.0-1+xenial_all.deb</span></span><br><span class="line">[root@localhost ~]<span class="comment"># dpkg -i zabbix-release_5.0-1+xenial_all.deb</span></span><br><span class="line">[root@localhost ~]<span class="comment"># apt update</span></span><br></pre></td></tr></table></figure><p>安装agent</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># apt install zabbix-agent -y</span></span><br></pre></td></tr></table></figure><p>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</span><br><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_agentd.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=47.93.184.xx。      <span class="comment">#监控机地址</span></span><br><span class="line">ServerActive=47.93.184.xx   <span class="comment"># 填监控机地址  主动模式</span></span><br><span class="line">Hostname=47.105.47.xx    <span class="comment"># 被监控端hostname</span></span><br><span class="line">Include=/etc/zabbix/zabbix_agentd.d/*.conf</span><br></pre></td></tr></table></figure><p>设置开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#  systemctl restart zabbix-agent</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  systemctl enable zabbix-agent</span></span><br></pre></td></tr></table></figure><h2 id="手动添加被监控机"><a href="#手动添加被监控机" class="headerlink" title="手动添加被监控机"></a>手动添加被监控机</h2><p>1.在配置-主机添加一台被监控机</p><img src="/img/1600437080974.jpg"><p>2.添加时指定群组，并且设置一个监控模版<code>Template OS Linux by Zabbix agent</code></p><img src="/img/1600435660638.jpg"><p>3.添加后等几分钟查看状态<br><img src="/img/1600437415983.jpg"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://www.zabbix.com/cn/download?zabbix=5.0&amp;os_distribution=ubuntu&amp;os_version=16.04_xenial&amp;db=&amp;ws=" target="_blank" rel="noopener">https://www.zabbix.com/cn/download?zabbix=5.0&amp;os_distribution=ubuntu&amp;os_version=16.04_xenial&amp;db=&amp;ws=</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Zabbix </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 关闭文章评论方法</title>
      <link href="2020/09/18/Hexo-%E5%85%B3%E9%97%AD%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E6%96%B9%E6%B3%95/"/>
      <url>2020/09/18/Hexo-%E5%85%B3%E9%97%AD%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo关闭文章评论"><a href="#Hexo关闭文章评论" class="headerlink" title="Hexo关闭文章评论"></a>Hexo关闭文章评论</h2><p>这里不单单可以对某篇文章关闭，也可以关闭某个页面。比如分类、标签、关于等。升级next主题后，我加了valine评论系统，默认情况下所有页面都可以评论，但是有些页面不想开评论咋办呢。</p><p>经我亲测以下方法可行，目前我的环境是hexo+next+valine评论插件</p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>以分类页面为例source/categories/index.md</p><p>添加：comments: false</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2020</span><span class="number">-04</span><span class="number">-22</span> <span class="number">15</span><span class="string">:40:45</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://hexo.io/zh-cn/docs/front-matter" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/front-matter</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix 5.0 详细安装步骤</title>
      <link href="2020/09/18/zabbix-5-0-%E8%AF%A6%E7%BB%86%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/"/>
      <url>2020/09/18/zabbix-5-0-%E8%AF%A6%E7%BB%86%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h2><p>老牌监控系统，自我运维生涯开始用过nagios、icinga、cacti(仙人掌)、zabbix。唯有zabbix在中小规模监控环境中值得推荐，无论是安装，配置，还是报警、绘图。结合第三方报警也好，适配性都特别好。<br>目前还可以集合grafana作图形可视化，中小型企业运维监控软件首选zabbix。如果有能力二次开发或者有兴趣也可以研究下小米开源的open-falcon、滴滴改进的Nightingale、Talkingdata开源的OWL等</p><p>5.0版本貌似最近才更新没多久，我们部署起来看看有啥变化没，话说回来。从2.0到3.0确实好看了不少，今天看看5.0长啥样，话不多说，开干！</p><p>5.0新功能参考 <code>https://www.zabbix.com/cn/whats_new_5_0</code></p><h2 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h2><p>准备环境</p><ul><li>Centos 7.8</li><li>PHP 7.2 +</li><li>Apache 1.3.12 +</li><li>Mysql or MariaDB 5.7+</li></ul><p>具体要求参考一下链接 <a href="https://www.zabbix.com/documentation/current/manual/installation/requirements" target="_blank" rel="noopener">https://www.zabbix.com/documentation/current/manual/installation/requirements</a></p><p>硬件条件参考下表<br><img src="/img/1600416626703.jpg"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl disable --now firewalld</span></span><br><span class="line">[root@localhost ~]<span class="comment"># iptables -L -n</span></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="安装zabbix源"><a href="#安装zabbix源" class="headerlink" title="安装zabbix源"></a>安装zabbix源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span></span><br><span class="line">Retrieving https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span><br><span class="line">warning: /var/tmp/rpm-tmp.vw5pXe: Header V4 RSA/SHA512 Signature, key ID a14fe591: NOKEY</span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:zabbix-release-5.0-1.el7         <span class="comment">################################# [100%]</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Cleaning repos: base epel extras updates zabbix zabbix-non-supported</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="安装server和agnet"><a href="#安装server和agnet" class="headerlink" title="安装server和agnet"></a>安装server和agnet</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y install zabbix-server-mysql zabbix-agent</span></span><br></pre></td></tr></table></figure><p>因某些不能说的原因安装可能会出现如下情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-server-mysql-5.0.3-1.el7.x86_64.rpm: [Errno 14] curl<span class="comment">#18 - "transfer closed with 1461988 bytes remaining to read"</span></span><br><span class="line">Trying other mirror.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error downloading packages:</span><br><span class="line">  zabbix-server-mysql-5.0.3-1.el7.x86_64: [Errno 256] No more mirrors to try.</span><br></pre></td></tr></table></figure><p>换成阿里源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Cleaning repos: base epel extras updates zabbix zabbix-non-supported</span><br><span class="line">Cleaning up list of fastest mirrors</span><br></pre></td></tr></table></figure><p><strong>再次执行安装</strong></p><h3 id="安装前端组建"><a href="#安装前端组建" class="headerlink" title="安装前端组建"></a>安装前端组建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install centos-release-scl -y</span></span><br></pre></td></tr></table></figure><p>启用zabbix前端源,编辑配置文件 /etc/yum.repos.d/zabbix.repo 修改enabled为1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[zabbix-frontend]</span><br><span class="line">name=Zabbix Official Repository frontend - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/<span class="variable">$basearch</span>/frontend</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591</span><br></pre></td></tr></table></figure><p>软件包安装，包括httpd  php web组件等</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y </span></span><br><span class="line">...</span><br><span class="line">Installing:</span><br><span class="line"> zabbix-apache-conf-scl                        noarch                       5.0.3-1.el7                                  zabbix-frontend                        13 k</span><br><span class="line"> zabbix-web-mysql-scl                          noarch                       5.0.3-1.el7                                  zabbix-frontend                        12 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> apr                                           x86_64                       1.4.8-5.el7                                  base                                  103 k</span><br><span class="line"> apr-util                                      x86_64                       1.5.2-6.el7                                  base                                   92 k</span><br><span class="line"> audit-libs-python                             x86_64                       2.8.5-4.el7                                  base                                   76 k</span><br><span class="line"> checkpolicy                                   x86_64                       2.5-8.el7                                    base                                  295 k</span><br><span class="line"> dejavu-fonts-common                           noarch                       2.33-6.el7                                   base                                   64 k</span><br><span class="line"> dejavu-sans-fonts                             noarch                       2.33-6.el7                                   base                                  1.4 M</span><br><span class="line"> fontpackages-filesystem                       noarch                       1.44-8.el7                                   base                                  9.9 k</span><br><span class="line"> httpd                                         x86_64                       2.4.6-93.el7.centos                          base                                  2.7 M</span><br><span class="line"> httpd-tools                                   x86_64                       2.4.6-93.el7.centos                          base                                   92 k</span><br><span class="line"> libX11                                        x86_64                       1.6.7-2.el7                                  base                                  607 k</span><br><span class="line"> libX11-common                                 noarch                       1.6.7-2.el7                                  base                                  164 k</span><br><span class="line"> libXau                                        x86_64                       1.0.8-2.1.el7                                base                                   29 k</span><br><span class="line"> libXpm                                        x86_64                       3.5.12-1.el7                                 base                                   55 k</span><br><span class="line"> libcgroup                                     x86_64                       0.41-21.el7                                  base                                   66 k</span><br><span class="line"> libjpeg-turbo                                 x86_64                       1.2.90-8.el7                                 base                                  135 k</span><br><span class="line"> libsemanage-python                            x86_64                       2.5-14.el7                                   base                                  113 k</span><br><span class="line"> libwebp                                       x86_64                       0.3.0-7.el7                                  base                                  170 k</span><br><span class="line"> libxcb                                        x86_64                       1.13-1.el7                                   base                                  214 k</span><br><span class="line"> libxslt                                       x86_64                       1.1.28-5.el7                                 base                                  242 k</span><br><span class="line"> mailcap                                       noarch                       2.1.41-2.el7                                 base                                   31 k</span><br><span class="line"> policycoreutils-python                        x86_64                       2.5-34.el7                                   base                                  457 k</span><br><span class="line"> python-IPy                                    noarch                       0.75-6.el7                                   base                                   32 k</span><br><span class="line"> rh-php72                                      x86_64                       1-2.el7                                      centos-sclo-rh                        4.3 k</span><br><span class="line"> rh-php72-php-bcmath                           x86_64                       7.2.24-1.el7                                 centos-sclo-rh                         60 k</span><br><span class="line"> rh-php72-php-cli                              x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        2.9 M</span><br><span class="line"> rh-php72-php-common                           x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        680 k</span><br><span class="line"> rh-php72-php-fpm                              x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        1.5 M</span><br><span class="line"> rh-php72-php-gd                               x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        151 k</span><br><span class="line"> rh-php72-php-json                             x86_64                       7.2.24-1.el7                                 centos-sclo-rh                         54 k</span><br><span class="line"> rh-php72-php-ldap                             x86_64                       7.2.24-1.el7                                 centos-sclo-rh                         59 k</span><br><span class="line"> rh-php72-php-mbstring                         x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        553 k</span><br><span class="line"> rh-php72-php-mysqlnd                          x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        166 k</span><br><span class="line"> rh-php72-php-pdo                              x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        101 k</span><br><span class="line"> rh-php72-php-pear                             noarch                       1:1.10.5-1.el7                               centos-sclo-rh                        357 k</span><br><span class="line"> rh-php72-php-process                          x86_64                       7.2.24-1.el7                                 centos-sclo-rh                         62 k</span><br><span class="line"> rh-php72-php-xml                              x86_64                       7.2.24-1.el7                                 centos-sclo-rh                        160 k</span><br><span class="line"> rh-php72-php-zip                              x86_64                       7.2.24-1.el7                                 centos-sclo-rh                         90 k</span><br><span class="line"> rh-php72-runtime                              x86_64                       1-2.el7                                      centos-sclo-rh                        1.1 M</span><br><span class="line"> scl-utils                                     x86_64                       20130529-19.el7                              base                                   24 k</span><br><span class="line"> setools-libs                                  x86_64                       3.3.8-4.el7                                  base                                  620 k</span><br><span class="line"> zabbix-web                                    noarch                       5.0.3-1.el7                                  zabbix-frontend                       3.1 M</span><br><span class="line"> zabbix-web-deps-scl                           noarch                       5.0.3-1.el7                                  zabbix-frontend                        13 k</span><br></pre></td></tr></table></figure><h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><p>安装并设置开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install mariadb-server -y</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable --now mariadb</span></span><br></pre></td></tr></table></figure><p>初始化数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql_secure_installation</span></span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to <span class="built_in">log</span> into MariaDB to secure it, we<span class="string">'ll need the current</span></span><br><span class="line"><span class="string">password for the root user.  If you'</span>ve just installed MariaDB, and</span><br><span class="line">you haven<span class="string">'t set the root password yet, the password will be blank,</span></span><br><span class="line"><span class="string">so you should just press enter here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter current password for root (enter for none):   #回车，默认没有密码</span></span><br><span class="line"><span class="string">OK, successfully used password, moving on...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class="line"><span class="string">root user without the proper authorisation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Set root password? [Y/n] y。#是否设置密码</span></span><br><span class="line"><span class="string">New password:               #新密码</span></span><br><span class="line"><span class="string">Re-enter new password:      #新密码确认</span></span><br><span class="line"><span class="string">Password updated successfully!</span></span><br><span class="line"><span class="string">Reloading privilege tables..</span></span><br><span class="line"><span class="string"> ... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class="line"><span class="string">to log into MariaDB without having to have a user account created for</span></span><br><span class="line"><span class="string">them.  This is intended only for testing, and to make the installation</span></span><br><span class="line"><span class="string">go a bit smoother.  You should remove them before moving into a</span></span><br><span class="line"><span class="string">production environment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Remove anonymous users? [Y/n]   #移除匿名用户</span></span><br><span class="line"><span class="string"> ... skipping.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Normally, root should only be allowed to connect from '</span>localhost<span class="string">'.  This</span></span><br><span class="line"><span class="string">ensures that someone cannot guess at the root password from the network.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disallow root login remotely? [Y/n] n    #使用禁用root远程连接</span></span><br><span class="line"><span class="string"> ... skipping.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, MariaDB comes with a database named '</span><span class="built_in">test</span><span class="string">' that anyone can</span></span><br><span class="line"><span class="string">access.  This is also intended only for testing, and should be removed</span></span><br><span class="line"><span class="string">before moving into a production environment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Remove test database and access to it? [Y/n] y #删除测试数据库</span></span><br><span class="line"><span class="string"> - Dropping test database...</span></span><br><span class="line"><span class="string"> ... Success!</span></span><br><span class="line"><span class="string"> - Removing privileges on test database...</span></span><br><span class="line"><span class="string"> ... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class="line"><span class="string">will take effect immediately.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reload privilege tables now? [Y/n] y  #刷新权限</span></span><br><span class="line"><span class="string"> ... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Cleaning up...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">All done!  If you'</span>ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks <span class="keyword">for</span> using MariaDB!</span><br></pre></td></tr></table></figure><p>创建zabbix所需要的数据库及用户并设置密码 zabbix123</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql -u root -p</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 9</span><br><span class="line">Server version: 5.5.65-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; </span><br><span class="line">MariaDB [(none)]&gt; </span><br><span class="line">MariaDB [(none)]&gt; </span><br><span class="line">MariaDB [(none)]&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create user zabbix@localhost identified by <span class="string">'zabbix123'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><p>导入初始数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span></span><br><span class="line">Enter password: </span><br><span class="line">[root@localhost ~]<span class="comment"># mysql -u root -p  #检查是否导入成功</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 12</span><br><span class="line">Server version: 5.5.65-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use zabbix</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [zabbix]&gt; show tables;</span><br><span class="line">+----------------------------+</span><br><span class="line">| Tables_in_zabbix           |</span><br><span class="line">+----------------------------+</span><br><span class="line">| acknowledges               |</span><br><span class="line">| actions                    |</span><br><span class="line">| alerts                     |</span><br><span class="line">| application_discovery      |</span><br><span class="line">| application_prototype      |</span><br><span class="line">| application_template       |</span><br><span class="line">| applications               |</span><br><span class="line">| auditlog                   |</span><br><span class="line">.......</span><br></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>配置数据库密码 /etc/zabbix/zabbix_server.conf </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBPassword=zabbix123</span><br></pre></td></tr></table></figure><p>修改php时区  /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf,修改成Asia/Shanghai 并且去掉前面的注释</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">php_value[date.timezone]</span> = Asia/Shanghai</span><br></pre></td></tr></table></figure><p>设置开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm</span></span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>登录系统<a href="http://x.x.x.x/zabbix" target="_blank" rel="noopener">http://x.x.x.x/zabbix</a></p><p>开始初始化<br><img src="/img/1600419038695.jpg"><br>检查环境<br><img src="/img/1600419068929.jpg"><br>配置数据库<br><img src="/img/1600419133833.jpg"><br>确认server详情<br><img src="/img/1600419153092.jpg"><br>安装确认<br><img src="/img/1600419182133.jpg"><br>安装完成<br><img src="/img/1600419201537.jpg"><br>登录系统账户密码 Admin ,默认密码zabbix<br><img src="/img/1600419231022.jpg"></p><p>系统页面，默认是英文，可以在个人中心切换语言<br><img src="/img/1600419266571.jpg"></p><img src="/img/1600419566546.jpg"><img src="/img/1600419641529.jpg"><h2 id="zabbix-乱码问题"><a href="#zabbix-乱码问题" class="headerlink" title="zabbix 乱码问题"></a>zabbix 乱码问题</h2><p>将Win10操作系统C:\Windows\Fonts目录下的任意字体 上传字体文件到fonts目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fonts]<span class="comment"># pwd</span></span><br><span class="line">/usr/share/zabbix/assets/fonts</span><br><span class="line">[root@localhost fonts]<span class="comment"># ll</span></span><br><span class="line">total 11512</span><br><span class="line">lrwxrwxrwx 1 root root       33 Sep 18 16:34 graphfont.ttf -&gt; /etc/alternatives/zabbix-web-font</span><br><span class="line">-r-xr-xr-x 1 root root 11787328 Sep 18 17:05 simkai.ttf</span><br><span class="line">[root@localhost fonts]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>编辑配置文件 /usr/share/zabbix/include/defines.inc.php </p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">81</span> <span class="class"><span class="keyword">define</span></span>(<span class="string">'ZBX_GRAPH_FONT_NAME'</span>,           <span class="string">'simkai'</span>); <span class="comment">// font file name</span></span><br><span class="line"> <span class="number">122</span> <span class="class"><span class="keyword">define</span></span>(<span class="string">'ZBX_FONT_NAME'</span>, <span class="string">'simkai'</span>);</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">重启</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>bash</span><br><span class="line"><span class="meta">[</span>root@localhost fonts<span class="meta">]</span># systemctl restart zabbix-server</span><br></pre></td></tr></table></figure><img src="/img/1600420851802.jpg"><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://www.zabbix.com/cn/download?zabbix=5.0&amp;os_distribution=centos&amp;os_version=7&amp;db=mysql&amp;ws=apache" target="_blank" rel="noopener">https://www.zabbix.com/cn/download?zabbix=5.0&amp;os_distribution=centos&amp;os_version=7&amp;db=mysql&amp;ws=apache</a></li><li><a href="https://www.zabbix.com/documentation/current/manual/quickstart/login" target="_blank" rel="noopener">https://www.zabbix.com/documentation/current/manual/quickstart/login</a></li><li><a href="https://www.cnblogs.com/wei-lu/p/10220025.html" target="_blank" rel="noopener">https://www.cnblogs.com/wei-lu/p/10220025.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Zabbix </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vim编辑器:wq和:x区别</title>
      <link href="2020/09/14/vim%E7%BC%96%E8%BE%91%E5%99%A8-wq%E5%92%8C-x%E5%8C%BA%E5%88%AB/"/>
      <url>2020/09/14/vim%E7%BC%96%E8%BE%91%E5%99%A8-wq%E5%92%8C-x%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h2 id="两者区别"><a href="#两者区别" class="headerlink" title="两者区别"></a>两者区别</h2><p><code>&quot;:x&quot;</code> 和 <code>&quot;:wq&quot;</code> 的区别如下：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>) :wq 强制性写入文件并退出（存盘并退出 write <span class="keyword">and</span> quite）。即使文件没有被修改也强制写入，并更新文件的修改时间。</span><br><span class="line">(<span class="number">2</span>) :x 写入文件并退出。仅当文件被修改时才写入，并更新文件修改时间；否则不会更新文件修改时间。</span><br></pre></td></tr></table></figure><p>尽量习惯性用<code>:x</code> 避免在没有修改时也更新文件</p><p>参考：</p><ul><li><a href="https://www.cnblogs.com/andreking/p/5793782.html" target="_blank" rel="noopener">https://www.cnblogs.com/andreking/p/5793782.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关闭SELINUX</title>
      <link href="2020/09/10/%E5%85%B3%E9%97%ADSELINUX/"/>
      <url>2020/09/10/%E5%85%B3%E9%97%ADSELINUX/</url>
      
        <content type="html"><![CDATA[<h2 id="查看Selinux状态"><a href="#查看Selinux状态" class="headerlink" title="查看Selinux状态"></a>查看Selinux状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getenforce</span><br><span class="line">Enforcing        //enforceing代表开启，</span><br><span class="line">Permissive      // permissive代表警告</span><br><span class="line">Disabled        //disabled代表关闭</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h2 id="关闭selinux-临时关闭重启失效"><a href="#关闭selinux-临时关闭重启失效" class="headerlink" title="关闭selinux(临时关闭重启失效)"></a>关闭selinux(临时关闭重启失效)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# setenforce 0   //开始 设置数字1</span><br></pre></td></tr></table></figure><h2 id="关闭selinux-永久"><a href="#关闭selinux-永久" class="headerlink" title="关闭selinux(永久)"></a>关闭selinux(永久)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> selinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 常用命令集</title>
      <link href="2020/08/28/docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%9B%86/"/>
      <url>2020/08/28/docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h2 id="容器管理"><a href="#容器管理" class="headerlink" title="容器管理"></a>容器管理</h2><p><strong>列出容器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  ps</span><br></pre></td></tr></table></figure><p>-a  all  所有容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  ps  -a</span><br></pre></td></tr></table></figure><p><strong>列出最近一次启动的容器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  ps -l</span><br></pre></td></tr></table></figure><p><strong>检索容器</strong></p><p>兼容name 为test的容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a --filter name=<span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><strong>停止容器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  stop  runginx</span><br></pre></td></tr></table></figure><p><strong>启动容器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  start runginx</span><br></pre></td></tr></table></figure><p><strong>重启容器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  restart runginx</span><br></pre></td></tr></table></figure><p><strong>进入容器</strong><br>通常用于在运行的容器中执行命令，也可以开启交互式终端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  <span class="built_in">exec</span> -it runginx /bin/bash</span><br></pre></td></tr></table></figure><p>执行脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  <span class="built_in">exec</span> -it runginx /bin/sh /tmp/run.sh</span><br></pre></td></tr></table></figure><p><strong>获取容器日志</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  logs runginx</span><br></pre></td></tr></table></figure><p>实时日志输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  logs -f runginx</span><br></pre></td></tr></table></figure><p><strong>查看容器详细信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  inspect &lt;id or name&gt;</span><br></pre></td></tr></table></figure><p><strong>查看容器进程信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  top &lt;id or name&gt;</span><br></pre></td></tr></table></figure><p><strong>列出容器端口映射</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker port &lt;id or name&gt;</span><br><span class="line">5000/tcp -&gt; 0.0.0.0:32768</span><br></pre></td></tr></table></figure><h2 id="镜像相关"><a href="#镜像相关" class="headerlink" title="镜像相关"></a>镜像相关</h2><p><strong>列出镜像</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  -a, --all             Show all images (default hides intermediate images)</span><br><span class="line">      --digests         Show digests</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print images using a Go template</span><br><span class="line">      --no-trunc        Don<span class="string">'t truncate output</span></span><br><span class="line"><span class="string">  -q, --quiet           Only show numeric IDs</span></span><br></pre></td></tr></table></figure><p><strong>删除镜像</strong></p><p>-f 强制删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi nginx:latest</span><br></pre></td></tr></table></figure><p><strong>构建镜像</strong></p><p>需要编写Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t nginx:v2 .</span><br></pre></td></tr></table></figure><p><strong>导出镜像</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker  save -o nginx.tar nginx:latest</span><br></pre></td></tr></table></figure><p><strong>导入镜像</strong></p><p>–input,-i 指定导入文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker load -i nginx.tar</span><br></pre></td></tr></table></figure><p><strong>修改镜像tag</strong></p><p>将<code>nginx:v1</code>修改成<code>roddy/nginx:v1</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag  nginx:v1 roddy/nginx:v1</span><br></pre></td></tr></table></figure><p><strong>查看镜像详细信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect &lt;image&gt;</span><br></pre></td></tr></table></figure><h2 id="仓库相关"><a href="#仓库相关" class="headerlink" title="仓库相关"></a>仓库相关</h2><p><strong>登录registry</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker login x.x.x.x</span><br></pre></td></tr></table></figure><p><strong>退出</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">logout</span></span><br></pre></td></tr></table></figure><p><strong>下载(pull)/拉取镜像</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull  nginx:latest</span><br></pre></td></tr></table></figure><p><strong>上传(push)/推送镜像</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker push  roddyhub.com/roddy/nginx:latest</span><br></pre></td></tr></table></figure><p><strong>搜索(search)镜像</strong></p><p>默认从dockerhub检索</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker serach  nginx</span><br></pre></td></tr></table></figure><h2 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h2><p><strong>查看网络</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network  ls</span><br></pre></td></tr></table></figure><p><strong>创建自定义网络</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create &lt;net_name&gt;</span><br></pre></td></tr></table></figure><p><strong>查看容器的IP地址</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect -f <span class="string">'&#123;&#123; .NetworkSettings.IPAddress &#125;&#125; &lt;id or name&gt;</span></span><br></pre></td></tr></table></figure><p><strong>查看宿主机网卡信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ip a show docker0</span><br></pre></td></tr></table></figure><h2 id="docker相关"><a href="#docker相关" class="headerlink" title="docker相关"></a>docker相关</h2><p><strong>查看docker系统信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker info</span><br></pre></td></tr></table></figure><p><strong>查看docker版本</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 容器间互联</title>
      <link href="2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/"/>
      <url>2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/</url>
      
        <content type="html"><![CDATA[<h2 id="Docker容器互联"><a href="#Docker容器互联" class="headerlink" title="Docker容器互联"></a>Docker容器互联</h2><p>常见使用方式为。–link参数 （后面会被废弃）<br>参考出处：- <a href="https://docs.docker.com/network/links/" target="_blank" rel="noopener">https://docs.docker.com/network/links/</a></p><p>Warning: The –link flag is a legacy feature of Docker. It may eventually be removed. Unless you absolutely need to continue using it, we recommend that you use user-defined networks to facilitate communication between two containers instead of using –link. One feature that user-defined networks do not support that you can do with –link is sharing environment variables between containers. However, you can use other mechanisms such as volumes to share environment variables between containers in a more controlled way.</p><h2 id="样例："><a href="#样例：" class="headerlink" title="样例："></a>样例：</h2><p><strong>启动容器1</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># docker run -dit -p 80:80 --name selfnginx nginx</span></span><br><span class="line">Unable to find image <span class="string">'nginx:latest'</span> locally</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">bf5952930446: Pull complete </span><br><span class="line">cb9a6de05e5a: Pull complete </span><br><span class="line">9513ea0afb93: Pull complete </span><br><span class="line">b49ea07d2e93: Pull complete </span><br><span class="line">a5e4a503d449: Pull complete </span><br><span class="line">Digest: sha256:b0ad43f7ee5edbc0effbc14645ae7055e21bc1973aee5150745632a24a752661</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">2cfcbd9bb76cfe8445c74e8d9cd8ae39f1fab1850242978cb059b15b527beb98</span><br></pre></td></tr></table></figure><p><strong>启动容器2</strong></p><p><em>–link 目标容器:映射的别名</em></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit --link selfnginx:web  alpine</span><br><span class="line">Unable to find image <span class="string">'alpine:latest'</span> locally</span><br><span class="line">latest: Pulling <span class="keyword">from</span> library/alpine</span><br><span class="line">df20fa9351a1: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">185518070891758909</span>c9f839cf4ca393ee977ac378609f700f60a771a2dfe321</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> alpine:latest</span><br><span class="line">f6f87a55368d38781f6d10ef27bd31acf7b05b62c38b283f55a1e7723489d4bf</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# </span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# </span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker ps  <span class="comment">//检查启动的容器</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                <span class="number">7</span> seconds ago       Up <span class="number">6</span> seconds                             elastic_yalow</span><br><span class="line"><span class="number">2</span>cfcbd9bb76c        nginx               <span class="string">"/docker-entrypoint.…"</span>   <span class="number">2</span> minutes ago       Up <span class="number">2</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">80</span>-&gt;<span class="number">80</span>/tcp   selfnginx</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><p>安装curl</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker exec -it f6f  sh    <span class="comment">//进入容器</span></span><br><span class="line">/ # </span><br><span class="line">/ # </span><br><span class="line">/ # apk add curl    <span class="comment">// 安装curl工具</span></span><br><span class="line">fetch http:<span class="comment">//dl-cdn.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz</span></span><br><span class="line">fetch http:<span class="comment">//dl-cdn.alpinelinux.org/alpine/v3.12/community/x86_64/APKINDEX.tar.gz</span></span><br><span class="line">(<span class="number">1</span>/<span class="number">4</span>) Installing ca-certificates (<span class="number">20191127</span>-r4)</span><br><span class="line">(<span class="number">2</span>/<span class="number">4</span>) Installing nghttp2-libs (<span class="number">1.41</span><span class="number">.0</span>-r0)</span><br><span class="line">(<span class="number">3</span>/<span class="number">4</span>) Installing libcurl (<span class="number">7.69</span><span class="number">.1</span>-r0)</span><br><span class="line">(<span class="number">4</span>/<span class="number">4</span>) Installing curl (<span class="number">7.69</span><span class="number">.1</span>-r0)</span><br><span class="line">Executing busybox<span class="number">-1.31</span><span class="number">.1</span>-r16.trigger</span><br><span class="line">Executing ca-certificates<span class="number">-20191127</span>-r4.trigger</span><br><span class="line">OK: <span class="number">7</span> MiB <span class="keyword">in</span> <span class="number">18</span> packages</span><br></pre></td></tr></table></figure><p>ping 测试。ping web // web表示–link 容器使用的别名</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/ #<span class="built_in"> ping </span>web</span><br><span class="line">PING web (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.067 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.066 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.064 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.066 ms</span><br><span class="line">^C</span><br><span class="line">--- web<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.064/0.065/0.067 ms</span><br></pre></td></tr></table></figure><p>curl 测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/ # curl web</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/"</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.com/"</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">/ #</span><br></pre></td></tr></table></figure><p>–link 连接会在/etc/hosts文件中添加关系映射</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/ # cat /etc/hosts </span><br><span class="line"><span class="number">127.0.0.1</span>       localhost</span><br><span class="line">::<span class="number">1</span>     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span> ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span> ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span> ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span> ip6-allrouters</span><br><span class="line"><span class="number">172.17.0.2</span>      web 2cfcbd9bb76c selfnginx</span><br><span class="line"><span class="number">172.17.0.3</span>      f6f87a55368d</span><br></pre></td></tr></table></figure><h2 id="容器互联-自定义网络）"><a href="#容器互联-自定义网络）" class="headerlink" title="容器互联 (自定义网络）"></a>容器互联 (自定义网络）</h2><ul><li>用户定义的网桥可在容器之间提供自动DNS解析。<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">缺省桥接网络上的容器只能通过<span class="built_in">IP</span>地址相互访问，除非您使用被认为是传统的--link选项。在用户定义的网桥网络上，容器可以通过名称或别名相互解析。</span><br><span class="line"></span><br><span class="line">想象一个具有Web前端和数据库后端的应用程序。如果调用容器web和<span class="built_in">db</span>，则<span class="built_in">db</span>无论应用程序堆栈在哪个Docker主机上运行，Web容器都可以通过连接到<span class="built_in">db</span>容器。</span><br><span class="line"></span><br><span class="line">如果在默认网桥网络上运行相同的应用程序堆栈，则需要在容器之间手动创建链接（使用旧式--link 标志）。这些链接需要双向创建，因此您可以看到，要进行通信的容器超过两个，这将变得很复杂。或者，您可以操作/etc/hosts容器中的文件，但这会产生难以调试的问题。</span><br></pre></td></tr></table></figure></li><li>用户定义的桥可提供更好的隔离。<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">所有未<span class="comment">--network指定的容器都将连接到默认网桥网络。这可能是一种风险，因为不相关的堆栈/服务/容器随后能够进行通信。</span></span><br><span class="line"></span><br><span class="line">使用用户定义的网络可提供作用域网络，其中只有连接到该网络的容器才能通信。</span><br></pre></td></tr></table></figure></li><li>容器可以随时随地从用户定义的网络连接和分离。<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在容器的生存期内，您可以即时将其与用户定义的网络连接或断开连接。要从默认桥接网络中删除容器，您需要停止容器并使用其他网络选项重新创建它。</span><br><span class="line"></span><br><span class="line">每个用户定义的网络都会创建一个可配置的网桥。</span><br><span class="line"></span><br><span class="line">如果您的容器使用默认的桥接网络，则可以对其进行配置，但是所有容器都使用相同的设置，例如MTU和iptables规则。另外，配置默认桥接网络发生在Docker本身之外，并且需要重新启动Docker。</span><br><span class="line"></span><br><span class="line">用户定义的桥接网络是使用创建和配置的 docker<span class="built_in"> network </span>create。如果不同的应用程序组具有不同的网络要求，则可以在创建时分别配置每个用户定义的网桥。</span><br></pre></td></tr></table></figure></li><li>默认网桥网络上的链接容器共享环境变量。<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">最初，在两个容器之间共享环境变量的唯一方法是使用<span class="comment">--linkflag链接它们。用户定义的网络无法进行这种类型的变量共享。但是，存在共享环境变量的高级方法。一些想法：</span></span><br><span class="line"></span><br><span class="line">多个容器可以使用Docker卷挂载包含共享信息的文件或目录。</span><br><span class="line"></span><br><span class="line">可以使用一起启动多个容器docker-compose，并且compose文件可以定义共享变量。</span><br><span class="line"></span><br><span class="line">您可以使用群体服务来代替独立容器，并利用共享机密和 配置。</span><br></pre></td></tr></table></figure></li></ul><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>创建自定义网络</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># docker network create my-net</span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># docker network ls    //列出当前所有网络</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">cd68d9fe5349        bridge              bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">995338</span>bf73a4        harbor_harbor       bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">683</span>eaf141ac7        host                host                <span class="keyword">local</span></span><br><span class="line"><span class="number">244</span>fc6228c1a        my-net              bridge              <span class="keyword">local</span></span><br><span class="line">c5dd972001d9        none                <span class="literal">null</span>                <span class="keyword">local</span></span><br></pre></td></tr></table></figure><p>创建容器并连接到自定义网络中</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit -p <span class="number">8000</span>:<span class="number">80</span> --name netnginx  --network my-net nginx</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit --name testping --network my-net alpine</span><br></pre></td></tr></table></figure><p>检查启动容器</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                <span class="number">4</span> minutes ago       Up <span class="number">4</span> minutes                               testping</span><br><span class="line"><span class="number">6f</span>0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   <span class="number">6</span> minutes ago       Up <span class="number">6</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span>-&gt;<span class="number">80</span>/tcp   netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                <span class="number">32</span> minutes ago      Up <span class="number">32</span> minutes                              elastic_yalow</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure><p>容器只要连接到同一个网络中，那会自动</p><h3 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h3><p>将已经运行的容器连接到自定义网络</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>connect my-net elastic_yalow</span><br></pre></td></tr></table></figure><p>参看容器详情发现会有两个网络</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">"Networks": &#123;</span><br><span class="line">    "bridge": &#123;</span><br><span class="line">        "IPAMConfig": null,</span><br><span class="line">        "Links": null,</span><br><span class="line">        "Aliases": null,</span><br><span class="line">        "NetworkID": "cd68d9fe5349d9962d48e78d1f8d2e2c4e36a7a038104bd2fa9bca7ea1526c66",</span><br><span class="line">        "EndpointID": "865d76e5ea4a11abe73110c6d6c22f65f014c36c4bdd2a478b8ae422464fc912",</span><br><span class="line">        "Gateway": "172.17.0.1",</span><br><span class="line">        "IPAddress": "172.17.0.3",</span><br><span class="line">        "IPPrefixLen": 16,</span><br><span class="line">        "IPv6Gateway": "",</span><br><span class="line">        "GlobalIPv6Address": "",</span><br><span class="line">        "GlobalIPv6PrefixLen": 0,</span><br><span class="line">        "MacAddress": "02:42:ac:11:00:03",</span><br><span class="line">        "DriverOpts": null</span><br><span class="line">    &#125;,</span><br><span class="line">    "my-net": &#123;</span><br><span class="line">        "IPAMConfig": &#123;&#125;,</span><br><span class="line">        "Links": null,</span><br><span class="line">        "Aliases": [</span><br><span class="line">            <span class="string">"f6f87a55368d"</span></span><br><span class="line">        ],</span><br><span class="line">        "NetworkID": "244fc6228c1adddd45eecac66c7e0652171ddf293750c03ea3ff53946098da4a",</span><br><span class="line">        "EndpointID": "6ebff1aa65af5ed4b0172164b4dd101934e6d73cc6381886f23f88ed0d453377",</span><br><span class="line">        "Gateway": "172.20.0.1",</span><br><span class="line">        "IPAddress": "172.20.0.4",</span><br><span class="line">        "IPPrefixLen": 16,</span><br><span class="line">        "IPv6Gateway": "",</span><br><span class="line">        "GlobalIPv6Address": "",</span><br><span class="line">        "GlobalIPv6PrefixLen": 0,</span><br><span class="line">        "MacAddress": "02:42:ac:14:00:04",</span><br><span class="line">        "DriverOpts": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>断开容器网络</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>disconnect my-net elastic_yalow</span><br></pre></td></tr></table></figure><p><strong><em>如果断开只有一个网络的容器会发生什么？</em></strong></p><p>创建netnginx指定了使用自定义网络，如果断开他唯一的网络后，那该容器会是一个没有网卡状态。同时容器暴露的端口将会被取消，直到重新加入网络后恢复。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>disconnect my-net netnginx</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                17 minutes ago      Up 17 minutes                           testping</span><br><span class="line">6f0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   18 minutes ago      Up 18 minutes                           netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                44 minutes ago      Up 44 minutes                           elastic_yalow</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>connect my-net netnginx</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                17 minutes ago      Up 17 minutes                              testping</span><br><span class="line">6f0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   18 minutes ago      Up 18 minutes       0.0.0.0:8000-&gt;80/tcp   netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                45 minutes ago      Up 45 minutes                              elastic_yalow</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://docs.docker.com/network/bridge/#differences-between-user-defined-bridges-and-the-default-bridge" target="_blank" rel="noopener">https://docs.docker.com/network/bridge/#differences-between-user-defined-bridges-and-the-default-bridge</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Harbor私有仓库部署</title>
      <link href="2020/08/20/Harbor%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/"/>
      <url>2020/08/20/Harbor%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h2 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h2><p>Harbor(港口)是一个开放源代码注册中心，Harbor是CNCF项目，VMware公司开源。用于构建企业级私有docker镜像的仓库的开源解决方案，它是Docker Registry的更高级封装，它除了提供友好的Web UI界面。</p><h2 id="安装Harbor"><a href="#安装Harbor" class="headerlink" title="安装Harbor"></a>安装Harbor</h2><h3 id="安装条件"><a href="#安装条件" class="headerlink" title="安装条件"></a>安装条件</h3><ul><li><a href="https://goharbor.io/docs/2.0.0/install-config/installation-prereqs/" target="_blank" rel="noopener">https://goharbor.io/docs/2.0.0/install-config/installation-prereqs/</a></li></ul><p><strong>Resource    Minimum    Recommended</strong><br>CPU        2 CPU    4 CPU<br>Mem        4 GB    8 GB<br>Disk    40 GB    160 GB</p><p><strong>Software    Version    Description</strong><br>Docker engine    Version 17.06.0-ce+ or higher    For installation instructions, see Docker Engine documentation<br>Docker Compose    Version 1.18.0 or higher    For installation instructions, see Docker Compose documentation<br>Openssl    Latest is preferred    Used to generate certificate and keys for Harbor</p><h3 id="1-配置环境"><a href="#1-配置环境" class="headerlink" title="1.配置环境"></a>1.配置环境</h3><p>安装docker-ce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># yum update</span></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># yum -y install wget curl yum-utils </span></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #添加阿里源</span></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># yum update docker-ce docker-compose</span></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># systemctl start docker</span></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># systemctl enable docker</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>检查docker版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.12</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.10</span><br><span class="line"> Git commit:        48a66213fe</span><br><span class="line"> Built:             Mon Jun 22 15:46:54 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.12</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.10</span><br><span class="line">  Git commit:       48a66213fe</span><br><span class="line">  Built:            Mon Jun 22 15:45:28 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.13</span><br><span class="line">  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br></pre></td></tr></table></figure><p>检查docker-compose版本</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker-compose version</span><br><span class="line">docker-compose version <span class="number">1.18</span><span class="number">.0</span>, build <span class="number">8</span>dd22a9</span><br><span class="line">docker-py version: <span class="number">2.6</span><span class="number">.1</span></span><br><span class="line">CPython version: <span class="number">3.6</span><span class="number">.8</span></span><br><span class="line">OpenSSL version: OpenSSL <span class="number">1.0</span><span class="number">.2</span>k-fips  <span class="number">26</span> Jan <span class="number">2017</span></span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure><h3 id="2-下载Harbor"><a href="#2-下载Harbor" class="headerlink" title="2.下载Harbor"></a>2.下载Harbor</h3><p>两种安装方式</p><ul><li>在线</li><li>离线安装包</li></ul><p><strong>下载离线包（需要加速，或者可续上网。我是下载后上传到服务器）</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># wget https://github.com/goharbor/harbor/releases/download/v2.0.2/harbor-offline-installer-v2.0.2.tgz</span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># tar xf harbor-offline-installer-latest.tgz </span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># cd harbor</span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> harbor]<span class="meta"># ls</span></span><br><span class="line">common.sh  harbor.v2<span class="number">.0</span><span class="number">.2</span>.tar.gz  harbor.yml.tmpl  install.sh  LICENSE  prepare</span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> harbor]<span class="meta"># </span></span><br><span class="line"><span class="meta"># 复制模版文件</span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> harbor]<span class="meta"># cp harbor.yml.tmpl  harbor.yml</span></span><br></pre></td></tr></table></figure><p>目录结构</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="selector-tag">common</span><span class="selector-class">.sh</span></span><br><span class="line">├── <span class="selector-tag">harbor</span><span class="selector-class">.v2</span><span class="selector-class">.0</span><span class="selector-class">.2</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">├── <span class="selector-tag">harbor</span><span class="selector-class">.yml</span></span><br><span class="line">├── <span class="selector-tag">harbor</span><span class="selector-class">.yml</span><span class="selector-class">.tmpl</span></span><br><span class="line">├── <span class="selector-tag">install</span><span class="selector-class">.sh</span></span><br><span class="line">├── <span class="selector-tag">LICENSE</span></span><br><span class="line">└── <span class="selector-tag">prepare</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">hostname: <span class="number">101.200</span><span class="number">.233</span><span class="number">.146</span>   <span class="comment"># 修改hostname为客户的可以访问的ip或者域名</span></span><br><span class="line">http:</span><br><span class="line">  port: <span class="number">80</span>                  <span class="comment"># 默认端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https related config      # 没有证书可以屏蔽掉</span></span><br><span class="line"><span class="comment">#https:</span></span><br><span class="line"><span class="comment">#  # https port for harbor, default is 443</span></span><br><span class="line"><span class="comment">#  port: 443</span></span><br><span class="line"><span class="comment">#  # The path of cert and key files for nginx</span></span><br><span class="line"><span class="comment">#  certificate: /your/certificate/path</span></span><br><span class="line"><span class="comment">#  private_key: /your/private/key/path</span></span><br><span class="line"></span><br><span class="line">harbor_admin_password: Harbor12345</span><br><span class="line">database:                            <span class="comment"># 数据库密码</span></span><br><span class="line">  password: root123</span><br><span class="line">  max_idle_conns: <span class="number">50</span></span><br><span class="line">  max_open_conns: <span class="number">1000</span></span><br><span class="line">data_volume: /data</span><br><span class="line">clair:</span><br><span class="line">  updaters_interval: <span class="number">12</span></span><br><span class="line">trivy:</span><br><span class="line">  ignore_unfixed: false</span><br><span class="line">  skip_update: false</span><br><span class="line">  insecure: false</span><br><span class="line">jobservice:</span><br><span class="line">  max_job_workers: <span class="number">10</span></span><br><span class="line">notification:</span><br><span class="line">  webhook_job_max_retry: <span class="number">10</span></span><br><span class="line">chart:</span><br><span class="line">  absolute_url: disabled</span><br><span class="line">log:</span><br><span class="line">  level: info</span><br><span class="line">  local:</span><br><span class="line">    rotate_count: <span class="number">50</span></span><br><span class="line">    rotate_size: <span class="number">200</span>M</span><br><span class="line">    location: /var/log/harbor</span><br><span class="line">_version: <span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">proxy:</span><br><span class="line">  http_proxy:</span><br><span class="line">  https_proxy:</span><br><span class="line">  no_proxy:</span><br><span class="line">  components:</span><br><span class="line">    - core</span><br><span class="line">    - jobservice</span><br><span class="line">    - clair</span><br><span class="line">    - trivy</span><br></pre></td></tr></table></figure><h3 id="3-执行安装"><a href="#3-执行安装" class="headerlink" title="3.执行安装"></a>3.执行安装</h3><p>准备安装包，然后安装</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ harbor]# ./prepare </span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ harbor]# ./install.sh</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Creating harbor-log <span class="built_in">..</span>. done</span><br><span class="line">Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Creating registry <span class="built_in">..</span>. done</span><br><span class="line">Creating harbor-core <span class="built_in">..</span>. done</span><br><span class="line">Creating<span class="built_in"> network </span><span class="string">"harbor_harbor"</span> with the<span class="built_in"> default </span>driver</span><br><span class="line">Creating nginx <span class="built_in">..</span>. done</span><br><span class="line">Creating harbor-db <span class="built_in">..</span>. </span><br><span class="line">Creating registry <span class="built_in">..</span>. </span><br><span class="line">Creating harbor-portal <span class="built_in">..</span>. </span><br><span class="line">Creating redis <span class="built_in">..</span>. </span><br><span class="line">Creating registryctl <span class="built_in">..</span>. </span><br><span class="line">Creating harbor-core <span class="built_in">..</span>. </span><br><span class="line">Creating harbor-jobservice <span class="built_in">..</span>. </span><br><span class="line">Creating nginx <span class="built_in">..</span>. </span><br><span class="line">✔ ----Harbor has been installed <span class="keyword">and</span> started successfully.----</span><br></pre></td></tr></table></figure><h2 id="配置Harbor"><a href="#配置Harbor" class="headerlink" title="配置Harbor"></a>配置Harbor</h2><p>1.访问Harbor</p><p><a href="http://x.x.x.x" target="_blank" rel="noopener">http://x.x.x.x</a> 默认账户是admin  密码 Harbor12345</p><img src="/img/1597915746822.jpg"><p>2.登录系统。默认支持6种语言<br><img src="/img/1597915928435.jpg"></p><p>3.支持2种主题,在左下角切换<br><img src="/img/1597916065835.jpg"></p><p>4.创建项目(不等于仓库)</p><img src="/img/1597916196096.jpg"><p>-1 表示不设置容量限制，同时在右上角能看到当前系统所占用的容量仪表</p><p>公开 表示任何人可以访问</p><p>5.推送镜像<br><img src="/img/1597916379157.jpg"></p><p>6.创建用户<br><img src="/img/1597916479211.jpg"></p><p>7.添加项目人员<br><img src="/img/1597917052999.jpg"><br>4种角色</p><p>8.登录系统后开始推送</p><p>修改客户端docker配置</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@iZm5e7rjmq1tkuwoy8h8vuZ</span><span class="symbol">:~</span><span class="comment"># vim /etc/docker/daemon.json </span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [<span class="string">"https://docker.mirrors.ustc.edu.cn/"</span>],</span><br><span class="line">     <span class="string">"insecure-registries"</span><span class="symbol">:</span>[<span class="string">"101.200.233.146"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">重启</span><br><span class="line">root<span class="variable">@iZm5e7rjmq1tkuwoy8h8vuZ</span><span class="symbol">:~</span><span class="comment"># systemctl  restart docker</span></span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">root@</span>iZm5e7rjmq1tkuwoy8h8vuZ:~# docker login <span class="number">101.200</span><span class="number">.233</span><span class="number">.146</span></span><br><span class="line">Username: roddy</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove <span class="keyword">this</span> warning. See</span><br><span class="line">https:<span class="comment">//docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="symbol">root@</span>iZm5e7rjmq1tkuwoy8h8vuZ:~# docker tag busybox <span class="number">101.200</span><span class="number">.233</span><span class="number">.146</span>/yunwei/busybox</span><br><span class="line"><span class="symbol">root@</span>iZm5e7rjmq1tkuwoy8h8vuZ:~# docker push <span class="number">101.200</span><span class="number">.233</span><span class="number">.146</span>/yunwei/busybox</span><br><span class="line">The push <span class="built_in">ref</span>ers to repository [<span class="number">101.200</span><span class="number">.233</span><span class="number">.146</span>/yunwei/busybox]</span><br><span class="line"><span class="number">514</span>c3a3e64d4: Pushed </span><br><span class="line">latest: digest: sha256:<span class="number">400</span>ee2ed939df769d4681023810d2e4fb9479b8401d97003c710d0e20f7c49c6 size: <span class="number">527</span></span><br></pre></td></tr></table></figure><p>9.推送完成检查</p><img src="/img/1597917486336.jpg"><p>10.关闭harbor</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ harbor]# docker-compose stop</span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> harbor-jobservice ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> nginx             ... done</span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> harbor-core       ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> registryctl       ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> registry          ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> redis             ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> harbor-portal     ... done</span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> harbor-db         ... </span><br><span class="line"><span class="function"><span class="title">Stopping</span></span> harbor-<span class="built-in">log</span>        ...</span><br></pre></td></tr></table></figure><h2 id="Harbor权限"><a href="#Harbor权限" class="headerlink" title="Harbor权限"></a>Harbor权限</h2><p>官方网站对权限有解释</p><ul><li><a href="https://goharbor.io/docs/2.0.0/administration/managing-users/user-permissions-by-role/" target="_blank" rel="noopener">https://goharbor.io/docs/2.0.0/administration/managing-users/user-permissions-by-role/</a></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ActionLimited GuestGuestDeveloperMasterProject Admin</span><br><span class="line">See the project configurations✓✓✓✓✓</span><br><span class="line">Edit the project configurations✓</span><br><span class="line">See a list of project members✓✓✓✓</span><br><span class="line"><span class="keyword">Create</span>/edit/<span class="keyword">delete</span> <span class="keyword">project</span> members✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">project</span> <span class="keyword">logs</span>✓✓✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">project</span> replications✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">project</span> <span class="keyword">replication</span> jobs✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">project</span> labels✓✓</span><br><span class="line"><span class="keyword">Create</span>/edit/<span class="keyword">delete</span> <span class="keyword">project</span> labels✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> repositories✓✓✓✓✓</span><br><span class="line"><span class="keyword">Create</span> repositories✓✓✓</span><br><span class="line">Edit/<span class="keyword">delete</span> repositories✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> images✓✓✓✓✓</span><br><span class="line">Retag image✓✓✓✓</span><br><span class="line">Pull image✓✓✓✓✓</span><br><span class="line">Push image✓✓✓</span><br><span class="line"><span class="keyword">Scan</span>/<span class="keyword">delete</span> image✓✓</span><br><span class="line"><span class="keyword">Add</span> scanners <span class="keyword">to</span> Harbor</span><br><span class="line">Edit scanners <span class="keyword">in</span> projects✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> image vulnerabilities✓✓✓✓✓</span><br><span class="line">See image <span class="keyword">build</span> history✓✓✓✓✓</span><br><span class="line"><span class="keyword">Add</span>/Remove labels <span class="keyword">of</span> image✓✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> helm charts✓✓✓✓✓</span><br><span class="line">Download helm charts✓✓✓✓✓</span><br><span class="line">Upload helm charts✓✓✓</span><br><span class="line"><span class="keyword">Delete</span> helm charts✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> helm chart <span class="keyword">versions</span>✓✓✓✓✓</span><br><span class="line">Download helm chart <span class="keyword">versions</span>✓✓✓✓✓</span><br><span class="line">Upload helm chart <span class="keyword">versions</span>✓✓✓</span><br><span class="line"><span class="keyword">Delete</span> helm chart <span class="keyword">versions</span>✓✓</span><br><span class="line"><span class="keyword">Add</span>/Remove labels <span class="keyword">of</span> helm chart <span class="keyword">version</span>✓✓✓</span><br><span class="line">See a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">project</span> robots✓✓</span><br><span class="line"><span class="keyword">Create</span>/edit/<span class="keyword">delete</span> <span class="keyword">project</span> robots✓</span><br><span class="line">See configured CVE whitelist✓✓✓✓✓</span><br><span class="line"><span class="keyword">Create</span>/edit/remove CVE whitelist✓</span><br><span class="line"><span class="keyword">Enable</span>/<span class="keyword">disable</span> webhooks✓✓✓</span><br><span class="line"><span class="keyword">Create</span>/<span class="keyword">delete</span> tag <span class="keyword">retention</span> <span class="keyword">rules</span>✓✓✓</span><br><span class="line"><span class="keyword">Enable</span>/<span class="keyword">disable</span> tag <span class="keyword">retention</span> <span class="keyword">rules</span>✓✓✓</span><br><span class="line"><span class="keyword">Create</span>/<span class="keyword">delete</span> tag immutability <span class="keyword">rules</span>✓</span><br><span class="line"><span class="keyword">Enable</span>/<span class="keyword">disable</span> tag immutability <span class="keyword">rules</span>✓</span><br><span class="line">See <span class="keyword">project</span> quotas✓✓✓✓✓</span><br><span class="line">Edit <span class="keyword">project</span> quotas *</span><br></pre></td></tr></table></figure><h2 id="参考网站"><a href="#参考网站" class="headerlink" title="参考网站"></a>参考网站</h2><ul><li><a href="https://goharbor.io/docs/2.0.0/install-config/" target="_blank" rel="noopener">https://goharbor.io/docs/2.0.0/install-config/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> harbor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建docker私有Registry</title>
      <link href="2020/08/19/%E6%9E%84%E5%BB%BAdocker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/"/>
      <url>2020/08/19/%E6%9E%84%E5%BB%BAdocker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h2 id="Registry分类"><a href="#Registry分类" class="headerlink" title="Registry分类"></a>Registry分类</h2><ul><li>Sponsor Registry: 第三方registry,供客户和社区使用</li><li>Mirror Registry: 第三方registry,只让用户使用</li><li>Vendor Registry: 由发布镜像的供应商提供的registry</li><li>Private Registry: 通过设有防火期和额外安全层（ssl）的私有registry</li></ul><h2 id="为什么需要私有Registry"><a href="#为什么需要私有Registry" class="headerlink" title="为什么需要私有Registry"></a>为什么需要私有Registry</h2><p>一般部署在本地自建（使用内网），如果使用阿里云直接使用阿里的registry就可以。</p><ul><li>托管镜像</li><li>占用带宽低</li><li>下载速度快</li><li>快速部署</li></ul><h2 id="安装docker-registry"><a href="#安装docker-registry" class="headerlink" title="安装docker-registry"></a>安装docker-registry</h2><p>ubuntu 16.04 安装registry 使用apt-get install docker-registry即可.安装完镜像存储目录为。<strong>/var/lib/docker-registry</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># apt-get install docker-registry</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">The following packages were automatically installed and are no longer required:</span><br><span class="line">  libopts25 python-meld3 python-pkg-resources</span><br><span class="line">Use <span class="string">'apt autoremove'</span> to remove them.</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  docker-registry</span><br><span class="line">0 upgraded, 1 newly installed, 0 to remove and 205 not upgraded.</span><br><span class="line">Need to get 2,694 kB of archives.</span><br><span class="line">After this operation, 12.6 MB of additional disk space will be used.</span><br><span class="line">Get:1 http://mirrors.cloud.aliyuncs.com/ubuntu xenial/universe amd64 docker-registry amd64 2.3.0~ds1-1 [2,694 kB]</span><br><span class="line">Fetched 2,694 kB <span class="keyword">in</span> 0s (8,438 kB/s)       </span><br><span class="line">Selecting previously unselected package docker-registry.</span><br><span class="line">(Reading database ... 103689 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../docker-registry_2.3.0~ds1-1_amd64.deb ...</span><br><span class="line">Unpacking docker-registry (2.3.0~ds1-1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> systemd (229-4ubuntu21.16) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> ureadahead (0.100.0-19) ...</span><br><span class="line">Setting up docker-registry (2.3.0~ds1-1) ...</span><br><span class="line">Adding system user `docker-registry<span class="string">' (UID 113) ...</span></span><br><span class="line"><span class="string">Adding new group `docker-registry'</span> (GID 122) ...</span><br><span class="line">Adding new user `docker-registry<span class="string">' (UID 113) with group `docker-registry'</span> ...</span><br><span class="line">Not creating home directory `/var/lib/docker-registry<span class="string">'.</span></span><br><span class="line"><span class="string">Processing triggers for systemd (229-4ubuntu21.16) ...</span></span><br><span class="line"><span class="string">Processing triggers for ureadahead (0.100.0-19) ...</span></span><br></pre></td></tr></table></figure><p>检查启动端口 5000</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># netstat -nlpt</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      27873/nginx -g daem</span><br><span class="line">tcp        0      0 127.0.0.1:8222          0.0.0.0:*               LISTEN      8466/python3    </span><br><span class="line">tcp6       0      0 :::5000                 :::*                    LISTEN      32026/docker-regist</span><br><span class="line">tcp6       0      0 :::8335                 :::*                    LISTEN      17406/docker-proxy</span><br><span class="line">tcp6       0      0 :::8336                 :::*                    LISTEN      17989/docker-proxy</span><br></pre></td></tr></table></figure><p>修改客户端镜像tag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker tag nginxtest 120.27.0.222:5000/nginxtest:1.0.0</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;                        &lt;none&gt;              5b5cf5c2be8f        23 hours ago        249MB</span><br><span class="line">120.27.0.222:5000/nginxtest   1.0.0               1c26cc9ad467        24 hours ago        249MB</span><br><span class="line">nginxtest                     latest              1c26cc9ad467        24 hours ago        249MB</span><br></pre></td></tr></table></figure><p>推送镜像</p><p>无法推送到私有registry，提示我们需要https，不过可以修改docker 配置文件加上insecure-registries</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker push 120.27.0.222:5000/nginxtest:1.0.0</span><br><span class="line">The push refers to repository [120.27.0.222:5000/nginxtest]</span><br><span class="line">Get https://120.27.0.222:5000/v2/: http: server gave HTTP response to HTTPS client</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><p>配置参考:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"experimental"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">    <span class="string">"http://hub-mirror.c.163.com"</span>,</span><br><span class="line">    <span class="string">"https://docker.mirrors.ustc.edu.cn"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"insecure-registries"</span>:[<span class="string">"120.27.0.222:5000"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改后重启客户端docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~/dockerfile_build/httpd$ docker push 120.27.0.222:5000/nginxtest:1.0.0</span><br><span class="line">The push refers to repository [120.27.0.222:5000/nginxtest]</span><br><span class="line">291f6e44771a: Pushed </span><br><span class="line">1.0.0: digest: sha256:fc4a234b91cc4b542bac8a6ad23b2ddcee60ae68fc4dbd4a52efb5f1b0baad71 size: 529</span><br></pre></td></tr></table></figure><p>上传成功后看目录结构，会存放到v2目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/docker-registry/</span><br><span class="line">└── docker</span><br><span class="line">    └── registry</span><br><span class="line">        └── v2</span><br><span class="line">            ├── blobs</span><br><span class="line">            │   └── sha256</span><br><span class="line">            │       ├── 0d</span><br><span class="line">            │       │   └── 0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566</span><br><span class="line">            │       │       └── data</span><br><span class="line">            │       ├── 3c</span><br><span class="line">            │       │   └── 3c72a8ed68140139e483fe7368ae4d9651422749e91483557cbd5ecf99a96110</span><br><span class="line">            │       │       └── data</span><br><span class="line">            │       └── <span class="built_in">fc</span></span><br><span class="line">            │           └── fc4a234b91cc4b542bac8a6ad23b2ddcee60ae68fc4dbd4a52efb5f1b0baad71</span><br><span class="line">            │               └── data</span><br><span class="line">            └── repositories</span><br><span class="line">                └── nginxtest</span><br><span class="line">                    ├── _layers</span><br><span class="line">                    │   └── sha256</span><br><span class="line">                    │       ├── 0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566</span><br><span class="line">                    │       │   └── link</span><br><span class="line">                    │       └── 3c72a8ed68140139e483fe7368ae4d9651422749e91483557cbd5ecf99a96110</span><br><span class="line">                    │           └── link</span><br><span class="line">                    ├── _manifests</span><br><span class="line">                    │   ├── revisions</span><br><span class="line">                    │   │   └── sha256</span><br><span class="line">                    │   │       └── fc4a234b91cc4b542bac8a6ad23b2ddcee60ae68fc4dbd4a52efb5f1b0baad71</span><br><span class="line">                    │   │           └── link</span><br><span class="line">                    │   └── tags</span><br><span class="line">                    │       └── 1.0.0</span><br><span class="line">                    │           ├── current</span><br><span class="line">                    │           │   └── link</span><br><span class="line">                    │           └── index</span><br><span class="line">                    │               └── sha256</span><br><span class="line">                    │                   └── fc4a234b91cc4b542bac8a6ad23b2ddcee60ae68fc4dbd4a52efb5f1b0baad71</span><br><span class="line">                    │                       └── link</span><br><span class="line">                    └── _uploads</span><br></pre></td></tr></table></figure><h2 id="使用容器安装"><a href="#使用容器安装" class="headerlink" title="使用容器安装"></a>使用容器安装</h2><p>因registry本身就是一个容器，默认情况下，会将私有仓库存放于容器内的/var/lib/registry目录下，这样如果容器被删除，则存放于容器中的镜像也会丢失。</p><p>下载registry镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker pull registry       </span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">cbdbe7a5bc2a: Pull complete </span><br><span class="line">47112e65547d: Pull complete </span><br><span class="line">46bcb632e506: Pull complete </span><br><span class="line">c1cc712bcecd: Pull complete </span><br><span class="line">3db6272dcbfa: Pull complete </span><br><span class="line">Digest: sha256:8be26f81ffea54106bae012c6f349df70f4d5e7e2ec01b143c46e2c03b9e551d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> registry:latest</span><br><span class="line">docker.io/library/registry:latest</span><br></pre></td></tr></table></figure><p>启动registry容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker run -dit -p 5000:5000 --restart=always --name Myregistry -v /root/registry:/var/lib/registry registry </span></span><br><span class="line">d65c75db0954348d5d06a896c04c5e935606e023a1a260b62959600e0165d146</span><br><span class="line">droot@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">d65c75db0954        registry            <span class="string">"/entrypoint.sh /etc…"</span>   3 seconds ago       Up 2 seconds        0.0.0.0:5000-&gt;5000/tcp    Myregistry</span><br></pre></td></tr></table></figure><p>推送镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~/dockerfile_build/httpd$ docker push 120.27.0.222:5000/nginxtest:1.0.0</span><br><span class="line">The push refers to repository [120.27.0.222:5000/nginxtest]</span><br><span class="line">291f6e44771a: Pushed </span><br><span class="line">1.0.0: digest: sha256:fc4a234b91cc4b542bac8a6ad23b2ddcee60ae68fc4dbd4a52efb5f1b0baad71 size: 529</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DockerFile 构建镜像(一)</title>
      <link href="2020/08/17/DockerFile-%E4%BD%BF%E7%94%A8/"/>
      <url>2020/08/17/DockerFile-%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>从docker 官方下载的基础镜像有时候无法满足我们自己本身的业务需求，特别是配置文件，环境变量。这个时候通常需要自制我们自己的镜像。</p><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>Dokerfile是用来制作docker镜像的一个文本文件，并包含了构建镜像所需要的的指令及其参数。dockerfile 第一个非注释行必须是from,必须指明基础镜像。<br>Dockerfile其内部包含了一条条的指令，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。    </p><h2 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h2><p>两类：</p><ul><li>指令</li><li>指令参数</li></ul><p>注意点：</p><ul><li>必须要有专用的工作目录</li><li>首字母必须大写</li><li>引用目录必须是在当前工作目录之下</li></ul><p>参考样例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基于centos镜像</span></span><br><span class="line">FROM centos  <span class="comment">#可以跟版本，如果不加默认是latest。FROM centos:latest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#维护人的信息</span></span><br><span class="line">MAINTAINER The CentOS Project &lt;923401910@qq.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装httpd软件包</span></span><br><span class="line">RUN yum -y update</span><br><span class="line">RUN yum -y install httpd</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启80端口</span></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"><span class="comment">#复制网站首页文件至镜像中web站点下 index.html 必须要在当前目录存在</span></span><br><span class="line">COPY index.html /var/www/html/</span><br><span class="line"></span><br><span class="line">COPY static /var/www/html/static/  <span class="comment"># 一定要以斜线结尾 static不存在将会创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制该脚本至镜像中，并修改其权限</span></span><br><span class="line">ADD run.sh /run.sh</span><br><span class="line">RUN chmod 775 /run.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#当启动容器时执行的脚本文件</span></span><br><span class="line">CMD [<span class="string">"/run.sh"</span>]</span><br></pre></td></tr></table></figure><h2 id="制作镜像"><a href="#制作镜像" class="headerlink" title="制作镜像"></a>制作镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build  -t smhttpd:1.0.0 . </span><br><span class="line">docker build  -t smhttpd  .    <span class="comment">#默认是latest</span></span><br></pre></td></tr></table></figure><p>制作过程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~/dockerfile_build/nginx$ docker build -t smnginx .</span><br><span class="line">Sending build context to Docker daemon   7.68kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"> ---&gt; 0d120b6ccaa8</span><br><span class="line">Step 2/10 : MAINTAINER The CentOS Project &lt;923401910@qq.com&gt;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 73711e378096</span><br><span class="line">Step 3/10 : RUN yum -y update</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 17e83a7625bc</span><br><span class="line">Step 4/10 : RUN yum -y install </span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; d65bbe61e58a</span><br><span class="line">Step 5/10 : EXPOSE 80</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 013883f8a333</span><br><span class="line">Step 6/10 : COPY index.html /var/www/html/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 98a2d57e8bf1</span><br><span class="line">Step 7/10 : COPY static /var/www/html/static/</span><br><span class="line"> ---&gt; 6156265c2a76</span><br><span class="line">Step 8/10 : ADD run.sh /run.sh</span><br><span class="line"> ---&gt; 4832b8d59439</span><br><span class="line">Step 9/10 : RUN chmod 775 /run.sh</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a60d60aa3e19</span><br><span class="line">Removing intermediate container a60d60aa3e19</span><br><span class="line"> ---&gt; a95e79794432</span><br><span class="line">Step 10/10 : CMD [<span class="string">"/run.sh"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 5f71bc6a29b1</span><br><span class="line">Removing intermediate container 5f71bc6a29b1</span><br><span class="line"> ---&gt; 97a35e3ef1b7</span><br><span class="line">Successfully built 97a35e3ef1b7</span><br><span class="line">Successfully tagged smnginx:latest</span><br></pre></td></tr></table></figure><p>检查文件是否存在（不运行容器）</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~/dockerfile_build/nginx$ docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">smnginx              latest              <span class="number">97</span>a35e3ef1b7        <span class="number">2</span> minutes ago       <span class="number">278</span>MB</span><br></pre></td></tr></table></figure><p><strong>rm选项运行后会自动删除容器，后面可以指定自定义命令，一般用于测试</strong></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">luodi<span class="meta">@roddydeMacBook</span>-<span class="string">Pro:</span><span class="regexp">~/dockerfile_build/</span>nginx$ docker run --name smweb1 --rm smnginx ls -a <span class="regexp">/var/</span>www<span class="regexp">/html/</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">index.html</span><br><span class="line"><span class="keyword">static</span></span><br><span class="line">luodi<span class="meta">@roddydeMacBook</span>-<span class="string">Pro:</span><span class="regexp">~/dockerfile_build/</span>nginx$ docker run --name smweb1 --rm smnginx ls -a <span class="regexp">/var/</span>www<span class="regexp">/html/</span><span class="keyword">static</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">css</span><br><span class="line">img</span><br><span class="line">luodi<span class="meta">@roddydeMacBook</span>-<span class="string">Pro:</span><span class="regexp">~/dockerfile_build/</span>nginx$</span><br></pre></td></tr></table></figure><h2 id="指令介绍"><a href="#指令介绍" class="headerlink" title="指令介绍"></a>指令介绍</h2><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>FROM是最重要的一个且必须是DockerFile文件中的第一个非注释行，用于指定基准镜像。</p><p>语法:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM   <span class="params">&lt;repository&gt;</span>[:<span class="params">&lt;tag&gt;</span>] </span><br><span class="line">FROM   <span class="params">&lt;repository&gt;</span>@<span class="params">&lt;digest&gt;</span>   <span class="meta">#hash码</span></span><br></pre></td></tr></table></figure><h3 id="MAINTAINER-废弃"><a href="#MAINTAINER-废弃" class="headerlink" title="MAINTAINER(废弃)"></a>MAINTAINER(废弃)</h3><p>指定镜像的制作者，一般是名称加联系方式。不过目前已经被LABLE替代</p><h3 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h3><p>LABEL 指令会添加元数据到镜像。LABEL是以键值对形式出现的。MAINTAINER可以是一个KEY,同时还可以指定多个元数据信息。</p><p>语法：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">"luodi &lt;923401910@qq.com&gt;"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">"1.0"</span></span></span><br></pre></td></tr></table></figure><p>但是并不建议这样写，最好就写成一行，如太长需要换行的话则使用\符号</p><p>如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LABEL multi.<span class="attribute">label1</span>=<span class="string">"value1"</span> \</span><br><span class="line">multi.<span class="attribute">label2</span>=<span class="string">"value2"</span> \</span><br><span class="line"><span class="attribute">other</span>=<span class="string">"value3"</span></span><br></pre></td></tr></table></figure><p>说明：LABEL会继承基础镜像种的LABEL，如遇到key相同，则值覆盖</p><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><p>用于从Docker主机复制文件到创建的镜像文件中</p><p>语法:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash">  &lt;src&gt; &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash">  [<span class="string">"&lt;src&gt;"</span>,<span class="string">"dest"</span>]</span></span><br></pre></td></tr></table></figure><p>注意:</p><ul><li>src 必须是build上下文件中的路径，不能是父目录中的文件</li><li>如果src是目录，其内部文件或子目录会被递归复制，但src本身不会</li><li>如果dest事先不存在，它将会被自动创建，这包括其父目录路径</li><li>如果指定了多个src，或者在src使用通配符，dest必须是个目录，且必须是/结尾</li></ul><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><p>功能和copy相似，但是ADD支持URL路径和TAR文件。如果是一个本地tar.gz包，会被执行tar -x命令被自动展开。但是URL上的tar包不会</p><p>语法:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash">  &lt;src&gt; &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash">  [<span class="string">"&lt;src&gt;"</span>,<span class="string">"dest"</span>]</span></span><br></pre></td></tr></table></figure><p>下载并解压文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADD http:<span class="regexp">//</span>nginx.org<span class="regexp">/download/</span>nginx-<span class="number">1.19</span>.<span class="number">2</span>.tar.gz  <span class="regexp">/usr/</span>local<span class="regexp">/src/</span>   <span class="comment">#下载到src但是并不会解压</span></span><br><span class="line">ADD nginx-<span class="number">1.19</span>.<span class="number">2</span>.tar.gz  <span class="regexp">/usr/</span>local<span class="regexp">/src/</span>      <span class="comment">#解压本地文件到/usr/local/src/下</span></span><br></pre></td></tr></table></figure><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>设置工作目录，对RUN,CMD,ENTRYPOINT,COPY,ADD生效。如果不存在则会创建，也可以设置多次。</p><p>语法：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure><h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><p>设置启动容器的用户，可以是用户名或UID，所以，只有下面的两种写法是正确的</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USER daemo</span><br><span class="line">USER UID</span><br></pre></td></tr></table></figure><p>注意：如果设置了容器以daemon用户去运行，那么RUN, CMD 和 ENTRYPOINT 都会以这个用户去运行</p><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>可实现挂载功能，用于在镜像中创建一个挂载点目录，以挂载Docker Host上的卷和其他容器上的卷到容器中</p><p>语法为：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/data"</span>]</span></span><br></pre></td></tr></table></figure><p>说明：</p><p>[“/data”]可以是一个JsonArray ，也可以是多个值。所以如下几种写法都是正确的</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/var/log/"</span>]</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /var/<span class="built_in">log</span></span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /var/<span class="built_in">log</span> /var/db</span></span><br></pre></td></tr></table></figure><p>一般的使用场景为需要持久化存储数据时</p><p>容器使用的是AUFS，这种文件系统不能持久化数据，当容器关闭后，所有的更改都会丢失。</p><p>所以当数据需要持久化时用这个命令。</p><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>用于为容器打开要监听的端口以实现外部通信，相当于暴露端口，会添加一条NAT规则。</p><p>只是声明可以暴露的端口，但是不会真正暴露。如果要暴露端口需要启动容器时加上<strong>-P</strong>选项,会随机做端口映射，可以使用-p 指定映射关系</p><p>语法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE <span class="tag">&lt;<span class="name">port</span>&gt;</span></span><br><span class="line">EXPOSE <span class="tag">&lt;<span class="name">port</span>&gt;</span>[/protocol] <span class="tag">&lt;<span class="name">port</span>&gt;</span></span><br></pre></td></tr></table></figure><p>-P</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~/dockerfile_build/nginx$ docker run -dit  -P --rm --name webhttpd smhttpd</span><br><span class="line"><span class="number">1</span>d12e3386299        smhttpd             <span class="string">"/run.sh"</span>                <span class="number">2</span> minutes ago       Up <span class="number">2</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">32771</span>-&gt;<span class="number">80</span>/tcp               webhttpd</span><br></pre></td></tr></table></figure><p>指定端口</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~/dockerfile_build/nginx$ docker run -dit -p <span class="number">8044</span>:<span class="number">80</span> --name webhttp2 smhttpd</span><br><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~/dockerfile_build/nginx$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line"><span class="number">62f</span>afeb4aaa4        smhttpd             <span class="string">"/run.sh"</span>                <span class="number">3</span> seconds ago       Up <span class="number">2</span> seconds        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8044</span>-&gt;<span class="number">80</span>/tcp                webhttp2</span><br><span class="line"><span class="number">1</span>d12e3386299        smhttpd             <span class="string">"/run.sh"</span>                <span class="number">2</span> minutes ago       Up <span class="number">2</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">32771</span>-&gt;<span class="number">80</span>/tcp               webhttpd</span><br></pre></td></tr></table></figure><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>功能为设置环境变量,可被Dockerfile文件中位于其后的其他指令调用</p><p>语法有两种</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV <span class="tag">&lt;<span class="name">key</span>&gt;</span> <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">ENV <span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span> ...</span><br></pre></td></tr></table></figure><p>两者的区别就是第一种是一次设置一个，第二种是一次设置多个</p><p>样例：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DOC_ROOT /var/www/html/</span><br><span class="line"></span><br><span class="line"><span class="comment">#复制网站首页文件至镜像中web站点下 index.html 必须要在当前目录存在</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> index.html <span class="variable">$DOC_ROOT</span>  <span class="comment"># $&#123;DOC_ROOT:-/var/www/html/&#125;  如果没有值，赋默认值</span></span></span><br></pre></td></tr></table></figure><p>可以在docker run 的时候设定变量值</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name testweb -e <span class="attribute">WEB_HOST</span>=<span class="string">"172.103.2.2"</span></span><br></pre></td></tr></table></figure><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>构建镜像时运行指定的命令,可以运行多次，如果有关联关系建议使用&amp;&amp;关联</p><p>语法:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> &lt;cmd&gt;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">"cmd"</span>,<span class="string">"参数1"</span>,<span class="string">"参数2"</span>]</span></span><br></pre></td></tr></table></figure><p>样例：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install httpd</span></span><br></pre></td></tr></table></figure><p>注意：多行命令不要写多个RUN，原因是Dockerfile中每一个指令都会建立一层.</p><p>多少个RUN就构建了多少层镜像，会造成镜像的臃肿、多层，不仅仅增加了构件部署的时间，还容易出错。</p><p>RUN书写时的换行符是\</p><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>容器启动时要运行的命令</p><p>语法：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"executable"</span>,<span class="string">"param1"</span>,<span class="string">"param2"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"param1"</span>,<span class="string">"param2"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure><p>样例：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当启动容器时执行的脚本文件</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/run.sh"</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django dbshell CommandError  You appear not to have the &#39;mysql&#39; program installed or on your path.</title>
      <link href="2020/08/13/django-dbshell-CommandError/"/>
      <url>2020/08/13/django-dbshell-CommandError/</url>
      
        <content type="html"><![CDATA[<h2 id="系统版本"><a href="#系统版本" class="headerlink" title="系统版本"></a>系统版本</h2><p>Ubuntu 16.04</p><h2 id="错误提示"><a href="#错误提示" class="headerlink" title="错误提示"></a>错误提示</h2><p>“CommandError: You appear not to have the ‘mysql’ program installed or on your path.”</p><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p>安装mysql-client</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mysql-client</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e6fdj7fol5q85vjyw6Z:/data/webserver<span class="comment"># python manage.py dbshell</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4886593</span><br><span class="line">Server version: 5.7.26-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 镜像发布到docker hub</title>
      <link href="2020/08/12/docker-%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0docker-hub/"/>
      <url>2020/08/12/docker-%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0docker-hub/</url>
      
        <content type="html"><![CDATA[<h2 id="注册账户"><a href="#注册账户" class="headerlink" title="注册账户"></a>注册账户</h2><p>首先你得准备一个hub 的帐号, 去 <a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a> 注册</p><h2 id="登录账户并创建仓库"><a href="#登录账户并创建仓库" class="headerlink" title="登录账户并创建仓库"></a>登录账户并创建仓库</h2><p>创建仓库</p><img src="img/1597219076033.jpg"><img src="img/1597219113123.jpg"><h2 id="登录到docker-hub"><a href="#登录到docker-hub" class="headerlink" title="登录到docker hub"></a>登录到docker hub</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username: roddy1219</span></span><br><span class="line"><span class="string">Password:</span></span><br><span class="line"><span class="string">Login Succeeded</span></span><br><span class="line"><span class="string">luodi@roddydeMacBook-Pro:~$</span></span><br></pre></td></tr></table></figure><h2 id="修改本地镜像tag"><a href="#修改本地镜像tag" class="headerlink" title="修改本地镜像tag"></a>修改本地镜像tag</h2><p>打一个tag 名称必须是账户名/仓库:tag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker tag  busybox:latest roddy1219/busybox:latest</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                latest              08393e824c32        7 days ago          132MB</span><br><span class="line">busybox              latest              018c9d7b792b        2 weeks ago         1.22MB</span><br><span class="line">roddy1219/busybox    latest              018c9d7b792b        2 weeks ago         1.22MB</span><br></pre></td></tr></table></figure><h2 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker push roddy1219/busybox:latest</span><br><span class="line">The push refers to repository [docker.io/roddy1219/busybox]</span><br><span class="line">514c3a3e64d4: Pushed</span><br></pre></td></tr></table></figure><h2 id="退出docker-hub"><a href="#退出docker-hub" class="headerlink" title="退出docker hub"></a>退出docker hub</h2><p>使用docker logout</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker <span class="built_in">logout</span></span><br><span class="line">Removing login credentials <span class="keyword">for</span> https://index.docker.io/v1/</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><p>注:建议使用阿里云的容器仓库，docker hub太慢</p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 镜像导入导出</title>
      <link href="2020/08/12/docker-%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
      <url>2020/08/12/docker-%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="导出本地镜像"><a href="#导出本地镜像" class="headerlink" title="导出本地镜像"></a>导出本地镜像</h2><p>导出busybox镜像,也可以导出多个image到一个压缩文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                latest              08393e824c32        7 days ago          132MB</span><br><span class="line">busybox              latest              018c9d7b792b        2 weeks ago         1.22MB</span><br><span class="line">cfcontorl            1.0.0               1a1b058798ce        4 weeks ago         97.6MB</span><br><span class="line">&lt;none&gt;               &lt;none&gt;              252cf95e99e7        4 weeks ago         97.6MB</span><br><span class="line">ubuntu               latest              adafef2e596e        5 weeks ago         73.9MB</span><br><span class="line">zookeeper            latest              6982b35ff928        6 weeks ago         252MB</span><br><span class="line">mysql                5.7.30              9cfcce23593a        2 months ago        448MB</span><br><span class="line">mysql                latest              be0dbf01a0f3        2 months ago        541MB</span><br><span class="line">wurstmeister/kafka   latest              f1905dce9659        3 months ago        431MB</span><br><span class="line">mysql                8.0.19              0c27e8e5fcfa        3 months ago        546MB</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><p>使用docker save -o 导出镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker save -o  ./busybox_image.gz  busybox:latest</span><br></pre></td></tr></table></figure><h2 id="导出多个image"><a href="#导出多个image" class="headerlink" title="导出多个image"></a>导出多个image</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker save -o  ./all_image.gz  busybox:latest  nginx:latest</span><br></pre></td></tr></table></figure><h2 id="导入镜像到其他宿主机"><a href="#导入镜像到其他宿主机" class="headerlink" title="导入镜像到其他宿主机"></a>导入镜像到其他宿主机</h2><p>上传busybox_imge.gz到其他宿主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              08393e824c32        7 days ago          132MB</span><br><span class="line">mysql               5.7                 8679ced16d20        2 weeks ago         448MB</span><br><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># ls busybox_image.gz </span></span><br><span class="line">busybox_image.gz</span><br><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>使用docker load命令导入镜像压缩包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker load &lt; busybox_image.gz </span></span><br><span class="line">514c3a3e64d4: Loading layer [==================================================&gt;]  1.442MB/1.442MB</span><br><span class="line">Loaded image: busybox:latest</span><br><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              08393e824c32        7 days ago          132MB</span><br><span class="line">busybox             latest              018c9d7b792b        2 weeks ago         1.22MB</span><br><span class="line">mysql               5.7                 8679ced16d20        2 weeks ago         448MB</span><br></pre></td></tr></table></figure><p>或者使用以下命令</p><p>docker load -i busybox_image.gz<br>docker load –input busybox_image.gz </p><h2 id="使用镜像启动容器"><a href="#使用镜像启动容器" class="headerlink" title="使用镜像启动容器"></a>使用镜像启动容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker run --name=test4 -itd busybox  </span></span><br><span class="line">b66d72fd79dc0940dc2c259bd38bcb5447bfd099405dea692a39ff6b9f6ce0ad</span><br><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b66d72fd79dc        busybox             <span class="string">"sh"</span>                4 seconds ago       Up 2 seconds                            test4</span><br><span class="line">root@iZm5e7rjmq1tkuwoy8h8vuZ:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 基础命令使用</title>
      <link href="2020/08/11/docker-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"/>
      <url>2020/08/11/docker-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="docker命令"><a href="#docker命令" class="headerlink" title="docker命令"></a>docker命令</h2><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><p>用于搜索docker registory中镜像信息</p><p>其中第一个（没有前缀的称为顶级/顶层仓库）,一般是docker官方的仓库。后面xxxx/nginx表示用户仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker search nginx</span><br><span class="line">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                              Official build of Nginx.                        13590               [OK]</span><br><span class="line">jwilder/nginx-proxy                Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   1857                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   782                                     [OK]</span><br><span class="line">linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   126</span><br><span class="line">bitnami/nginx                      Bitnami nginx Docker Image                      88                                      [OK]</span><br><span class="line">tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   87                                      [OK]</span><br><span class="line">jc21/nginx-proxy-manager           Docker container <span class="keyword">for</span> managing Nginx proxy ho…   77</span><br><span class="line">alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from sou…   72                                      [OK]</span><br><span class="line">nginxdemos/hello                   NGINX webserver that serves a simple page co…   59                                      [OK]</span><br><span class="line">jlesage/nginx-proxy-manager        Docker container <span class="keyword">for</span> Nginx Proxy Manager        53                                      [OK]</span><br><span class="line">nginx/nginx-ingress                NGINX Ingress Controller <span class="keyword">for</span> Kubernetes         37</span><br><span class="line">privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm &amp; Al…   31                                      [OK]</span><br><span class="line">schmunk42/nginx-redirect           A very simple container to redirect HTTP tra…   19                                      [OK]</span><br><span class="line">nginxinc/nginx-unprivileged        Unprivileged NGINX Dockerfiles                  17</span><br><span class="line">nginx/nginx-prometheus-exporter    NGINX Prometheus Exporter                       14</span><br><span class="line">centos/nginx-112-centos7           Platform <span class="keyword">for</span> running nginx 1.12 or building …   13</span><br><span class="line">centos/nginx-18-centos7            Platform <span class="keyword">for</span> running nginx 1.8 or building n…   13</span><br><span class="line">raulr/nginx-wordpress              Nginx front-end <span class="keyword">for</span> the official wordpress:f…   13                                      [OK]</span><br><span class="line">blacklabelops/nginx                Dockerized Nginx Reverse Proxy Server.          13                                      [OK]</span><br><span class="line">mailu/nginx                        Mailu nginx frontend                            7                                       [OK]</span><br><span class="line">bitwarden/nginx                    The Bitwarden nginx web server acting as a r…   7</span><br><span class="line">sophos/nginx-vts-exporter          Simple server that scrapes Nginx vts stats a…   7                                       [OK]</span><br><span class="line">bitnami/nginx-ingress-controller   Bitnami Docker Image <span class="keyword">for</span> NGINX Ingress Contr…   6                                       [OK]</span><br><span class="line">wodby/nginx                        Generic nginx                                   1                                       [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb    An APB to deploy NGINX                          1                                       [OK]</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><p>默认安装的镜像大部分用的centos/ubuntu，如果需要自定义，大部分都是自己制作镜像。</p><p>alpine版本：专门用于制作的小镜像<br>stable版本: 稳定版本镜像<br>latest:   最新版本镜像</p><h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><p>pull 用于下载镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">bf5952930446: Pull complete</span><br><span class="line">ba755a256dfe: Downloading [===============================================&gt;   ]  24.88MB/26.34MB</span><br><span class="line">c57dd87d0b93: Download complete</span><br><span class="line">d7fbf29df889: Download complete</span><br><span class="line">1f1070938ccd: Download complete</span><br></pre></td></tr></table></figure><h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><p>列出本地下载的镜像，该命令和<code>docker image ls</code> 效果一致。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                latest              08393e824c32        6 days ago          132MB</span><br><span class="line">cfcontorl            1.0.0               1a1b058798ce        4 weeks ago         97.6MB</span><br><span class="line">&lt;none&gt;               &lt;none&gt;              252cf95e99e7        4 weeks ago         97.6MB</span><br><span class="line">ubuntu               latest              adafef2e596e        5 weeks ago         73.9MB</span><br><span class="line">zookeeper            latest              6982b35ff928        6 weeks ago         252MB</span><br><span class="line">mysql                5.7.30              9cfcce23593a        2 months ago        448MB</span><br><span class="line">mysql                latest              be0dbf01a0f3        2 months ago        541MB</span><br><span class="line">wurstmeister/kafka   latest              f1905dce9659        3 months ago        431MB</span><br><span class="line">mysql                8.0.19              0c27e8e5fcfa        3 months ago        546MB</span><br></pre></td></tr></table></figure><p>“<none><none> “ 这种镜像在Docker官方文档中被称作dangling images，指的是没有标签并且没有被容器使用的镜像。</p><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><p>删除一个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                     PORTS                                                   NAMES</span><br><span class="line">5abc6ea0c7f8        wurstmeister/kafka   <span class="string">"start-kafka.sh"</span>         4 weeks ago         Exited (255) 3 weeks ago   0.0.0.0:9092-&gt;9092/tcp                                  kafka</span><br><span class="line">a728e2d2d00e        zookeeper            <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Exited (255) 3 weeks ago   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:32768-&gt;2181/tcp   zookeeper</span><br><span class="line">32dead838953        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           jolly_ellis</span><br><span class="line">186f3d1a87c2        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           objective_mendeleev</span><br><span class="line">81a7d83a1333        cfcontorl:1.0.0      <span class="string">"/opt/Cfcontorl"</span>         4 weeks ago         Exited (1) 4 weeks ago                                                             cfcontorl</span><br><span class="line">392dce6fffe1        mysql:5.7.30         <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks                 33060/tcp, 0.0.0.0:3307-&gt;3306/tcp                       mysql5</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker rm cfcontorl</span><br><span class="line">cfcontorl</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                     PORTS                                                   NAMES</span><br><span class="line">5abc6ea0c7f8        wurstmeister/kafka   <span class="string">"start-kafka.sh"</span>         4 weeks ago         Exited (255) 3 weeks ago   0.0.0.0:9092-&gt;9092/tcp                                  kafka</span><br><span class="line">a728e2d2d00e        zookeeper            <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Exited (255) 3 weeks ago   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:32768-&gt;2181/tcp   zookeeper</span><br><span class="line">32dead838953        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           jolly_ellis</span><br><span class="line">186f3d1a87c2        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           objective_mendeleev</span><br><span class="line">392dce6fffe1        mysql:5.7.30         <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks                 33060/tcp, 0.0.0.0:3307-&gt;3306/tcp                       mysql5</span><br></pre></td></tr></table></figure><h3 id="rmi"><a href="#rmi" class="headerlink" title="rmi"></a>rmi</h3><p>删除一个镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker rmi --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">Remove one or more images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --force      Force removal of the image   //强制删除一个镜像</span><br><span class="line">      --no-prune   Do not delete untagged parents</span><br></pre></td></tr></table></figure><p>删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker rmi busybox</span><br><span class="line">Untagged: busybox:latest</span><br><span class="line">Untagged: busybox@sha256:4f47c01fa91355af2865ac10fef5bf6ec9c7f42ad2321377c21e844427972977</span><br><span class="line">Deleted: sha256:018c9d7b792b4be80095d957533667279843acf9a46c973067c8d1dff31ea8b4</span><br><span class="line">Deleted: sha256:514c3a3e64d4ebf15f482c9e8909d130bcd53bcc452f0225b0a04744de7b8c43</span><br></pre></td></tr></table></figure><h3 id="ps-container-ls"><a href="#ps-container-ls" class="headerlink" title="ps (container ls)"></a>ps (container ls)</h3><p>列出容器</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -<span class="keyword">a</span>  <span class="comment"> //all 列出所有容器</span></span><br><span class="line">ps     <span class="comment"> // 列出正在运行的容器</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                     PORTS                                                   NAMES</span><br><span class="line">5abc6ea0c7f8        wurstmeister/kafka   <span class="string">"start-kafka.sh"</span>         4 weeks ago         Exited (255) 3 weeks ago   0.0.0.0:9092-&gt;9092/tcp                                  kafka</span><br><span class="line">a728e2d2d00e        zookeeper            <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Exited (255) 3 weeks ago   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:32768-&gt;2181/tcp   zookeeper</span><br><span class="line">32dead838953        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           jolly_ellis</span><br><span class="line">186f3d1a87c2        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                                           objective_mendeleev</span><br><span class="line">81a7d83a1333        cfcontorl:1.0.0      <span class="string">"/opt/Cfcontorl"</span>         4 weeks ago         Exited (1) 4 weeks ago                                                             cfcontorl</span><br><span class="line">392dce6fffe1        mysql:5.7.30         <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks                 33060/tcp, 0.0.0.0:3307-&gt;3306/tcp                       mysql5</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">392dce6fffe1        mysql:5.7.30        <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks          33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql5</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><p>启动一个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker start zookeeper</span><br><span class="line">zookeeper</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                   NAMES</span><br><span class="line">a728e2d2d00e        zookeeper           <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Up 2 seconds        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:32768-&gt;2181/tcp   zookeeper</span><br><span class="line">392dce6fffe1        mysql:5.7.30        <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks          33060/tcp, 0.0.0.0:3307-&gt;3306/tcp                       mysql5</span><br></pre></td></tr></table></figure><h3 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h3><p>重启一个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker restart zookeeper</span><br><span class="line">zookeeper</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><h3 id="stop（-15）-kill（-9）"><a href="#stop（-15）-kill（-9）" class="headerlink" title="stop（-15）/kill（-9）"></a>stop（-15）/kill（-9）</h3><p>stop 停止一个或者多个容器<br>kill 强制停止一个或多个容器(不建议生产使用)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker stop zookeeper</span><br><span class="line">zookeeper</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">392dce6fffe1        mysql:5.7.30        <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks          33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql5</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker <span class="built_in">kill</span> zookeeper</span><br><span class="line">zookeeper</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                          PORTS                               NAMES</span><br><span class="line">efafc195cc87        nginx:latest         <span class="string">"/docker-entrypoint.…"</span>   11 minutes ago      Exited (0) About a minute ago                                       ngx1</span><br><span class="line">5abc6ea0c7f8        wurstmeister/kafka   <span class="string">"start-kafka.sh"</span>         4 weeks ago         Exited (255) 3 weeks ago        0.0.0.0:9092-&gt;9092/tcp              kafka</span><br><span class="line">a728e2d2d00e        zookeeper            <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Exited (137) 4 seconds ago                                          zookeeper</span><br><span class="line">32dead838953        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                            jolly_ellis</span><br><span class="line">186f3d1a87c2        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                            objective_mendeleev</span><br><span class="line">392dce6fffe1        mysql:5.7.30         <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks                      33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql5</span><br></pre></td></tr></table></figure><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>创建并启动一个容器run = create+start</p><p>-d: daemon   用于支撑容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker run --name ngx1 -d  nginx:latest</span><br><span class="line">efafc195cc875d0b6895b47f2b6a1215073fae043bc754bb03839865fd530fac</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                   NAMES</span><br><span class="line">efafc195cc87        nginx:latest        <span class="string">"/docker-entrypoint.…"</span>   2 seconds ago       Up 1 second         80/tcp                                                  ngx1</span><br><span class="line">a728e2d2d00e        zookeeper           <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Up About a minute   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:32769-&gt;2181/tcp   zookeeper</span><br><span class="line">392dce6fffe1        mysql:5.7.30        <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks          33060/tcp, 0.0.0.0:3307-&gt;3306/tcp                       mysql5</span><br><span class="line">luodi@roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p>创建一个容器但是不启动它</p><p>创建一个ngx2的容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker create --name ngx2  nginx:latest</span><br><span class="line">81bcf8637b40f7764fd9f2701ab2f6cb97cee5e08cd29fa096d62207dd456bfe</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">392dce6fffe1        mysql:5.7.30        <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks          33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql5</span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                       PORTS                               NAMES</span><br><span class="line">81bcf8637b40        nginx:latest         <span class="string">"/docker-entrypoint.…"</span>   4 seconds ago       Created                                                          ngx2</span><br><span class="line">efafc195cc87        nginx:latest         <span class="string">"/docker-entrypoint.…"</span>   19 minutes ago      Exited (0) 10 minutes ago                                        ngx1</span><br><span class="line">5abc6ea0c7f8        wurstmeister/kafka   <span class="string">"start-kafka.sh"</span>         4 weeks ago         Exited (255) 3 weeks ago     0.0.0.0:9092-&gt;9092/tcp              kafka</span><br><span class="line">a728e2d2d00e        zookeeper            <span class="string">"/docker-entrypoint.…"</span>   4 weeks ago         Exited (143) 7 minutes ago                                       zookeeper</span><br><span class="line">32dead838953        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                         jolly_ellis</span><br><span class="line">186f3d1a87c2        adafef2e596e         <span class="string">"/bin/sh -c 'apt-get…"</span>   4 weeks ago         Exited (100) 4 weeks ago                                         objective_mendeleev</span><br><span class="line">392dce6fffe1        mysql:5.7.30         <span class="string">"docker-entrypoint.s…"</span>   5 weeks ago         Up 3 weeks                   33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql5</span><br></pre></td></tr></table></figure><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><p>查看docker版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">luodi@roddydeMacBook-Pro:~$ docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.8</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.12.17</span><br><span class="line"> Git commit:        afacb8b</span><br><span class="line"> Built:             Wed Mar 11 01:21:11 2020</span><br><span class="line"> OS/Arch:           darwin/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.8</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.12.17</span><br><span class="line">  Git commit:       afacb8b</span><br><span class="line">  Built:            Wed Mar 11 01:29:16 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          v1.2.13</span><br><span class="line">  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>drf 框架自定义分页代码</title>
      <link href="2020/07/23/drf-%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E4%BB%A3%E7%A0%81/"/>
      <url>2020/07/23/drf-%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>1.重写分页 utils/Page文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination,LimitOffsetPagination</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StandardResultsSetPagination</span><span class="params">(PageNumberPagination)</span>:</span></span><br><span class="line">    page_size = <span class="number">20</span></span><br><span class="line">    page_size_query_param = <span class="string">'pageSize'</span></span><br><span class="line">    max_page_size = <span class="number">2000</span></span><br><span class="line">    page_query_param = <span class="string">"pageNo"</span>  <span class="comment"># 定制请求参数为pageNo</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_paginated_response</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(OrderedDict([</span><br><span class="line">            (<span class="string">'totalCount'</span>, self.page.paginator.count),</span><br><span class="line">            (<span class="string">'pageNo'</span>, self.page.number),</span><br><span class="line">            (<span class="string">'pageSize'</span>, self.get_page_size(self.request)),</span><br><span class="line">            (<span class="string">'totalPage'</span>, self.page.paginator.num_pages),</span><br><span class="line">            (<span class="string">'next'</span>, self.get_next_link()),</span><br><span class="line">            (<span class="string">'previous'</span>, self.get_previous_link()),</span><br><span class="line">            (<span class="string">'code'</span>, <span class="number">0</span>),</span><br><span class="line">            (<span class="string">'message'</span>, <span class="string">'Ok'</span>),</span><br><span class="line">            (<span class="string">'data'</span>, data), <span class="comment"># 返回的data标示</span></span><br><span class="line">        ]))</span><br></pre></td></tr></table></figure><p>2.配置settings.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">'DEFAULT_CACHE_RESPONSE_TIMEOUT'</span>: <span class="number">60</span> * <span class="number">60</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'DEFAULT_PAGINATION_CLASS'</span>: <span class="string">'utils.Page.StandardResultsSetPagination'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'DEFAULT_FILTER_BACKENDS'</span>: (<span class="string">'django_filters.rest_framework.DjangoFilterBackend'</span>,),</span><br><span class="line"></span><br><span class="line">    <span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: (</span><br><span class="line">        <span class="string">'rest_framework_jwt.authentication.JSONWebTokenAuthentication'</span>,</span><br><span class="line">        <span class="comment"># 'rest_framework.authentication.SessionAuthentication',</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (</span><br><span class="line">        <span class="string">'rest_framework.permissions.AllowAny'</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">'DEFAULT_PARSER_CLASSES'</span>: (</span><br><span class="line">        <span class="string">'rest_framework.parsers.JSONParser'</span>,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.访问结果 </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"totalCount"</span>: <span class="number">1151</span>,           <span class="comment">//总数据条数</span></span><br><span class="line">    <span class="attr">"pageNo"</span>: <span class="number">2</span>,                  <span class="comment">//当前分页</span></span><br><span class="line">    <span class="attr">"pageSize"</span>: <span class="number">3</span>,               <span class="comment">//分页大小</span></span><br><span class="line">    <span class="attr">"totalPage"</span>: <span class="number">384</span>,            <span class="comment">//分页数</span></span><br><span class="line">    <span class="attr">"next"</span>: <span class="string">"http://127.0.0.1:8001/api/users/?pageNo=3&amp;pageSize=3"</span>,</span><br><span class="line">    <span class="attr">"previous"</span>: <span class="string">"http://127.0.0.1:8001/api/users/?pageSize=3"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Ok"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"xxxx"</span>,</span><br><span class="line">            <span class="attr">"mobile"</span>: <span class="string">"xxxxxx"</span>,</span><br><span class="line">            <span class="attr">"email"</span>: <span class="string">"xxxx@qq.com"</span>,</span><br><span class="line">            <span class="attr">"date_joined"</span>: <span class="string">"2019-04-25 13:44:47"</span>,</span><br><span class="line">            <span class="attr">"last_login"</span>: <span class="string">"2019-04-27 10:00:44"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"roddytest"</span>,</span><br><span class="line">            <span class="attr">"mobile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"email"</span>: <span class="string">"xxxx@qq.com"</span>,</span><br><span class="line">            <span class="attr">"date_joined"</span>: <span class="string">"2019-04-26 15:50:27"</span>,</span><br><span class="line">            <span class="attr">"last_login"</span>: <span class="string">"2019-07-06 19:33:54"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"xxxx"</span>,</span><br><span class="line">            <span class="attr">"mobile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"email"</span>: <span class="string">"xx@qq.com"</span>,</span><br><span class="line">            <span class="attr">"date_joined"</span>: <span class="string">"2019-04-29 11:30:22"</span>,</span><br><span class="line">            <span class="attr">"last_login"</span>: <span class="string">"2020-01-12 06:17:14"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql 创建数据库并制定utf-8编码</title>
      <link href="2020/07/23/mysql-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%88%B6%E5%AE%9Autf-8%E7%BC%96%E7%A0%81/"/>
      <url>2020/07/23/mysql-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%88%B6%E5%AE%9Autf-8%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>创建数据时指定编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS dbname  DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafka 创建&amp;消费topic</title>
      <link href="2020/07/08/kafka-%E5%88%9B%E5%BB%BA-%E6%B6%88%E8%B4%B9topic/"/>
      <url>2020/07/08/kafka-%E5%88%9B%E5%BB%BA-%E6%B6%88%E8%B4%B9topic/</url>
      
        <content type="html"><![CDATA[<h2 id="创建topic"><a href="#创建topic" class="headerlink" title="创建topic"></a>创建topic</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash-4.4# ./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic  topicname</span><br></pre></td></tr></table></figure><p>2181是zookeeper端口</p><p>创建成功提示,kafka建议不要使用.或者_作topic名，但是不影响使用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Created topic monitor_ping_topic</span><br></pre></td></tr></table></figure><h2 id="查看topic"><a href="#查看topic" class="headerlink" title="查看topic"></a>查看topic</h2><p>查看topic使用–list 即可列出有哪些topic</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bash<span class="number">-4.4</span># ./bin/kafka-topics.sh --list --zookeeper zookeeper:<span class="number">2181</span></span><br><span class="line">__consumer_offsets</span><br><span class="line">monitor_ping_topic</span><br><span class="line">monitor_solve_topic</span><br><span class="line">monitor_times_topic</span><br><span class="line">bash<span class="number">-4.4</span>#</span><br></pre></td></tr></table></figure><h2 id="生产消息"><a href="#生产消息" class="headerlink" title="生产消息"></a>生产消息</h2><p>回车输入消息内容</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bash-4.4# </span>./<span class="keyword">bin/kafka-console-producer.sh </span>--<span class="keyword">broker-list </span>localhost:<span class="number">9092</span> --topic monitor_ping_topic</span><br><span class="line">&gt;&#123;<span class="string">"Host"</span>:<span class="string">"192.168.1.1"</span>,<span class="string">"Type"</span>:<span class="number">1</span>,<span class="string">"Status"</span>:<span class="string">"success"</span>,<span class="string">"PingCount"</span>:<span class="number">3</span>,<span class="string">"AvgRtt"</span>:<span class="number">10756000</span>,<span class="string">"PacketLoss"</span>:<span class="number">0</span>,<span class="string">"CreateTime"</span>:<span class="string">"2020/07/08 13:58:16"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h2 id="消费消息"><a href="#消费消息" class="headerlink" title="消费消息"></a>消费消息</h2><p>from-beginning 表示从头开始消费消息</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">bash-4.4# </span>./<span class="keyword">bin/kafka-console-consumer.sh </span>--<span class="keyword">bootstrap-server </span>localhost:<span class="number">9092</span> --topic monitor_ping_topic --from-<span class="keyword">beginning</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">&#123;"Host":"192.168.1.1","Type":1,"Status":"success","PingCount":3,"AvgRtt":119031000,"PacketLoss":0,"CreateTime":"2020/07/08 </span><span class="number">13</span>:<span class="number">53</span>:<span class="number">41</span><span class="string">"&#125;</span></span><br><span class="line"><span class="string">&#123;"</span>Host<span class="string">":"</span><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">2</span><span class="string">","</span>Type<span class="string">":1,"</span>Status<span class="string">":"</span>failed<span class="string">","</span>PingCount<span class="string">":3,"</span>AvgRtt<span class="string">":0,"</span>PacketLoss<span class="string">":100,"</span>CreateTime<span class="string">":"</span><span class="number">2020</span>/<span class="number">07</span>/<span class="number">08</span> <span class="number">13</span>:<span class="number">53</span>:<span class="number">41</span><span class="string">"&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker for Mac安装</title>
      <link href="2020/07/01/docker-for-Mac%E5%AE%89%E8%A3%85/"/>
      <url>2020/07/01/docker-for-Mac%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h2 id="docker-下载"><a href="#docker-下载" class="headerlink" title="docker 下载"></a>docker 下载</h2><p>前往Docker官网下载Docker dmg包</p><p>官网：<a href="https://www.docker.com/get-started" target="_blank" rel="noopener">https://www.docker.com/get-started</a>  下载docker desktop</p><img src="/img/1593573916553.jpg"><h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>下载dmg方式会出现如下错误</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mac</span> for docker The operation couldn’t be completed. (Docker.VmnetdError <span class="literal">error</span> <span class="number">1</span>.)</span><br></pre></td></tr></table></figure><img src="/img/1593575071443.jpg"><p>以上方法无法安装，采用阿里的docker可以安装成功。</p><h2 id="安装-阿里docker"><a href="#安装-阿里docker" class="headerlink" title="安装 阿里docker"></a>安装 阿里docker</h2><p>官网 <a href="http://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/" target="_blank" rel="noopener">http://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/</a></p><img src="/img/1593589136008.jpg"><h2 id="docker-命令"><a href="#docker-命令" class="headerlink" title="docker 命令"></a>docker 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker ps    //查看运行状态</span><br><span class="line">docker start    //启动一个容器</span><br><span class="line">docker verison  //查看docker版本</span><br><span class="line">docker rm //删除容器</span><br><span class="line">docker rename //重命名一个容器</span><br><span class="line">docker logs //查看容器日志</span><br><span class="line">docker attach //进入容器</span><br><span class="line">....</span><br></pre></td></tr></table></figure><h2 id="修改默认仓库"><a href="#修改默认仓库" class="headerlink" title="修改默认仓库"></a>修改默认仓库</h2><p>点击logo——&gt; preferences——&gt; docker engine  修改成如下配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"experimental"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">"registry-mirrors"</span>:[</span><br><span class="line">      <span class="string">"http://hub-mirror.c.163.com"</span>,</span><br><span class="line">      <span class="string">"https://docker.mirrors.ustc.edu.cn"</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="docker-info"><a href="#docker-info" class="headerlink" title="docker info"></a>docker info</h2><p>可以看到mirrors修改成功</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">luodi@roddydeMacBook-Pro:~$ docker info</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.8</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: &lt;unknown&gt;</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.19.76-linuxkit</span><br><span class="line"> Operating System: Docker Desktop</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 2</span><br><span class="line"> Total Memory: 1.945GiB</span><br><span class="line"> Name: docker-desktop</span><br><span class="line"> ID: 2W5N:QPGQ:H5KA:GNGN:LWWY:IQFC:BD5N:D3XZ:GNDK:N2IH:J7AI:5JEH</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: true</span><br><span class="line">  File Descriptors: 51</span><br><span class="line">  Goroutines: 100</span><br><span class="line">  System Time: 2020-07-01T08:46:32.000970455Z</span><br><span class="line">  EventsListeners: 3</span><br><span class="line"> HTTP Proxy: gateway.docker.internal:3128</span><br><span class="line"> HTTPS Proxy: gateway.docker.internal:3129</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  http://hub-mirror.c.163.com/</span><br><span class="line">  https://docker.mirrors.ustc.edu.cn/</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br></pre></td></tr></table></figure><h2 id="docker-运行mysql"><a href="#docker-运行mysql" class="headerlink" title="docker 运行mysql"></a>docker 运行mysql</h2><p>对外暴露端口3308 密码 root12334</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~$ docker run --name mysqlgo -p <span class="number">3308</span>:<span class="number">3306</span> -e MYSQL_ROOT_PASSWORD=root1234 -d mysql:<span class="number">8.0</span><span class="number">.19</span></span><br></pre></td></tr></table></figure><p>查看运行状态</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line"><span class="number">610</span>d8c36f67c        mysql:<span class="number">8.0</span><span class="number">.19</span>        <span class="string">"docker-entrypoint.s…"</span>   <span class="number">16</span> seconds ago      Up <span class="number">15</span> seconds       <span class="number">33060</span>/tcp, <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">3308</span>-&gt;<span class="number">3306</span>/tcp   mysqlgo</span><br><span class="line"><span class="symbol">luodi@</span>roddydeMacBook-Pro:~$</span><br></pre></td></tr></table></figure><p>启动一个连接客户端</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="builtin-name">run</span> -it --network host --rm mysql mysql -h127.0.0.1 -P3308 <span class="attribute">--default-character-set</span>=utf8mb4 -uroot -p</span><br><span class="line">Unable <span class="keyword">to</span> <span class="builtin-name">find</span> image <span class="string">'mysql:latest'</span> locally</span><br><span class="line">latest: Pulling <span class="keyword">from</span> library/mysql</span><br><span class="line">8559a31e96f4: Pull complete</span><br><span class="line">d51ce1c2e575: Pull complete</span><br><span class="line">c2344adc4858: Pull complete</span><br><span class="line">fcf3ceff18fc: Pull complete</span><br><span class="line">16da0c38dc5b: Pull complete</span><br><span class="line">b905d1797e97: Pull complete</span><br><span class="line">4b50d1c6b05c: Pull complete</span><br><span class="line">c75914a65ca2: Pull complete</span><br><span class="line">1ae8042bdd09: Pull complete</span><br><span class="line">453ac13c00a3: Pull complete</span><br><span class="line">9e680cd72f08: Pull complete</span><br><span class="line">a6b5dc864b6c: Pull complete</span><br><span class="line">Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">Enter password:</span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands end with ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL<span class="built_in"> connection </span>id is 10</span><br><span class="line">Server version: 8.0.19 MySQL<span class="built_in"> Community Server </span>- GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> <span class="keyword">or</span> <span class="string">'\h'</span> <span class="keyword">for</span> help.<span class="built_in"> Type </span><span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="builtin-name">set</span> (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; create database gotest;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h2 id="brew安装参考文档"><a href="#brew安装参考文档" class="headerlink" title="brew安装参考文档"></a>brew安装参考文档</h2><p>如果使用brew安装参考如下</p><ul><li><a href="https://pilsniak.com/how-to-install-docker-on-mac-os-using-brew/" target="_blank" rel="noopener">https://pilsniak.com/how-to-install-docker-on-mac-os-using-brew/</a></li><li><a href="https://github.com/docker/for-mac/issues/3809#issuecomment-557730621" target="_blank" rel="noopener">https://github.com/docker/for-mac/issues/3809#issuecomment-557730621</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node14+ 版本下hexo部署失败报错</title>
      <link href="2020/06/30/node14-%E7%89%88%E6%9C%AC%E4%B8%8Bhexo%E9%83%A8%E7%BD%B2%E5%A4%B1%E8%B4%A5%E6%8A%A5%E9%94%99/"/>
      <url>2020/06/30/node14-%E7%89%88%E6%9C%AC%E4%B8%8Bhexo%E9%83%A8%E7%BD%B2%E5%A4%B1%E8%B4%A5%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>因博客迁移换了电脑，升级了node 升级版本为14.4.0。然后hexo部署出现如下错误</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ATAL Something's wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">TypeError [ERR_INVALID_ARG_TYPE]: The "mode" argument must be integer. Received an instance of Object</span><br><span class="line">    at copyFile (fs.js:1895:10)</span><br><span class="line">    at tryCatcher (/Users/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    <span class="keyword">at</span> ret (eval <span class="keyword">at</span> makeNodePromisifiedEval (/usr/<span class="keyword">local</span>/lib/node_modules/hexo-cli/node_modules/bluebird/js/<span class="keyword">release</span>/promisify.js:<span class="number">184</span>:<span class="number">12</span>), &lt;anonymous&gt;:<span class="number">13</span>:<span class="number">39</span>)</span><br><span class="line">    <span class="keyword">at</span> /<span class="keyword">Users</span>/luodi/githubblog/node_modules/hexo-fs/lib/fs.js:<span class="number">144</span>:<span class="number">39</span></span><br><span class="line">    <span class="keyword">at</span> tryCatcher (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromiseFromHandler (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">547</span>:<span class="number">31</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise0 (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromises (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._fulfill (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._resolveCallback (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">466</span>:<span class="number">57</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromiseFromHandler (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">559</span>:<span class="number">17</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise0 (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromises (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._fulfill (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._resolveCallback (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">466</span>:<span class="number">57</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromiseFromHandler (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">559</span>:<span class="number">17</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromise0 (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._settlePromises (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">at</span> Promise._fulfill (/<span class="keyword">Users</span>/luodi/githubblog/node_modules/bluebird/js/<span class="keyword">release</span>/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br></pre></td></tr></table></figure><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>下载最新稳定版本12.18.1 <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a></p><p>下载安装完成后重新执行部署</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hexo</span> <span class="string">clean</span></span><br><span class="line"><span class="attr">hexo</span> <span class="string">g</span></span><br><span class="line"><span class="attr">hexo</span> <span class="string">d</span></span><br></pre></td></tr></table></figure><p>参考文档:</p><ul><li><a href="https://evestorm.github.io/posts/430/" target="_blank" rel="noopener">https://evestorm.github.io/posts/430/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GORM安装使用</title>
      <link href="2020/06/30/GORM%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
      <url>2020/06/30/GORM%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="官方网站"><a href="#官方网站" class="headerlink" title="官方网站"></a>官方网站</h3><ul><li><a href="https://gorm.io/zh_CN/docs" target="_blank" rel="noopener">https://gorm.io/zh_CN/docs</a></li><li><a href="https://github.com/go-gorm/gorm" target="_blank" rel="noopener">https://github.com/go-gorm/gorm</a> </li></ul><h3 id="Gorm安装"><a href="#Gorm安装" class="headerlink" title="Gorm安装"></a>Gorm安装</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/jinzhu/gorm</span><br></pre></td></tr></table></figure><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>连接数据库首先要导入驱动。gorm默认包含了如下一些驱动可以使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">"github.com/jinzhu/gorm/dialects/mysql"</span></span><br><span class="line"><span class="comment">// import _ "github.com/jinzhu/gorm/dialects/postgres"</span></span><br><span class="line"><span class="comment">// import _ "github.com/jinzhu/gorm/dialects/sqlite"</span></span><br><span class="line"><span class="comment">// import _ "github.com/jinzhu/gorm/dialects/mssql"</span></span><br></pre></td></tr></table></figure><h3 id="连接实例"><a href="#连接实例" class="headerlink" title="连接实例"></a>连接实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"github.com/jinzhu/gorm"</span></span><br><span class="line">_ <span class="string">"github.com/jinzhu/gorm/dialects/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">db, err := gorm.Open(<span class="string">"mysql"</span>, <span class="string">"user:password@/dbname?charset=utf8&amp;parseTime=True&amp;loc=Local"</span>)</span><br><span class="line"><span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"连接失败"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"github.com/jinzhu/gorm"</span></span><br><span class="line">_ <span class="string">"github.com/jinzhu/gorm/dialects/mysql"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建User表struct 默认表名是users</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">ID <span class="keyword">int</span>                    <span class="comment">//如果有ID字段，将自动设置为主键</span></span><br><span class="line">Username <span class="keyword">string</span></span><br><span class="line">Password <span class="keyword">string</span></span><br><span class="line">CreatedAt  *time.Time     <span class="comment">//系统将自动插入当前时间</span></span><br><span class="line">UpdatedAt  *time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 User 的表名设置为 `monitor_users`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span> <span class="title">TableName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"monitor_users"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">db, err := gorm.Open(<span class="string">"mysql"</span>, <span class="string">"root:root@tcp(127.0.0.1:3307)/monitor?charset=utf8&amp;parseTime=True&amp;loc=Local"</span>)</span><br><span class="line"><span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"连接失败"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 应用模型到数据库</span></span><br><span class="line">db.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>插入数据</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Create(&amp;User&#123;Username: <span class="string">"roddy"</span>,Password: <span class="string">"123456"</span>,&#125;)  <span class="comment">//插入一条数据</span></span><br></pre></td></tr></table></figure><p>插入数据前判断</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u := User&#123;Username: <span class="string">"test"</span>,Password: <span class="string">"123456"</span>&#125;</span><br><span class="line">fmt.Println(db.NewRecord(&amp;u))  <span class="comment">//判断主键是否为空，表中是否存在主键冲突，如果以Id为主键改判断可以忽略</span></span><br><span class="line">db.Create(&amp;u)</span><br><span class="line">fmt.Println(db.NewRecord(&amp;u))</span><br></pre></td></tr></table></figure><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>查询第一条数据</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstValue User</span><br><span class="line">db.First(&amp;firstValue)</span><br><span class="line">fmt.Println(<span class="string">"username:"</span>,firstValue.Username)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用debug查询执行原始语句</span></span><br><span class="line">db.Debug().First(&amp;User&#123;&#125;)</span><br></pre></td></tr></table></figure><p>查询最后一条数据</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询最后一条数据</span></span><br><span class="line"><span class="keyword">var</span> lastValue User</span><br><span class="line">db.Last(&amp;lastValue)</span><br><span class="line">fmt.Println(<span class="string">"last username:"</span>,lastValue.Username)</span><br></pre></td></tr></table></figure><p>根据条件筛选</p><p>where 条件筛选</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 条件筛选</span></span><br><span class="line"><span class="keyword">var</span> users [] User</span><br><span class="line">db.Where(<span class="string">"username = ?"</span>, <span class="string">"roddy"</span>).Find(&amp;users)</span><br><span class="line"><span class="keyword">for</span> _,v := <span class="keyword">range</span> users&#123;</span><br><span class="line">fmt.Printf(<span class="string">"username:%v password:%v\n"</span>,v.Username,v.Password)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 获取第一个匹配的记录</span></span><br><span class="line">db.Where(<span class="string">"name = ?"</span>, <span class="string">"jinzhu"</span>).First(&amp;user)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name = 'jinzhu' limit 1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有匹配的记录</span></span><br><span class="line">db.Where(<span class="string">"name = ?"</span>, <span class="string">"jinzhu"</span>).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name = 'jinzhu';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;&gt;</span></span><br><span class="line">db.Where(<span class="string">"name &lt;&gt; ?"</span>, <span class="string">"jinzhu"</span>).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name &lt;&gt; 'jinzhu';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IN</span></span><br><span class="line">db.Where(<span class="string">"name IN (?)"</span>, []<span class="keyword">string</span>&#123;<span class="string">"jinzhu"</span>, <span class="string">"jinzhu 2"</span>&#125;).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name in ('jinzhu','jinzhu 2');</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// LIKE</span></span><br><span class="line">db.Where(<span class="string">"name LIKE ?"</span>, <span class="string">"%jin%"</span>).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name LIKE '%jin%';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// AND</span></span><br><span class="line">db.Where(<span class="string">"name = ? AND age &gt;= ?"</span>, <span class="string">"jinzhu"</span>, <span class="string">"22"</span>).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE name = 'jinzhu' AND age &gt;= 22;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Time</span></span><br><span class="line">db.Where(<span class="string">"updated_at &gt; ?"</span>, lastWeek).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE updated_at &gt; '2000-01-01 00:00:00';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BETWEEN</span></span><br><span class="line">db.Where(<span class="string">"created_at BETWEEN ? AND ?"</span>, lastWeek, today).Find(&amp;users)</span><br><span class="line"><span class="comment">//// SELECT * FROM users WHERE created_at BETWEEN '2000-01-01 00:00:00' AND '2000-01-08 00:00:00';</span></span><br></pre></td></tr></table></figure><h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>更新表中username为roddy1的username 字段，修改为”haha”</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">"username=?"</span>,<span class="string">"roddy1"</span>).Update(<span class="string">"username"</span>,<span class="string">"haha"</span>)</span><br></pre></td></tr></table></figure><p>参考样例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新单个属性，如果它有变化</span></span><br><span class="line">db.Model(&amp;user).Update(<span class="string">"name"</span>, <span class="string">"hello"</span>)</span><br><span class="line"><span class="comment">//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据给定的条件更新单个属性</span></span><br><span class="line">db.Model(&amp;user).Where(<span class="string">"active = ?"</span>, <span class="literal">true</span>).Update(<span class="string">"name"</span>, <span class="string">"hello"</span>)</span><br><span class="line"><span class="comment">//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111 AND active=true;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 map 更新多个属性，只会更新其中有变化的属性</span></span><br><span class="line">db.Model(&amp;user).Updates(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"name"</span>: <span class="string">"hello"</span>, <span class="string">"age"</span>: <span class="number">18</span>, <span class="string">"actived"</span>: <span class="literal">false</span>&#125;)</span><br><span class="line"><span class="comment">//// UPDATE users SET name='hello', age=18, actived=false, updated_at='2013-11-17 21:34:10' WHERE id=111;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 struct 更新多个属性，只会更新其中有变化且为非零值的字段</span></span><br><span class="line">db.Model(&amp;user).Updates(User&#123;Name: <span class="string">"hello"</span>, Age: <span class="number">18</span>&#125;)</span><br><span class="line"><span class="comment">//// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE id = 111;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 警告：当使用 struct 更新时，GORM只会更新那些非零值的字段</span></span><br><span class="line"><span class="comment">// 对于下面的操作，不会发生任何更新，"", 0, false 都是其类型的零值</span></span><br><span class="line">db.Model(&amp;user).Updates(User&#123;Name: <span class="string">""</span>, Age: <span class="number">0</span>, Actived: <span class="literal">false</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除所有数据</span></span><br><span class="line">db.Delete(&amp;User&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除匹配数据</span></span><br><span class="line">db.Where(<span class="string">"email LIKE ?"</span>, <span class="string">"%jinzhu%"</span>).Delete(Email&#123;&#125;)</span><br><span class="line"><span class="comment">//// DELETE from emails where email LIKE "%jinzhu%";</span></span><br><span class="line"></span><br><span class="line">db.Delete(Email&#123;&#125;, <span class="string">"email LIKE ?"</span>, <span class="string">"%jinzhu%"</span>)</span><br><span class="line"><span class="comment">//// DELETE from emails where email LIKE "%jinzhu%";</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gorm </tag>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Macbook Pro Sublime3注册</title>
      <link href="2020/06/29/Macbook%20Pro%20%20Sublime3%E6%B3%A8%E5%86%8C/"/>
      <url>2020/06/29/Macbook%20Pro%20%20Sublime3%E6%B3%A8%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<p>点击 help -&gt; enter Licence ,然后输入如下信息:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----- BEGIN LICENSE -----</span><br><span class="line">Member J2TeaM</span><br><span class="line">Single User License</span><br><span class="line">EA7E<span class="number">-1011316</span></span><br><span class="line">D7DA350E <span class="number">1</span>B8B0760 <span class="number">972</span>F8B60 F3E64036</span><br><span class="line">B9B4E234 F356F38F <span class="number">0</span>AD1E3B7 <span class="number">0E9</span>C5FAD</span><br><span class="line">FA0A2ABE <span class="number">25</span>F65BD8 D51458E5 <span class="number">3923</span>CE80</span><br><span class="line"><span class="number">87428428</span> <span class="number">79079</span>A01 AA69F319 A1AF29A4</span><br><span class="line">A684C2DC <span class="number">0</span>B1583D4 <span class="number">19</span>CBD290 <span class="number">217618</span>CD</span><br><span class="line"><span class="number">5653E0</span>A0 BACE3948 BB2EE45E <span class="number">422</span>D2C87</span><br><span class="line">DD9AF44B <span class="number">99</span>C49590 D2DBDEE1 <span class="number">75860</span>FD2</span><br><span class="line"><span class="number">8</span>C8BB2AD B2ECE5A4 EFC08AF2 <span class="number">25</span>A9B864</span><br><span class="line">------ END LICENSE ------​</span><br></pre></td></tr></table></figure><p>测试可用</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sublime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django JWT认证(二)</title>
      <link href="2020/06/19/django-JWT%E8%AE%A4%E8%AF%81-%E4%BA%8C/"/>
      <url>2020/06/19/django-JWT%E8%AE%A4%E8%AF%81-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p>我们在DRF前后端分离的情况使用django-rest-framework-jwt 这个包，这个包需要单独安装。它支持</p><ul><li>Python (2.7, 3.3, 3.4, 3.5, 3.6)</li><li>Django (1.8, 1.9, 1.10, 1.11) # 2.0设置也是没有问题的</li><li>Django REST Framework (3.1, 3.2, 3.3, 3.4, 3.5, 3.6)</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>使用pip安装</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> djangorestframework-jwt</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>安装完jwt后需要settings.py设置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 设置所有接口都需要被验证</span></span><br><span class="line">    <span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (</span><br><span class="line">        <span class="comment">#'rest_framework.permissions.IsAuthenticated',  建议是特定接口特定认证</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="comment"># 用户登陆认证方式</span></span><br><span class="line">    <span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: (</span><br><span class="line">        <span class="string">'rest_framework_jwt.authentication.JSONWebTokenAuthentication'</span>,</span><br><span class="line">        <span class="string">'rest_framework.authentication.SessionAuthentication'</span>,</span><br><span class="line">        <span class="string">'rest_framework.authentication.BasicAuthentication'</span>,</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改urls.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token, refresh_jwt_token</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">r"login"</span>, obtain_jwt_token),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>测试访问</strong></p><img src="/img/20200619113002.png"><p>返回的就是用户的token数据，前端获取到该token存储后携带上，默认token有效期为5分钟</p><p><strong>解析token</strong></p><img src="/img/20200619113409.png"><p><strong>客户端请求</strong></p><p>在headers中带上<code>Authorization JWT &lt;token&gt;</code><br>以postman为例</p><img src="/img/20200619114518.png"><p>如果没有携带后端会提示以下信息</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"detail"</span>: <span class="string">"Authentication credentials were not provided."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JWT设置"><a href="#JWT设置" class="headerlink" title="JWT设置"></a>JWT设置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="comment"># 设置token 有效期</span></span><br><span class="line">    <span class="string">'JWT_EXPIRATION_DELTA'</span>: datetime.timedelta(hours=<span class="number">24</span>),</span><br><span class="line">     <span class="comment">#续期有效期（该设置可在24小时内带未失效的token 进行续期） </span></span><br><span class="line">    <span class="string">'JWT_REFRESH_EXPIRATION_DELTA'</span>: datetime.timedelta(hours=<span class="number">24</span>),</span><br><span class="line">    <span class="comment"># 自定义返回格式，需要手工创建</span></span><br><span class="line">    <span class="string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span>: <span class="string">'utils.jwt.jwt_response_payload_handler'</span>,</span><br><span class="line">    <span class="comment"># 用于令牌和授权标头的另一个常见值是Bearer ,默认是JWT</span></span><br><span class="line">    <span class="string">'JWT_AUTH_HEADER_PREFIX'</span>: <span class="string">'Token:'</span>,</span><br><span class="line">    <span class="comment"># 是否允许刷新</span></span><br><span class="line">    <span class="string">'JWT_ALLOW_REFRESH'</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更详细设置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="string">'JWT_ENCODE_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_encode_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_DECODE_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_decode_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PAYLOAD_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PAYLOAD_GET_USER_ID_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_get_user_id_from_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_response_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_SECRET_KEY'</span>: settings.SECRET_KEY,</span><br><span class="line">    <span class="string">'JWT_GET_USER_SECRET_KEY'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_PUBLIC_KEY'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_PRIVATE_KEY'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_ALGORITHM'</span>: <span class="string">'HS256'</span>,</span><br><span class="line">    <span class="string">'JWT_VERIFY'</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">'JWT_VERIFY_EXPIRATION'</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">'JWT_LEEWAY'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'JWT_EXPIRATION_DELTA'</span>: datetime.timedelta(seconds=<span class="number">300</span>),</span><br><span class="line">    <span class="string">'JWT_AUDIENCE'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_ISSUER'</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_ALLOW_REFRESH'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'JWT_REFRESH_EXPIRATION_DELTA'</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_AUTH_HEADER_PREFIX'</span>: <span class="string">'JWT'</span>,</span><br><span class="line">    <span class="string">'JWT_AUTH_COOKIE'</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义返回数据"><a href="#自定义返回数据" class="headerlink" title="自定义返回数据"></a>自定义返回数据</h3><p>在utils目录下创建jwt.py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span><span class="params">(token, user=None, request=None, role=None)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">"authenticated"</span>: <span class="string">"true"</span>,</span><br><span class="line">        <span class="string">'id'</span>: user.id,</span><br><span class="line">        <span class="string">"role"</span>: role,</span><br><span class="line">        <span class="string">'username'</span>: user.username,</span><br><span class="line">        <span class="string">'email'</span>: user.email,</span><br><span class="line">        <span class="string">'token'</span>: token,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>请求</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"authenticated"</span>: <span class="string">"true"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"role"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">    <span class="attr">"email"</span>: <span class="string">"923401910@qq.com"</span>,</span><br><span class="line">    <span class="attr">"token"</span>: <span class="string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNTkyNjI3ODk3LCJlbWFpbCI6IjkyMzQwMTkxMEBxcS5jb20iLCJvcmlnX2lhdCI6MTU5MjU0MTQ5N30.YBDrPiz0wX6i0lrQwqb5bbHf8wgEIPk5Si598jHQW1A"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="token-续期"><a href="#token-续期" class="headerlink" title="token 续期"></a>token 续期</h3><p>urls.py中加入refresh</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token, refresh_jwt_token</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> <span class="type">path</span>, <span class="keyword">include</span></span><br><span class="line"><span class="keyword">from</span> music.views <span class="keyword">import</span> MusicListView</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'login/'</span>, obtain_jwt_token),</span><br><span class="line">    path(<span class="string">'refresh/'</span>, refresh_jwt_token),</span><br><span class="line">    path(<span class="string">'music/'</span>, MusicListView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>请求使用POST方法并且在BODY中带入token数据</p><h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><ul><li><a href="https://github.com/langubtc/django_jwt_demo" target="_blank" rel="noopener">https://github.com/langubtc/django_jwt_demo</a></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://jpadilla.github.io/django-rest-framework-jwt/" target="_blank" rel="noopener">https://jpadilla.github.io/django-rest-framework-jwt/</a></li><li><a href="https://github.com/jpadilla/django-rest-framework-jwt" target="_blank" rel="noopener">https://github.com/jpadilla/django-rest-framework-jwt</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> jwt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django JWT认证(一)</title>
      <link href="2020/06/18/django-JWT%E8%AE%A4%E8%AF%81-%E4%B8%80/"/>
      <url>2020/06/18/django-JWT%E8%AE%A4%E8%AF%81-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<h3 id="什么是JWT"><a href="#什么是JWT" class="headerlink" title="什么是JWT"></a>什么是JWT</h3><p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p><h3 id="什么时候使用JWT"><a href="#什么时候使用JWT" class="headerlink" title="什么时候使用JWT"></a>什么时候使用JWT</h3><p>我们在什么时候使用JWT呢，通常情况下JWT用于前后端分离的用户认证(Authentication)，后续用户每次请求都在请求上包含JWT，允许用户请求访问相关资源。单点登录(SSO)，是目前广泛使用的JWT的一项功能。JWT是一种无状态请求，它不需要在服务端保留用户的认证信息或会话信息，一个是为了安全，同时也为应用提供扩展提供了便利。</p><h3 id="请求流程"><a href="#请求流程" class="headerlink" title="请求流程"></a>请求流程</h3><ul><li>用户使用原始账户进行登录认证</li><li>服务器验证用户认证信息</li><li>认证通过后返回一个token一用户</li><li>客户端存储token，并在每一个请求上附带这个token ，一般会附加到header请求头中</li><li>服务器验证token，验证通过即返回数据</li></ul><h3 id="JWT结构"><a href="#JWT结构" class="headerlink" title="JWT结构"></a>JWT结构</h3><ul><li>Header(头部信息)</li><li>Payload(请求载荷)</li><li>Signature(签名)</li></ul><p>通常看起来像这样</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">xxxxx</span><span class="selector-class">.yyyyy</span><span class="selector-class">.zzzzz</span></span><br></pre></td></tr></table></figure><p>例子:</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI<span class="number">1</span><span class="symbol">NiIsInR5</span>cCI<span class="number">6</span>IkpX<span class="attr">VCJ9</span>.eyJzdWIiOiIxMj<span class="name">M0</span><span class="symbol">NTY3</span>ODkwIiwibmFtZSI<span class="number">6</span>Ikpva<span class="name">G4</span>gR<span class="name">G9</span>lIiwiaWF<span class="number">0</span>Ijox<span class="symbol">NTE2</span>Mj<span class="name">M5</span>MDIyfQ.SflKxwRJSMeKKF<span class="number">2</span>QT<span class="number">4</span>fwpMeJf<span class="number">36</span>POk<span class="number">6</span>yJV_adQssw<span class="number">5</span>c</span><br></pre></td></tr></table></figure><p>解码JWT可以通过<a href="https://jwt.io" target="_blank" rel="noopener">https://jwt.io</a> 进行解码</p><p>HEADER:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">  <span class="attr">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将以上数据进行base64加密得到第一部分</p><p>PAYLOAD:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"John Doe"</span>,</span><br><span class="line">  <span class="attr">"iat"</span>: <span class="number">1516239022</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将以上数据进行base64加密得到第二部分</p><p>SIGNATURE：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(<span class="name">header</span>) + <span class="string">"."</span> +</span><br><span class="line">  base64UrlEncode(<span class="name">payload</span>),</span><br><span class="line">  </span><br><span class="line">your-256-bit-secret //这里的secret 就是django settings.py 中的 SECRET_KEY 所有这个特别重要</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>SECRET_KEY一定要保存好，如果流出去就会意味者客户端可以自我生成jwt</strong></p><p>签名由三部分组成:</p><ul><li>header (base64后的)</li><li>payload (base64后的)</li><li>secret</li></ul><h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3><p>在用户请求头上加上以下参数</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Authorization:</span> Bearer <span class="params">&lt;token&gt;</span> <span class="comment">//该token由服务端返回</span></span><br></pre></td></tr></table></figure><h3 id="安全提示"><a href="#安全提示" class="headerlink" title="安全提示"></a>安全提示</h3><p>1.由于JWT里面的信息可以解码出来的，基本上任何人都可以阅读(除非有额外加密)，否则不要在JWT中放入重要的信息。<br>2.保存好你的secret</p>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> jwt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 16.4 pip3的安装、升级和卸载</title>
      <link href="2020/06/12/ubuntu-16-04-pip3%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%81%E5%8D%87%E7%BA%A7%E5%92%8C%E5%8D%B8%E8%BD%BD/"/>
      <url>2020/06/12/ubuntu-16-04-pip3%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%81%E5%8D%87%E7%BA%A7%E5%92%8C%E5%8D%B8%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p>安装pip3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-pip</span><br></pre></td></tr></table></figure><p>查看版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/work/# pip3 -V</span><br><span class="line">pip 8.1.1 from /usr/lib/python3/dist-packages (python 3.5)</span><br></pre></td></tr></table></figure><p>升级</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install --upgrade pip</span><br></pre></td></tr></table></figure><p>卸载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/work/btcgwserver# sudo apt-get remove python3-pip</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">The following packages were automatically installed and are no longer required:</span><br><span class="line">  golang-1.6-go golang-1.6-race-detector-runtime golang-1.6-src golang-race-detector-runtime golang-src libpython3-dev libpython3.5-dev python3-dev python3-wheel python3.5-dev</span><br><span class="line">Use 'sudo apt autoremove' to remove them.</span><br><span class="line">The following packages will be REMOVED:</span><br><span class="line">  python3-pip</span><br><span class="line">0 upgraded, 0 newly installed, 1 to remove and 39 not upgraded.</span><br><span class="line">After this operation, 569 kB disk space will be freed.</span><br><span class="line">Do you want to continue? [Y/n] y</span><br><span class="line">(Reading database ... 125477 files and directories currently installed.)</span><br><span class="line">Removing python3-pip (8.1.1-2ubuntu0.4) ...</span><br><span class="line">Processing triggers for man-db (2.7.5-1) ...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 16.4切换python版本优先级</title>
      <link href="2020/06/12/ubuntu-16-04%E5%88%87%E6%8D%A2python%E7%89%88%E6%9C%AC%E4%BC%98%E5%85%88%E7%BA%A7/"/>
      <url>2020/06/12/ubuntu-16-04%E5%88%87%E6%8D%A2python%E7%89%88%E6%9C%AC%E4%BC%98%E5%85%88%E7%BA%A7/</url>
      
        <content type="html"><![CDATA[<p>终端默认使用的是Python2.7，如果需要设置为默认3.5版本，可以在终端运行下面2条命令</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">update</span>-alternatives --install /usr/bin/<span class="keyword">python</span> <span class="keyword">python</span> /usr/bin/python2 <span class="number">100</span></span><br><span class="line"></span><br><span class="line">sudo <span class="keyword">update</span>-alternatives --install /usr/bin/<span class="keyword">python</span> <span class="keyword">python</span> /usr/bin/<span class="keyword">python3</span> <span class="number">150</span></span><br></pre></td></tr></table></figure><p>调整python3的优先级为150后再次在shell中查询python 版本</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~</span><span class="comment"># python -V</span></span><br><span class="line">Python <span class="number">3.5</span>.<span class="number">2</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(六)</title>
      <link href="2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E5%85%AD/"/>
      <url>2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E5%85%AD/</url>
      
        <content type="html"><![CDATA[<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p><strong>重定向到外部</strong><br>使用Redirect()方法，http.StatusMovedPermanently表示http状态吗 301</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求重定向到百度</span></span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/redirect/baidu"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.Redirect(http.StatusMovedPermanently,<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>重定向到内部路由</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由重定向</span></span><br><span class="line">r.GET(<span class="string">"/luyou"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">//跳转到/luyou2对应的路由处理函数</span></span><br><span class="line">c.Request.URL.Path = <span class="string">"/router/info"</span>  <span class="comment">//把请求的URL修改</span></span><br><span class="line">r.HandleContext(c)  <span class="comment">//继续后续处理</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="上传单个文件"><a href="#上传单个文件" class="headerlink" title="上传单个文件"></a>上传单个文件</h3><p>上传单个文件并存在当前目录下upload。使用FormFile 接收前端的文件，后端使用SaveUploadedFile保存到本地。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传文件</span></span><br><span class="line">r.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">file,err := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError,gin.H&#123;</span><br><span class="line"><span class="string">"message"</span>:err.Error(),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log.Print(file.Filename)</span><br><span class="line">dst := fmt.Sprintf(<span class="string">"./upload/%s"</span>,file.Filename)</span><br><span class="line">c.SaveUploadedFile(file,dst)</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"message"</span>:fmt.Sprintf(<span class="string">"'%s' uploaded!"</span>,file.Filename),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; template "base"&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; define "content"&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        server page &#123;&#123; .username  &#125;&#125; &#123;&#123; .password&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/upload"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="上传多个文件"><a href="#上传多个文件" class="headerlink" title="上传多个文件"></a>上传多个文件</h3><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>Gin路由系统用于接收用户请求，并将请求分发到中间件或请求处理器来进行处理。</p><p>常见的请求方法:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.GET()</span><br><span class="line">router.PATCH()</span><br><span class="line">router.POST()</span><br><span class="line">router.DELETE()</span><br><span class="line">router.PUT()</span><br><span class="line">router.ANY()</span><br></pre></td></tr></table></figure><p>创建默认路由引擎</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gin.Default()</span><br></pre></td></tr></table></figure><p>参考实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">        <span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run() <span class="comment">// 监听并在 0.0.0.0:8080 上启动服务</span></span><br></pre></td></tr></table></figure><h3 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h3><p>使用Group方法定义一个路由组，由组来定义组下面的路由请求。请求方式如/router/info，/router/news 就会匹配到该路由组中。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由组</span></span><br><span class="line">NewRouter := r.Group(<span class="string">"/router"</span>)</span><br><span class="line">&#123;</span><br><span class="line">NewRouter.GET(<span class="string">"info"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"path"</span>:<span class="string">"info"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">NewRouter.GET(<span class="string">"news"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"path"</span>:<span class="string">"news"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>嵌套路由组比如/router/users/list</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由组</span></span><br><span class="line">NewRouter := r.Group(<span class="string">"/router"</span>)</span><br><span class="line">&#123;</span><br><span class="line">NewRouter.GET(<span class="string">"info"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"path"</span>:<span class="string">"info"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">NewRouter.GET(<span class="string">"news"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"path"</span>:<span class="string">"news"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//嵌套路由</span></span><br><span class="line">UserRouter := r.Group(<span class="string">"user"</span>)</span><br><span class="line"></span><br><span class="line">UserRouter.GET(<span class="string">"list"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"path"</span>:<span class="string">"list"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="404路由"><a href="#404路由" class="headerlink" title="404路由"></a>404路由</h3><p>使用NoRoute识别404 URL</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r.NoRoute(<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"status"</span>:<span class="string">"404"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(五)</title>
      <link href="2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%BA%94/"/>
      <url>2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%BA%94/</url>
      
        <content type="html"><![CDATA[<h3 id="URL路径参数"><a href="#URL路径参数" class="headerlink" title="URL路径参数"></a>URL路径参数</h3><p>在web开发中经常见如下列表,那在gin中可以对这些path参数进行识别<br>/video/223232/02<br>/blog/2020/02/02</p><p>使用方法在path上什么/blog/:xxx/:xxx,注意千万不要直接写成/:xxx/:xxx。这样其它请求会匹配到。然后什么<code>Param()</code>方法获取值.</p><p>参考样例:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/blog/:year/:month"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">year := c.Param(<span class="string">"year"</span>)</span><br><span class="line">month := c.Param(<span class="string">"month"</span>)</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"year"</span>:year,</span><br><span class="line"><span class="string">"month"</span>:month,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>访问<br><img src="/img/20200610150747.png"></p><h3 id="ShouldBind数据绑定"><a href="#ShouldBind数据绑定" class="headerlink" title="ShouldBind数据绑定"></a>ShouldBind数据绑定</h3><p>获取参数的方式还有一种，就是将参数绑定到结构上，使用ShouldBind，还有一个ShouldBindQuery方法,该方法只绑定参数，不返回参数的数据。也就是说只输出key。</p><p>解析前端通过json传递过来的数据参数，绑定到结构体然后去访问，如果没有传递数值默认为空。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">Username <span class="keyword">string</span> <span class="string">`json:"username"`</span></span><br><span class="line">Password <span class="keyword">string</span><span class="string">`json:"password"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// shouldbind数据绑定</span></span><br><span class="line">r.POST(<span class="string">"/json2"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> u UserInfo</span><br><span class="line"></span><br><span class="line">err :=c.ShouldBind(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line"><span class="string">"error"</span>:err.Error(),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line"><span class="string">"status"</span>:<span class="string">"ok"</span>,</span><br><span class="line"><span class="string">"username"</span>:u.Username,</span><br><span class="line"><span class="string">"password"</span>:u.Password,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>此外可以使用框架自带的验证方法，使username and password为必填</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">Username <span class="keyword">string</span> <span class="string">`json:"username"  binding:"required"`</span></span><br><span class="line">Password <span class="keyword">string</span><span class="string">`json:"password"  binding:"required"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果前端不填写数据则会提示如下错误</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"Key: 'UserInfo.Username' Error:Field validation for 'Username' failed on the 'required' tag"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(四)</title>
      <link href="2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E5%9B%9B/"/>
      <url>2020/06/10/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E5%9B%9B/</url>
      
        <content type="html"><![CDATA[<h3 id="获取GET参数"><a href="#获取GET参数" class="headerlink" title="获取GET参数"></a>获取GET参数</h3><p><strong>获取参数</strong></p><p>使用Query()方法，如果没有name查询关键字，那就为空。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/server"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">queryName := c.Query(<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:queryName,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>默认参数</strong></p><p>使用DefaultQuery，如果没获取到name默认值就为”default”</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/server"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">queryName := c.DefaultQuery(<span class="string">"name"</span>,<span class="string">"default"</span>)</span><br><span class="line">queryAge := c.DefaultQuery(<span class="string">"age"</span>,<span class="string">"18"</span>)</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:queryName,</span><br><span class="line"><span class="string">"age"</span>:queryAge,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>判断请求参数</strong><br>使用GetQuery()方法判断是否有该参数，返回两个值，一个是值，另一个是状态。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">query,ok := c.GetQuery(<span class="string">"queryName"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ok == <span class="literal">false</span>&#123;</span><br><span class="line">query = <span class="string">"123"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">GetQuery</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> values, ok := c.GetQueryArray(key); ok &#123;</span><br><span class="line"><span class="keyword">return</span> values[<span class="number">0</span>], ok</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>, <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>url请求</strong></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1:8001/server?name=roddy&amp;age=29</span></span><br></pre></td></tr></table></figure><h3 id="获取form表单参数"><a href="#获取form表单参数" class="headerlink" title="获取form表单参数"></a>获取form表单参数</h3><p><strong>PostForm</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/login"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"login"</span>,<span class="literal">nil</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.POST(<span class="string">"/login"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">username := c.PostForm(<span class="string">"username"</span>)</span><br><span class="line">password := c.PostForm(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"username"</span>:username,</span><br><span class="line"><span class="string">"password"</span>:password,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; template "base"&#125;&#125; </span><br><span class="line"></span><br><span class="line">&#123;&#123; define "content"&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>DefaultPostForm</strong></p><p>如果获取不到key，设置默认值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username := c.DefaultPostForm(<span class="string">"username1"</span>,<span class="string">"roddy"</span>)</span><br><span class="line">password := c.DefaultPostForm(<span class="string">"password1"</span>,<span class="string">"pass"</span>)</span><br></pre></td></tr></table></figure><p><strong>GetPostForm</strong><br>如果没有获取到值，那设置一个默认值</p><p>其中GetPostForm判断的三种状态</p><ul><li>1.如果有key并且有值 返回值和true</li><li>2.如果有key没值，返回空和true</li><li>3.如果没key没值，返回空和false</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// For example, during a PATCH request to update the user's email:</span></span><br><span class="line"><span class="comment">//     email=mail@example.com  --&gt;  ("mail@example.com", true) := GetPostForm("email") // set email to "mail@example.com"</span></span><br><span class="line"><span class="comment">//    email=                  --&gt;  ("", true) := GetPostForm("email") // set email to ""</span></span><br><span class="line"><span class="comment">//                             --&gt;  ("", false) := GetPostForm("email") // do nothing with email</span></span><br><span class="line"></span><br><span class="line">r.POST(<span class="string">"/login"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">username,ok := c.GetPostForm(<span class="string">"username"</span>)</span><br><span class="line"><span class="keyword">if</span> username == <span class="string">""</span>&#123;</span><br><span class="line">username=<span class="string">"rrr"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">password,ok := c.GetPostForm(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(username,password,ok)</span><br><span class="line"><span class="keyword">if</span> password==<span class="string">""</span>&#123;</span><br><span class="line">password=<span class="string">"xxxxx"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(username,password)</span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"username"</span>:username,</span><br><span class="line"><span class="string">"password"</span>:password,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(三)</title>
      <link href="2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%89/"/>
      <url>2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%89/</url>
      
        <content type="html"><![CDATA[<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>使用模版开发web站点就离不开css,js,img这些静态文件，在gin中也一样可以定义静态文件及使用方法。gin是如何做的呢？</p><p>gin 可使用Static、StaticFile、StaticFS方法定义静态文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载静态资源，例如网页的css、js</span></span><br><span class="line">r.Static(<span class="string">"/static"</span>, <span class="string">"./statics"</span>)    <span class="comment">//默认gin http 访问的static路径，statics是映射的实际目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加载静态资源，一般是上传的资源，例如用户上传的图片</span></span><br><span class="line">r.StaticFS(<span class="string">"/upload"</span>, http.Dir(<span class="string">"upload"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//加载单个静态文件</span></span><br><span class="line">r.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"./static/favicon.ico"</span>)</span><br></pre></td></tr></table></figure><p>参考实例:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"html/template"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"><span class="comment">//自定义模版变量必须放在解析模版之前</span></span><br><span class="line">r.SetFuncMap(template.FuncMap&#123;</span><br><span class="line"><span class="string">"safe"</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">template</span>.<span class="title">HTML</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> template.HTML(str)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载静态文件,以static开头指向statics</span></span><br><span class="line">r.Static(<span class="string">"/static"</span>,<span class="string">"./statics"</span>)</span><br><span class="line"><span class="comment">// 加载单一文件</span></span><br><span class="line">r.StaticFile(<span class="string">"/favicon.ico"</span>,<span class="string">"./statics/favicon.ico"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//r.LoadHTMLFiles("templates")  //模版渲染 如果只有一层的情况下</span></span><br><span class="line">r.LoadHTMLGlob(<span class="string">"templates/**/*"</span>)  <span class="comment">//**表示文件夹/*表示文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/server"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">"127.0.0.1:8001"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>html代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/server.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        server page  &#123;&#123; .name |safe &#125;&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="模版继承"><a href="#模版继承" class="headerlink" title="模版继承"></a>模版继承</h3><p>Gin 框架下使用的模板都是单文件模板,多模板继承需要使用 第三方的包<code>multitemplate</code></p><p><strong>安装</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/gin-contrib/multitemplate</span><br></pre></td></tr></table></figure><p><strong>使用</strong></p><p>创建构建多模版方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webRender</span><span class="params">()</span> <span class="title">multitemplate</span>.<span class="title">Renderer</span></span> &#123;</span><br><span class="line">r := multitemplate.NewRenderer()</span><br><span class="line"><span class="comment">// 添加两个多模板继承, 初始模板必须写在前面。</span></span><br><span class="line">r.AddFromFiles(<span class="string">"server"</span>, <span class="string">"templates/base.html"</span>, <span class="string">"templates/server.html"</span>)</span><br><span class="line">r.AddFromFiles(<span class="string">"login"</span>, <span class="string">"templates/base.html"</span>, <span class="string">"templates/login.html"</span>)</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//此时渲染模版使用HTMLRender方法</span></span><br><span class="line"><span class="comment">//使用模版</span></span><br><span class="line">r.HTMLRender=webRender()</span><br></pre></td></tr></table></figure><p>html使用block定义 ，这点与django有点类似。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span>&gt;</span>baidu<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     &#123;&#123; block "content" . &#125;&#125; &#123;&#123; end &#125;&#125;</span><br></pre></td></tr></table></figure><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; template "base"&#125;&#125; </span><br><span class="line"></span><br><span class="line">&#123;&#123; define "content"&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        login page &#123;&#123;.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><p>server.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; template "base"&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; define "content"&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        server page &#123;&#123;.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><p>golang实例:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-contrib/multitemplate"</span></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"html/template"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webRender</span><span class="params">()</span> <span class="title">multitemplate</span>.<span class="title">Renderer</span></span> &#123;</span><br><span class="line">r := multitemplate.NewRenderer()</span><br><span class="line"><span class="comment">// 添加两个多模板继承, 初始模板必须写在前面。</span></span><br><span class="line">r.AddFromFiles(<span class="string">"server"</span>, <span class="string">"templates/base.html"</span>, <span class="string">"templates/server.html"</span>)</span><br><span class="line">r.AddFromFiles(<span class="string">"login"</span>, <span class="string">"templates/base.html"</span>, <span class="string">"templates/login.html"</span>)</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"><span class="comment">//自定义模版变量必须放在解析模版之前</span></span><br><span class="line">r.SetFuncMap(template.FuncMap&#123;</span><br><span class="line"><span class="string">"safe"</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">template</span>.<span class="title">HTML</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> template.HTML(str)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载静态文件,以static开头指向statics</span></span><br><span class="line">r.Static(<span class="string">"/static"</span>,<span class="string">"./statics"</span>)</span><br><span class="line">r.StaticFile(<span class="string">"/favicon.ico"</span>,<span class="string">"./statics/favicon.ico"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//r.LoadHTMLFiles("templates")  //模版渲染 如果只有一层的情况下</span></span><br><span class="line"><span class="comment">//r.LoadHTMLGlob("templates/**/*")  //**表示文件夹/*表示文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用模版</span></span><br><span class="line">r.HTMLRender=webRender()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/server"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"server"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/login"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">c.HTML(http.StatusOK,<span class="string">"login"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// json数据</span></span><br><span class="line">r.GET(<span class="string">"/json"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">data := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line"><span class="string">"message"</span>:<span class="string">"hello world!"</span>,</span><br><span class="line"><span class="string">"age"</span>:<span class="number">28</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK,data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体方式返回json数据</span></span><br><span class="line">r.GET(<span class="string">"/structJson"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"><span class="keyword">type</span> Msg <span class="keyword">struct</span>&#123;</span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">Age <span class="keyword">int</span></span><br><span class="line">Message <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">data := Msg&#123;<span class="string">"roddy"</span>,<span class="number">23</span>,<span class="string">"this is "</span>&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK,data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">"127.0.0.1:8001"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><img src="/img/20200609215711.png"><h3 id="github代码"><a href="#github代码" class="headerlink" title="github代码"></a>github代码</h3><ul><li><a href="https://github.com/langubtc/ginweb" target="_blank" rel="noopener">https://github.com/langubtc/ginweb</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(二)</title>
      <link href="2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%BA%8C/"/>
      <url>2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="Gin渲染"><a href="#Gin渲染" class="headerlink" title="Gin渲染"></a>Gin渲染</h3><p>Gin支持各种渲染方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">c.String()   <span class="comment">//返回字符串</span></span><br><span class="line">c.XML()  <span class="comment">//返回XML格式</span></span><br><span class="line">c.JSON() <span class="comment">//返回JSON数据格式</span></span><br><span class="line">c.HTML() <span class="comment">//返回HTML文档格式</span></span><br></pre></td></tr></table></figure><h3 id="模版"><a href="#模版" class="headerlink" title="模版"></a>模版</h3><p>通常情况下使用Gin一般是用于写API接口，那另一个就是使用模版渲染。API通常用JSON数据返回即可，如果要用模版渲染就要使用HTML方式。<br>gin的模版文件比较简单，在工作目录下创建一个index.html即可，也可以使用go的模版文件命名index.tmpl。</p><p>参考项目代码:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">r:=gin.Default()</span><br><span class="line">r.LoadHTMLFiles(<span class="string">"index.html"</span>)</span><br><span class="line">r.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"index.html"</span>,<span class="literal">nil</span>)</span><br><span class="line">&#125;)</span><br><span class="line">http.ListenAndServe(<span class="string">":8003"</span>,r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码首先创建了index.html的模版<br>通过r.LoadHTMLFiles加载这个文件，只有加载后才能使用模版<br>渲染模版context.HTML(200,”index.html”,nil)  nil表示不需要向模版传递变量，设置就可以向模版数据</p><h3 id="模版变量"><a href="#模版变量" class="headerlink" title="模版变量"></a>模版变量</h3><p>上面我们提到了可以向模版传递变量，现在传递一个测试下</p><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    hello world  my &#123;&#123;.&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>传递变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">r:=gin.Default()</span><br><span class="line">r.LoadHTMLFiles(<span class="string">"index.html"</span>)  <span class="comment">//r.LoadHTMLFiles("index.html","user.html")加载多个模版</span></span><br><span class="line">r.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"index.html"</span>,<span class="string">"name is roddy"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">":8003"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>传递多个变量</p><p>使用gin.H, <code>H is a shortcut for map[string]interface{}</code></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span> &#123;</span></span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"index.html"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line"><span class="string">"age"</span>:<span class="number">29</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>模版使用  使用.”变量名”,如果使用{{.}}返回渲染的数据，interface对象</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    hello world  my name &#123;&#123;.name&#125;&#125; age &#123;&#123; .age&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>访问请求<br><img src="/img/20200609173549.png"></p><h3 id="加载目录"><a href="#加载目录" class="headerlink" title="加载目录"></a>加载目录</h3><p>r.LoadHTMLFiles 可以加载多个模版文件，但是如果想加载一个目录下的所有模版文件如何设置呢？Gin提供了<code>LoadHTMLGlob</code>方法即可。<br>创建一个templates并将html文件移动到该目录下</p><p>修改代码如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r:=gin.Default()</span><br><span class="line">r.LoadHTMLGlob(<span class="string">"template/*"</span>)</span><br></pre></td></tr></table></figure><p>参考实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">r:=gin.Default()</span><br><span class="line">r.LoadHTMLGlob(<span class="string">"templates/*"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"index.html"</span>,gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line"><span class="string">"age"</span>:<span class="number">29</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"user.html"</span>,<span class="literal">nil</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">":8003"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>加载子目录</strong></p><p>如果你的模版是类似这样的</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">templates/<span class="keyword">user</span>/<span class="keyword">index</span>.html</span><br><span class="line">templates/<span class="keyword">admin</span>/<span class="keyword">index</span>.html</span><br><span class="line">templates/product/<span class="keyword">index</span>.html</span><br></pre></td></tr></table></figure><p>使用<code>**/*</code>加载多级模版</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.LoadHTMLGlob(<span class="string">"templates/**/*"</span>)</span><br></pre></td></tr></table></figure><h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><p>在html模版中默认的模版功能有时候可能不能满足我们的需求，这个时候我们需要自定一个函数解决，下面演示两个功能。一个是将string格式化成html格式，一个是md5</p><p>使用<code>r.SetFuncMap()</code>方法</p><p>实例一:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">r := gin.Default()</span><br><span class="line"><span class="comment">//自定义模版变量必须放在解析模版之前</span></span><br><span class="line">r.SetFuncMap(template.FuncMap&#123;</span><br><span class="line"><span class="string">"safe"</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">template</span>.<span class="title">HTML</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> template.HTML(str)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.LoadHTMLGlob(<span class="string">"templates/*"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//r.LoadHTMLFiles("user.html")</span></span><br><span class="line">r.GET(<span class="string">"/user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">context.HTML(<span class="number">200</span>,<span class="string">"user.html"</span>,<span class="string">"&lt;a href='xxxx'&gt;herf&lt;/a&gt;"</span>) <span class="comment">//将字符串标签格式成html格式</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>This Is User Page &#123;&#123; . |safe &#125;&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span> //使用</span><br></pre></td></tr></table></figure><p>实例二：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r.SetFuncMap(template.FuncMap&#123;</span><br><span class="line"><span class="string">"safe"</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">template</span>.<span class="title">HTML</span></span>&#123;   <span class="comment">//这里可以添加多个自定义变量</span></span><br><span class="line"><span class="keyword">return</span> template.HTML(str)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"md5"</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>,error)</span></span>&#123;</span><br><span class="line">hash:= md5.Sum([]<span class="keyword">byte</span>(str))</span><br><span class="line"><span class="keyword">return</span> hex.EncodeToString(hash[:]),<span class="literal">nil</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; md5 .name&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="返回JSON数据"><a href="#返回JSON数据" class="headerlink" title="返回JSON数据"></a>返回JSON数据</h3><p>很多时候我们需要返回JSON数据给前端，那么可使用JSON渲染。</p><p><strong>1.方法一</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// json数据</span></span><br><span class="line">r.GET(<span class="string">"/json"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">data := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">"roddy"</span>,</span><br><span class="line"><span class="string">"message"</span>:<span class="string">"hello world!"</span>,</span><br><span class="line"><span class="string">"age"</span>:<span class="number">28</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK,data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>2.方法二</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以结构体返回json数据</span></span><br><span class="line">r.GET(<span class="string">"/structJson"</span>,<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line"><span class="keyword">type</span> Msg <span class="keyword">struct</span>&#123;</span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">Age <span class="keyword">int</span></span><br><span class="line">Message <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化结构体数据</span></span><br><span class="line">data := Msg&#123;<span class="string">"roddy"</span>,<span class="number">23</span>,<span class="string">"this is "</span>&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK,data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin web开发系列(一)</title>
      <link href="2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%80/"/>
      <url>2020/06/09/Gin-web%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<h3 id="Gin介绍"><a href="#Gin介绍" class="headerlink" title="Gin介绍"></a>Gin介绍</h3><p>最近在学习Golang，顺带研究下Golang的web框架。目前选择轻量级，也是比较流行的web框架的Gin。<br>官方介绍：Gin 是一个 Go (Golang) 语言框架。 它是一个拥有更好性能的 martini-like API 框架, 由于 httprouter，速度提高了近 40 倍。 如果你是性能和高效的追求者, 那么你会爱上 Gin。</p><h3 id="Gin安装"><a href="#Gin安装" class="headerlink" title="Gin安装"></a>Gin安装</h3><p>1.安装gin</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><p>2.将gin添加到代码中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>3.初始化gin web引擎</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := gin.Default()</span><br></pre></td></tr></table></figure><p>4.配置方法和路由</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r.GET(<span class="string">"/path"</span>)</span><br><span class="line">r.POST(<span class="string">"/path"</span>)</span><br><span class="line">r.PUT(<span class="string">"/path"</span>)</span><br></pre></td></tr></table></figure><p>5.启动</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.Run()  <span class="comment">//除了Run()方法还可以使用http.ListenAndServe方法</span></span><br></pre></td></tr></table></figure><p>参考</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r:=gin.Default()</span><br><span class="line"></span><br><span class="line">http.ListenAndServe(<span class="string">":8003"</span>,r)</span><br></pre></td></tr></table></figure><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p>参考样例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloHandler</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">c.String(<span class="number">200</span>,<span class="string">"Hello world"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r:=gin.Default()</span><br><span class="line">r.GET(<span class="string">"/index"</span>,HelloHandler)</span><br><span class="line">r.Run(<span class="string">":8002"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果内容不是较为复杂，可使用匿名函数写法</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r:=gin.<span class="type">Default</span>()</span><br><span class="line">r.<span class="type">GET</span>(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(<span class="built_in">c</span> *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="built_in">c</span>.<span class="type">String</span>(<span class="number">200</span>,<span class="string">"New Hello world"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.<span class="type">Run</span>(<span class="string">":8002"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问结果</p><img src="/img/20200609165112.png"><h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul><li><a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">https://github.com/gin-gonic/gin</a></li><li><a href="https://gin-gonic.com" target="_blank" rel="noopener">https://gin-gonic.com</a></li><li><a href="https://gin-gonic.com/zh-cn/doc" target="_blank" rel="noopener">https://gin-gonic.com/zh-cn/doc</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang  报错mismatched types Duration and int</title>
      <link href="2020/06/04/golang-%E6%8A%A5%E9%94%99mismatched-types-Duration-and-int/"/>
      <url>2020/06/04/golang-%E6%8A%A5%E9%94%99mismatched-types-Duration-and-int/</url>
      
        <content type="html"><![CDATA[<p>今天在使用time.sleep方法时遇到如下问题</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mismatched types <span class="built_in">Duration</span> and <span class="built_in">int</span></span><br></pre></td></tr></table></figure><p>代码如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.Sleep(time.Second * <span class="keyword">int</span>(refersh))  <span class="comment">//我将原来的5秒改成变量</span></span><br></pre></td></tr></table></figure><p>以上信息表示说是int类型而不是time.Duration类型。</p><p>解决方法:</p><p>使用time.Duration()进行转换<br>参考time.go源码第654行</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//fmt.Print(<span class="built_in">time</span>.Duration(<span class="built_in">seconds</span>)*<span class="built_in">time</span>.Second)<span class="comment"> // prints 10s</span></span><br></pre></td></tr></table></figure><p>修改后的代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">time.Sleep(time.Second * time.Duration(refersh))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go 连接mysql 报错sql: unknown driver mysql (forgotten import?)</title>
      <link href="2020/06/03/go-%E8%BF%9E%E6%8E%A5mysql-%E6%8A%A5%E9%94%99sql-unknown-driver-mysql-forgotten-import/"/>
      <url>2020/06/03/go-%E8%BF%9E%E6%8E%A5mysql-%E6%8A%A5%E9%94%99sql-unknown-driver-mysql-forgotten-import/</url>
      
        <content type="html"><![CDATA[<h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span>: <span class="type">unknown</span> driver "mysql" (forgotten <span class="keyword">import</span>?)</span><br></pre></td></tr></table></figure><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>需要在import中加入如下行</p><pre><code>_ &quot;github.com/go-sql-driver/mysql&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu下编译安装Bitcoin核心</title>
      <link href="2020/05/29/ubuntu%E4%B8%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Bitcoin%E6%A0%B8%E5%BF%83/"/>
      <url>2020/05/29/ubuntu%E4%B8%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Bitcoin%E6%A0%B8%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>ubuntu | 16.04<br>disk   | 500GB<br>net    | 2M<br>cpu    | 4<br>mem    | 8G</p><h3 id="初始化服务器"><a href="#初始化服务器" class="headerlink" title="初始化服务器"></a>初始化服务器</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> upgrade</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install lrzsz  git  wget </span><br><span class="line">mkdir /work</span><br></pre></td></tr></table></figure><h3 id="安装环境依赖"><a href="#安装环境依赖" class="headerlink" title="安装环境依赖"></a>安装环境依赖</h3><p>执行以下命令安装环境依赖包</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-<span class="built_in">get</span> install build-essential libtool autotools-<span class="built_in">dev</span> automake pkg-config bsdmainutils python3 libssl-<span class="built_in">dev</span></span><br><span class="line"></span><br><span class="line">sudo apt-<span class="built_in">get</span> install libssl-<span class="built_in">dev</span> libboost-<span class="built_in">all</span>-<span class="built_in">dev</span> libevent-<span class="built_in">dev</span></span><br><span class="line"></span><br><span class="line">sudo apt-<span class="built_in">get</span> install libqt5gui5 libqt5core5a libqt5dbus5 qttools5-<span class="built_in">dev</span> qttools5-<span class="built_in">dev</span>-tools libprotobuf-<span class="built_in">dev</span> protobuf-compiler</span><br><span class="line"></span><br><span class="line">sudo apt-<span class="built_in">get</span> install libqrencode-<span class="built_in">dev</span> libminiupnpc-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><h3 id="下载bitcoin核心"><a href="#下载bitcoin核心" class="headerlink" title="下载bitcoin核心"></a>下载bitcoin核心</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /work</span><br><span class="line">wget https:<span class="comment">//github.com/bitcoin/bitcoin/archive/v0.19.1.tar.gz</span></span><br><span class="line">tar zxf v0<span class="number">.19</span><span class="number">.1</span>.tar.gz</span><br></pre></td></tr></table></figure><h3 id="安装berkeley-db"><a href="#安装berkeley-db" class="headerlink" title="安装berkeley-db"></a>安装berkeley-db</h3><p>因我项目中核心需要钱包功能，所以需要安装berkeley-db,如果不需要可以编译bitcoin时使用<code>./configure --disable-wallet</code></p><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> bitcoin-0.19.1</span><br><span class="line"><span class="string">./contrib/install_db4.sh</span> `<span class="keyword">pwd</span>`</span><br></pre></td></tr></table></figure><p>如果执行失败,出现国内服务器无法访问<a href="https://gist.githubusercontent.com的情况下可手动下载clang.patch进行打补丁" target="_blank" rel="noopener">https://gist.githubusercontent.com的情况下可手动下载clang.patch进行打补丁</a></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//gist.githubusercontent.com/LnL7/5153b251fd525fe15de69b67e63a6075/raw/7778e9364679093a32dec2908656738e16b6bdcb/clang.patch</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#编辑./contrib/install_db4.sh第70行屏蔽掉下载</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#http_get <span class="string">"$&#123;CLANG_CXX11_PATCH_URL&#125;"</span> clang.patch <span class="string">"$&#123;CLANG_CXX11_PATCH_HASH&#125;"</span></span></span><br></pre></td></tr></table></figure><p>可手动复制以下文件为clang.patch到/work/bitcoin-0.19.1/db4/db-4.8.30.NC/</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/src/dbinc/atomic.h b/src/dbinc/atomic.h</span><br><span class="line">index <span class="number">6</span>a858f7.<span class="number">.9</span>f338dc <span class="number">100644</span></span><br><span class="line">--- a/src/dbinc/atomic.h</span><br><span class="line">+++ b/src/dbinc/atomic.h</span><br><span class="line">@@ <span class="number">-70</span>,<span class="number">7</span> +<span class="number">70</span>,<span class="number">7</span> @@ <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  * These have no memory barriers; the caller must include them when necessary.</span><br><span class="line">  */</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">define</span>atomic_read(p)((p)-&gt;value)</span></span><br><span class="line">-<span class="meta">#<span class="meta-keyword">define</span>atomic_init(p, val)((p)-&gt;value = (val))</span></span><br><span class="line">+<span class="meta">#<span class="meta-keyword">define</span>atomic_init_db(p, val)((p)-&gt;value = (val))</span></span><br><span class="line"> </span><br><span class="line"> <span class="meta">#<span class="meta-keyword">ifdef</span> HAVE_ATOMIC_SUPPORT</span></span><br><span class="line"> </span><br><span class="line">@@ <span class="number">-144</span>,<span class="number">7</span> +<span class="number">144</span>,<span class="number">7</span> @@ <span class="keyword">typedef</span> LONG <span class="keyword">volatile</span> *interlocked_val;</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">define</span>atomic_inc(env, p)__atomic_inc(p)</span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">define</span>atomic_dec(env, p)__atomic_dec(p)</span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">define</span>atomic_compare_exchange(env, p, o, n)\</span></span><br><span class="line">-__atomic_compare_exchange((p), (o), (n))</span><br><span class="line">+__atomic_compare_exchange_db((p), (o), (n))</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __atomic_inc(<span class="keyword">db_atomic_t</span> *p)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">int</span>temp;</span><br><span class="line">@@ <span class="number">-176</span>,<span class="number">7</span> +<span class="number">176</span>,<span class="number">7</span> @@ <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __atomic_dec(<span class="keyword">db_atomic_t</span> *p)</span><br><span class="line">  * http:<span class="comment">//gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html</span></span><br><span class="line">  * which configure could be changed to use.</span><br><span class="line">  */</span><br><span class="line">-<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __atomic_compare_exchange(</span><br><span class="line">+<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __atomic_compare_exchange_db(</span><br><span class="line"> <span class="keyword">db_atomic_t</span> *p, <span class="keyword">atomic_value_t</span> oldval, <span class="keyword">atomic_value_t</span> newval)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">atomic_value_t</span> was;</span><br><span class="line">@@ <span class="number">-206</span>,<span class="number">7</span> +<span class="number">206</span>,<span class="number">7</span> @@ <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __atomic_compare_exchange(</span><br><span class="line"> #defineatomic_dec(env, p)(--(p)-&gt;value)</span><br><span class="line"> #defineatomic_compare_exchange(env, p, oldval, newval)\</span><br><span class="line"> (DB_ASSERT(env, atomic_read(p) == (oldval)),\</span><br><span class="line">-atomic_init(p, (newval)), <span class="number">1</span>)</span><br><span class="line">+atomic_init_db(p, (newval)), <span class="number">1</span>)</span><br><span class="line"> #<span class="keyword">else</span></span><br><span class="line"> #define atomic_inc(env, p)__atomic_inc(env, p)</span><br><span class="line"> #define atomic_dec(env, p)__atomic_dec(env, p)</span><br><span class="line">diff --git a/src/mp/mp_fget.c b/src/mp/mp_fget.c</span><br><span class="line">index <span class="number">16</span>de695..d0dcc29 <span class="number">100644</span></span><br><span class="line">--- a/src/mp/mp_fget.c</span><br><span class="line">+++ b/src/mp/mp_fget.c</span><br><span class="line">@@ <span class="number">-649</span>,<span class="number">7</span> +<span class="number">649</span>,<span class="number">7</span> @@ alloc:<span class="comment">/* Allocate a new buffer header and data space. */</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">/* Initialize enough so we can call __memp_bhfree. */</span></span><br><span class="line"> alloc_bhp-&gt;flags = <span class="number">0</span>;</span><br><span class="line">-atomic_init(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line">+atomic_init_db(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line"> #ifdef DIAGNOSTIC</span><br><span class="line"> <span class="keyword">if</span> ((<span class="keyword">uintptr_t</span>)alloc_bhp-&gt;buf &amp; (<span class="keyword">sizeof</span>(<span class="keyword">size_t</span>) - <span class="number">1</span>)) &#123;</span><br><span class="line"> __db_errx(env, DB_STR(<span class="string">"3025"</span>,</span><br><span class="line">@@ <span class="number">-955</span>,<span class="number">7</span> +<span class="number">955</span>,<span class="number">7</span> @@ alloc:<span class="comment">/* Allocate a new buffer header and data space. */</span></span><br><span class="line"> MVCC_MPROTECT(bhp-&gt;buf, mfp-&gt;pagesize,</span><br><span class="line">     PROT_READ);</span><br><span class="line"> </span><br><span class="line">-atomic_init(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line">+atomic_init_db(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line"> MUTEX_LOCK(env, alloc_bhp-&gt;mtx_buf);</span><br><span class="line"> alloc_bhp-&gt;priority = bhp-&gt;priority;</span><br><span class="line"> alloc_bhp-&gt;pgno = bhp-&gt;pgno;</span><br><span class="line">diff --git a/src/mp/mp_mvcc.c b/src/mp/mp_mvcc.c</span><br><span class="line">index <span class="number">770b</span>ad8..e28cce0 <span class="number">100644</span></span><br><span class="line">--- a/src/mp/mp_mvcc.c</span><br><span class="line">+++ b/src/mp/mp_mvcc.c</span><br><span class="line">@@ <span class="number">-276</span>,<span class="number">7</span> +<span class="number">276</span>,<span class="number">7</span> @@ __memp_bh_freeze(dbmp, infop, hp, bhp, need_frozenp)</span><br><span class="line"> #<span class="keyword">else</span></span><br><span class="line"> <span class="built_in">memcpy</span>(frozen_bhp, bhp, SSZA(BH, buf));</span><br><span class="line"> #endif</span><br><span class="line">-atomic_init(&amp;frozen_bhp-&gt;ref, <span class="number">0</span>);</span><br><span class="line">+atomic_init_db(&amp;frozen_bhp-&gt;ref, <span class="number">0</span>);</span><br><span class="line"> <span class="keyword">if</span> (mutex != MUTEX_INVALID)</span><br><span class="line"> frozen_bhp-&gt;mtx_buf = mutex;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> ((ret = __mutex_alloc(env, MTX_MPOOL_BH,</span><br><span class="line">@@ <span class="number">-428</span>,<span class="number">7</span> +<span class="number">428</span>,<span class="number">7</span> @@ __memp_bh_thaw(dbmp, infop, hp, frozen_bhp, alloc_bhp)</span><br><span class="line"> #endif</span><br><span class="line"> alloc_bhp-&gt;mtx_buf = mutex;</span><br><span class="line"> MUTEX_LOCK(env, alloc_bhp-&gt;mtx_buf);</span><br><span class="line">-atomic_init(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line">+atomic_init_db(&amp;alloc_bhp-&gt;ref, <span class="number">1</span>);</span><br><span class="line"> F_CLR(alloc_bhp, BH_FROZEN);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">diff --git a/src/mp/mp_region.c b/src/mp/mp_region.c</span><br><span class="line">index <span class="number">4952030.</span><span class="number">.47645</span>f8 <span class="number">100644</span></span><br><span class="line">--- a/src/mp/mp_region.c</span><br><span class="line">+++ b/src/mp/mp_region.c</span><br><span class="line">@@ <span class="number">-245</span>,<span class="number">7</span> +<span class="number">245</span>,<span class="number">7</span> @@ __memp_init(env, dbmp, reginfo_off, htab_buckets, max_nreg)</span><br><span class="line">      MTX_MPOOL_FILE_BUCKET, <span class="number">0</span>, &amp;htab[i].mtx_hash)) != <span class="number">0</span>)</span><br><span class="line"> <span class="keyword">return</span> (ret);</span><br><span class="line"> SH_TAILQ_INIT(&amp;htab[i].hash_bucket);</span><br><span class="line">-atomic_init(&amp;htab[i].hash_page_dirty, <span class="number">0</span>);</span><br><span class="line">+atomic_init_db(&amp;htab[i].hash_page_dirty, <span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">@@ -302,7 +302,7 @@ no_prealloc:</span></span><br><span class="line"><span class="comment"> &#125; else</span></span><br><span class="line"><span class="comment"> hp-&gt;mtx_hash = mtx_base + (i % dbenv-&gt;mp_mtxcount);</span></span><br><span class="line"><span class="comment"> SH_TAILQ_INIT(&amp;hp-&gt;hash_bucket);</span></span><br><span class="line"><span class="comment">-atomic_init(&amp;hp-&gt;hash_page_dirty, 0);</span></span><br><span class="line"><span class="comment">+atomic_init_db(&amp;hp-&gt;hash_page_dirty, 0);</span></span><br><span class="line"><span class="comment"> #ifdef HAVE_STATISTICS</span></span><br><span class="line"><span class="comment"> hp-&gt;hash_io_wait = 0;</span></span><br><span class="line"><span class="comment"> hp-&gt;hash_frozen = hp-&gt;hash_thawed = hp-&gt;hash_frozen_freed = 0;</span></span><br><span class="line"><span class="comment">diff --git a/src/mutex/mut_method.c b/src/mutex/mut_method.c</span></span><br><span class="line"><span class="comment">index 09353b0..177353c 100644</span></span><br><span class="line"><span class="comment">--- a/src/mutex/mut_method.c</span></span><br><span class="line"><span class="comment">+++ b/src/mutex/mut_method.c</span></span><br><span class="line"><span class="comment">@@ -474,7 +474,7 @@ atomic_compare_exchange(env, v, oldval, newval)</span></span><br><span class="line"><span class="comment"> MUTEX_LOCK(env, mtx);</span></span><br><span class="line"><span class="comment"> ret = atomic_read(v) == oldval;</span></span><br><span class="line"><span class="comment"> if (ret)</span></span><br><span class="line"><span class="comment">-atomic_init(v, newval);</span></span><br><span class="line"><span class="comment">+atomic_init_db(v, newval);</span></span><br><span class="line"><span class="comment"> MUTEX_UNLOCK(env, mtx);</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> return (ret);</span></span><br><span class="line"><span class="comment">diff --git a/src/mutex/mut_tas.c b/src/mutex/mut_tas.c</span></span><br><span class="line"><span class="comment">index 106b161..fc4de9d 100644</span></span><br><span class="line"><span class="comment">--- a/src/mutex/mut_tas.c</span></span><br><span class="line"><span class="comment">+++ b/src/mutex/mut_tas.c</span></span><br><span class="line"><span class="comment">@@ -47,7 +47,7 @@ __db_tas_mutex_init(env, mutex, flags)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> #ifdef HAVE_SHARED_LATCHES</span></span><br><span class="line"><span class="comment"> if (F_ISSET(mutexp, DB_MUTEX_SHARED))</span></span><br><span class="line"><span class="comment">-atomic_init(&amp;mutexp-&gt;sharecount, 0);</span></span><br><span class="line"><span class="comment">+atomic_init_db(&amp;mutexp-&gt;sharecount, 0);</span></span><br><span class="line"><span class="comment"> else</span></span><br><span class="line"><span class="comment"> #endif</span></span><br><span class="line"><span class="comment"> if (MUTEX_INIT(&amp;mutexp-&gt;tas)) &#123;</span></span><br><span class="line"><span class="comment">@@ -536,7 +536,7 @@ __db_tas_mutex_unlock(env, mutex)</span></span><br><span class="line"><span class="comment"> F_CLR(mutexp, DB_MUTEX_LOCKED);</span></span><br><span class="line"><span class="comment"> /* Flush flag update before zeroing count */</span></span><br><span class="line"> MEMBAR_EXIT();</span><br><span class="line">-atomic_init(&amp;mutexp-&gt;sharecount, <span class="number">0</span>);</span><br><span class="line">+atomic_init_db(&amp;mutexp-&gt;sharecount, <span class="number">0</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> DB_ASSERT(env, sharecount &gt; <span class="number">0</span>);</span><br><span class="line"> MEMBAR_EXIT();</span><br></pre></td></tr></table></figure><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz</span></span><br><span class="line">tar -xzvf db<span class="number">-4.8</span><span class="number">.30</span>.NC.tar.gz</span><br><span class="line"></span><br><span class="line">cd db<span class="number">-4.8</span><span class="number">.30</span>.NC/build_unix/</span><br><span class="line"></span><br><span class="line">../dist/configure --enable-cxx --disable-<span class="keyword">shared</span> --with-pic --prefix=/work/bitcoin<span class="number">-0.19</span><span class="number">.1</span>/db4</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure LDFLAGS=<span class="string">"-L/work/bitcoin-0.19.1/db4/lib/"</span> CPPFLAGS=<span class="string">"-I/work/bitcoin-0.19.1/db4/include/"</span></span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">make</span></span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure><p>默认安装到/usr/local/bin/目录下</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-rwxr-xr-x  <span class="number">1</span> root root <span class="number">140376160</span> May <span class="number">29</span> <span class="number">14</span>:<span class="number">08</span> bench_bitcoin*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root root   <span class="number">8032176</span> May <span class="number">29</span> <span class="number">14</span>:<span class="number">08</span> bitcoin-cli*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root root <span class="number">126259248</span> May <span class="number">29</span> <span class="number">14</span>:<span class="number">08</span> bitcoind*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root root  <span class="number">19538256</span> May <span class="number">29</span> <span class="number">14</span>:<span class="number">08</span> bitcoin-tx*</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root root  <span class="number">58618744</span> May <span class="number">29</span> <span class="number">14</span>:<span class="number">08</span> bitcoin-wallet*</span><br></pre></td></tr></table></figure><h3 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/.bitcoin</span><br><span class="line"><span class="keyword">vim</span> /root/.bitcoin/bitcoin.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><h3 id="启动测试网络"><a href="#启动测试网络" class="headerlink" title="启动测试网络"></a>启动测试网络</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">daemon</span>=<span class="number">1</span>  <span class="comment">#是否后台运行</span></span><br><span class="line"><span class="attr">server</span>=<span class="number">1</span>  <span class="comment">#允许接收JSON-RPC commands</span></span><br><span class="line"><span class="attr">rpcuser</span>=bitcoinrpc  <span class="comment">#rpc用户名</span></span><br><span class="line"><span class="comment"># generate random rpc password:</span></span><br><span class="line"><span class="comment">#   $ strings /dev/urandom | grep -o '[[:alnum:]]' | head -n 30 | tr -d '\n'; echo</span></span><br><span class="line"><span class="attr">rpcpassword</span>=zvGzMyGKczjImkKMpD85WoGyUukhwf  <span class="comment">#rpc用户密码</span></span><br><span class="line"><span class="attr">rpcthreads</span>=<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datadir</span>=/work/blockdata   <span class="comment">#指定区块数据存放目录</span></span><br><span class="line"></span><br><span class="line"><span class="attr">testnet</span>=<span class="number">1</span>    <span class="comment">#为1代表使用测试网络  为0表示正式网络</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">rpcallowip</span>=<span class="number">172.16</span>.<span class="number">0.0</span>/<span class="number">12</span></span><br><span class="line"><span class="attr">rpcallowip</span>=<span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line"><span class="attr">rpcallowip</span>=<span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use 1G memory for utxo, depends on your machine's memory</span></span><br><span class="line"><span class="attr">dbcache</span>=<span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set maximum BIP141 block weight</span></span><br><span class="line"><span class="attr">blockmaxweight</span>=<span class="number">4000000</span></span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bitcoind </span>   </span><br><span class="line">#会提示<span class="keyword">Bitcoin </span>Core starting</span><br></pre></td></tr></table></figure><p>启动后会在指定目录生成如下区块数据</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">total <span class="number">524</span></span><br><span class="line">drwxr-xr-x <span class="number">5</span> root root   <span class="number">4096</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> ./</span><br><span class="line">drwxr-xr-x <span class="number">3</span> root root   <span class="number">4096</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">13</span> ../</span><br><span class="line">-rw------- <span class="number">1</span> root root     <span class="number">37</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">13</span> banlist.dat</span><br><span class="line">drwx------ <span class="number">3</span> root root   <span class="number">4096</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> blocks/</span><br><span class="line">drwx------ <span class="number">2</span> root root   <span class="number">4096</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">13</span> chainstate/</span><br><span class="line">-rw------- <span class="number">1</span> root root  <span class="number">10073</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> debug.log</span><br><span class="line">-rw------- <span class="number">1</span> root root <span class="number">247985</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> fee_estimates.dat</span><br><span class="line">-rw------- <span class="number">1</span> root root      <span class="number">0</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">13</span> .lock</span><br><span class="line">-rw------- <span class="number">1</span> root root     <span class="number">17</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> mempool.dat</span><br><span class="line">-rw------- <span class="number">1</span> root root <span class="number">244776</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> peers.dat</span><br><span class="line">drwxr-xr-x <span class="number">2</span> root root   <span class="number">4096</span> May <span class="number">29</span> <span class="number">15</span>:<span class="number">14</span> wallets/</span><br></pre></td></tr></table></figure><p>通过  tailf debug.log   查看区块数据同步进度</p><p>停止</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcoin-cli  <span class="built_in">stop</span></span><br></pre></td></tr></table></figure><h3 id="启动正式网络"><a href="#启动正式网络" class="headerlink" title="启动正式网络"></a>启动正式网络</h3><p>bitcoin.conf配置文件如下</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将testnet=<span class="number">1</span>改为testnet=<span class="number">0</span>即可</span><br></pre></td></tr></table></figure><p>正式网络同步区块数据较长，取决于网络和节点。截至当前区块数据达300GB。</p><p>参考资料：</p><ul><li><a href="https://github.com/bitcoin/bitcoin/blob/0.18/doc/build-unix.md" target="_blank" rel="noopener">https://github.com/bitcoin/bitcoin/blob/0.18/doc/build-unix.md</a></li><li><a href="https://www.chainnode.com/tutorial/1702" target="_blank" rel="noopener">https://www.chainnode.com/tutorial/1702</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Bitcoin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bitcoin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang cobra应用程序管理</title>
      <link href="2020/05/27/golang-cobra%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%AE%A1%E7%90%86/"/>
      <url>2020/05/27/golang-cobra%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="cobra介绍"><a href="#cobra介绍" class="headerlink" title="cobra介绍"></a>cobra介绍</h3><p>Cobra既是用于创建功能强大的现代CLI应用程序的库，又是用于生成应用程序和命令文件的程序。</p><p>Cobra被用于许多Go项目中，例如Kubernetes， Hugo和Github CLI等。此列表包含使用Cobra的项目的更广泛的列表</p><p>Cobra是一个提供简单界面的库，用于创建功能强大的现代CLI界面，类似于git＆go工具。</p><p>Cobra还是一个应用程序，它将生成您的应用程序框架以快速开发基于Cobra的应用程序。</p><p>Cobra提供：</p><ul><li>简单易用的基于子-的CLI： ，app server，app fetch等。</li><li>完全兼容POSIX的标志（包括短版和长版）</li><li>嵌套子命令</li><li>全局，局部和级联标志</li><li>易产生的应用程序和命令与cobra init appname＆cobra add cmdname</li><li>明智的建议（app srver……是您的意思app server吗？）</li><li>自动生成命令和标志的帮助</li><li>自动帮助标志识别-h，–help等等。</li><li>为您的应用程序自动生成的bash自动完成</li><li>为您的应用程序自动生成的手册页</li><li>命令别名，因此您可以更改内容而不会破坏它们</li><li>定义自己的帮助，用法等的灵活性。</li><li>可选与viper紧密集成，可用于12因子应用程序</li></ul><h3 id="安装cobra"><a href="#安装cobra" class="headerlink" title="安装cobra"></a>安装cobra</h3><p>安装cobra后会在GOPATH/bin目录下创建cobra可执行文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get github.com/spf13/cobra/cobra</span><br></pre></td></tr></table></figure><h3 id="初始化cobra项目"><a href="#初始化cobra项目" class="headerlink" title="初始化cobra项目"></a>初始化cobra项目</h3><p>参考文档：</p><ul><li><a href="https://github.com/spf13/cobra/blob/master/cobra/README.md" target="_blank" rel="noopener">https://github.com/spf13/cobra/blob/master/cobra/README.md</a></li></ul><p>Cobra提供了自己的程序，该程序将创建您的应用程序并添加所需的任何命令。这是将Cobra集成到您的应用程序中的最简单方法。</p><p>参考:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="keyword">new</span><span class="type">App</span> &amp;&amp; cd <span class="keyword">new</span><span class="type">App</span></span><br><span class="line"><span class="type">cobra</span> init --pkg-name github.com/spf13/<span class="keyword">new</span><span class="type">App</span></span><br></pre></td></tr></table></figure><p>实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir startApp</span><br><span class="line">cd startAapp</span><br><span class="line">cobra init --pkg-name startApp</span><br></pre></td></tr></table></figure><h3 id="添加命令"><a href="#添加命令" class="headerlink" title="添加命令"></a>添加命令</h3><p>初始化应用程序后，Cobra可以为您创建其他命令。假设您创建了一个应用，并且想要以下命令:</p><ul><li>应用配置</li><li>应用运行</li><li>应用停止</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">E:\GoWorks\src\startApp&gt;cobra <span class="builtin-name">add</span> config</span><br><span class="line">config created at E:\GoWorks\src\startApp</span><br><span class="line"></span><br><span class="line">E:\GoWorks\src\startApp&gt;cobra <span class="builtin-name">add</span> run</span><br><span class="line"><span class="builtin-name">run</span> created at E:\GoWorks\src\startApp</span><br><span class="line"></span><br><span class="line">E:\GoWorks\src\startApp&gt;cobra <span class="builtin-name">add</span> stop</span><br><span class="line">stop created at E:\GoWorks\src\startApp</span><br></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">E:\GoWorks\src\startApp&gt;go mod init</span><br><span class="line">go: creating new go.mod: module startApp</span><br><span class="line"></span><br><span class="line">E:\GoWorks\src\startApp&gt;go build</span><br><span class="line">go: finding github.com/spf13/viper v1.7.0</span><br><span class="line">go: downloading github.com/spf13/viper v1.7.0</span><br><span class="line">go: extracting github.com/spf13/viper v1.7.0</span><br><span class="line">go: downloading gopkg.in/yaml.v2 v2.2.4</span><br><span class="line">go: downloading github.com/subosito/gotenv v1.2.0</span><br><span class="line">go: downloading github.com/magiconair/properties v1.8.1</span><br><span class="line">go: downloading golang.org/x/text v0.3.2</span><br><span class="line">go: downloading gopkg.in/ini.v1 v1.51.0</span><br><span class="line">go: extracting github.com/subosito/gotenv v1.2.0</span><br><span class="line">go: extracting gopkg.in/yaml.v2 v2.2.4</span><br><span class="line">go: extracting github.com/magiconair/properties v1.8.1</span><br><span class="line">go: extracting gopkg.in/ini.v1 v1.51.0</span><br><span class="line">go: extracting golang.org/x/text v0.3.2</span><br><span class="line">go: finding github.com/magiconair/properties v1.8.1</span><br><span class="line">go: finding golang.org/x/text v0.3.2</span><br><span class="line">go: finding github.com/subosito/gotenv v1.2.0</span><br><span class="line">go: finding gopkg.in/ini.v1 v1.51.0</span><br><span class="line">go: finding gopkg.in/yaml.v2 v2.2.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">E:\GoWorks\src\startApp&gt;startApp.exe  //执行程序</span><br><span class="line">A longer description that spans multiple lines and likely contains</span><br><span class="line">examples and usage of using your application. For example:</span><br><span class="line"></span><br><span class="line">Cobra is a CLI library for Go that empowers applications.</span><br><span class="line">This application is a tool to generate the needed files</span><br><span class="line">to quickly create a Cobra application.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  startApp [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  config      A brief description of your command   //可以看到新加的config命令</span><br><span class="line">  help        Help about any command</span><br><span class="line">  run         A brief description of your command</span><br><span class="line">  stop        A brief description of your command</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --config string   config file (default is $HOME/.startApp.yaml)</span><br><span class="line">  -h, --help            help for startApp</span><br><span class="line">  -t, --toggle          Help message for toggle</span><br><span class="line"></span><br><span class="line">Use "startApp [command] --help" for more information about a command.</span><br><span class="line"></span><br><span class="line">E:\GoWorks\src\startApp&gt;</span><br></pre></td></tr></table></figure><h3 id="为命令添加功能"><a href="#为命令添加功能" class="headerlink" title="为命令添加功能"></a>为命令添加功能</h3><p>默认情况下，每个命令默认都添加了-h帮助信息，描述信息修改在每个cmd.go文件的Long Short提示标签下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> runCmd = &amp;cobra.Command&#123;</span><br><span class="line">Use:   <span class="string">"run"</span>,</span><br><span class="line">Short: <span class="string">"start your app"</span>,</span><br><span class="line">Long: <span class="string">`start`</span>,</span><br><span class="line">Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"程序正在运行"</span>)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例:为程序添加version命令</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:<span class="symbol">\G</span>oWorks<span class="symbol">\s</span>rc<span class="symbol">\s</span>tartApp&gt;cobra add version</span><br><span class="line">version created at E:<span class="symbol">\G</span>oWorks<span class="symbol">\s</span>rc<span class="symbol">\s</span>tartApp</span><br></pre></td></tr></table></figure><p>修改version.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"version is v1.0"</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>编译并执行</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E:<span class="symbol">\G</span>oWorks<span class="symbol">\s</span>rc<span class="symbol">\s</span>tartApp&gt;startApp.exe version</span><br><span class="line">version is v1.0</span><br><span class="line"></span><br><span class="line">E:<span class="symbol">\G</span>oWorks<span class="symbol">\s</span>rc<span class="symbol">\s</span>tartApp&gt;</span><br></pre></td></tr></table></figure><h3 id="修改程序描述"><a href="#修改程序描述" class="headerlink" title="修改程序描述"></a>修改程序描述</h3><p>编辑cmd目录下root.go文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">Use:   <span class="string">"startApp"</span>,</span><br><span class="line">Short: <span class="string">"A brief description of your application"</span>,</span><br><span class="line">Long: <span class="string">`startApp to Manager your Apps`</span>,  <span class="comment">//修改此处</span></span><br><span class="line"><span class="comment">// Uncomment the following line if your bare application</span></span><br><span class="line"><span class="comment">// has an action associated with it:</span></span><br><span class="line"><span class="comment">//Run: func(cmd *cobra.Command, args []string) &#123; &#125;,</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考资料:</p><ul><li><a href="https://github.com/spf13/cobra" target="_blank" rel="noopener">https://github.com/spf13/cobra</a></li><li><a href="https://www.cnblogs.com/sparkdev/p/10856077.html" target="_blank" rel="noopener">https://www.cnblogs.com/sparkdev/p/10856077.html</a></li><li><a href="https://o-my-chenjian.com/2017/09/20/Using-Cobra-With-Golang/" target="_blank" rel="noopener">https://o-my-chenjian.com/2017/09/20/Using-Cobra-With-Golang/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决 golang.org/x 包失败</title>
      <link href="2020/05/27/%E8%A7%A3%E5%86%B3-golang-org-x-%E5%8C%85%E5%A4%B1%E8%B4%A5/"/>
      <url>2020/05/27/%E8%A7%A3%E5%86%B3-golang-org-x-%E5%8C%85%E5%A4%B1%E8%B4%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在使用go get\go install 等命令时会自动去下载相关的依赖包，因我国特殊原因会出现下载失败，通常表现如下。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> golang.org<span class="regexp">/x/</span><span class="string">text:</span> unrecognized <span class="keyword">import</span> path “golang.org<span class="regexp">/x/</span>text” (https <span class="string">fetch:</span> Get <span class="string">https:</span><span class="comment">//golang.org/x/text?go-get=1: dial tcp 216.239.37.1:443: i/o timeout)</span></span><br></pre></td></tr></table></figure><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><h4 id="手动下载包到-GOPATH-src路径下"><a href="#手动下载包到-GOPATH-src路径下" class="headerlink" title="手动下载包到$GOPATH/src路径下"></a>手动下载包到$GOPATH/src路径下</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir $GOPATH/src/golang.org/x</span><br><span class="line">cd $GOPATH/src/golang.org/x</span><br><span class="line">git clone git@github.com:golang/text.git</span><br><span class="line">rm -rf text/.git</span><br></pre></td></tr></table></figure><h4 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h4><p>第二种方式就是设置代理</p><p>使用公共代理服务<a href="https://goproxy.io，我们可参见下面直接使用七牛云的代理，国内用户访问更快。" target="_blank" rel="noopener">https://goproxy.io，我们可参见下面直接使用七牛云的代理，国内用户访问更快。</a></p><h3 id="配置国内七牛代理"><a href="#配置国内七牛代理" class="headerlink" title="配置国内七牛代理"></a>配置国内七牛代理</h3><p>参见文档:</p><ul><li><a href="https://github.com/goproxy/goproxy.cn/blob/master/README.zh-CN.md" target="_blank" rel="noopener">https://github.com/goproxy/goproxy.cn/blob/master/README.zh-CN.md</a></li><li><a href="https://goproxy.cn" target="_blank" rel="noopener">https://goproxy.cn</a></li></ul><h4 id="MacOS或者Linux"><a href="#MacOS或者Linux" class="headerlink" title="MacOS或者Linux"></a>MacOS或者Linux</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="builtin-name">export</span> <span class="attribute">GO111MODULE</span>=on</span><br><span class="line">$ <span class="builtin-name">export</span> <span class="attribute">GOPROXY</span>=https://goproxy.cn</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"export GO111MODULE=on"</span> &gt;&gt; ~/.profile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"export GOPROXY=https://goproxy.cn"</span> &gt;&gt; ~/.profile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ~/.profile</span></span><br></pre></td></tr></table></figure><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">C:</span>\&gt; <span class="variable">$env</span><span class="symbol">:GO111MODULE</span> = <span class="string">"on"</span></span><br><span class="line"><span class="symbol">C:</span>\&gt; <span class="variable">$env</span><span class="symbol">:GOPROXY</span> = <span class="string">"https://goproxy.cn"</span></span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 打开“开始”并搜索“env”</span><br><span class="line"><span class="number">2.</span> 选择“编辑系统环境变量”</span><br><span class="line"><span class="number">3.</span> 点击“环境变量…”按钮</span><br><span class="line"><span class="number">4.</span> 在“&lt;你的用户名&gt; 的用户变量”章节下（上半部分）</span><br><span class="line"><span class="number">5.</span> 点击“新建…”按钮</span><br><span class="line"><span class="number">6.</span> 选择“变量名”输入框并输入“GO111MODULE”</span><br><span class="line"><span class="number">7.</span> 选择“变量值”输入框并输入“on”</span><br><span class="line"><span class="number">8.</span> 点击“确定”按钮</span><br><span class="line"><span class="number">9.</span> 点击“新建…”按钮</span><br><span class="line"><span class="number">10.</span> 选择“变量名”输入框并输入“GOPROXY”</span><br><span class="line"><span class="number">11.</span> 选择“变量值”输入框并输入“https:<span class="comment">//goproxy.cn”</span></span><br><span class="line"><span class="number">12.</span> 点击“确定”按钮</span><br></pre></td></tr></table></figure><h4 id="重启goland"><a href="#重启goland" class="headerlink" title="重启goland"></a>重启goland</h4><p>切记，切记，切记！</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://shockerli.net/post/go-get-golang-org-x-solution/" target="_blank" rel="noopener">https://shockerli.net/post/go-get-golang-org-x-solution/</a></li><li><a href="https://github.com/goproxy/goproxy.cn" target="_blank" rel="noopener">https://github.com/goproxy/goproxy.cn</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>glang 日志解析glog</title>
      <link href="2020/05/26/glang-%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90glog/"/>
      <url>2020/05/26/glang-%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90glog/</url>
      
        <content type="html"><![CDATA[<h3 id="glog"><a href="#glog" class="headerlink" title="glog"></a>glog</h3><p>go语言有一个标准库，log，提供了最基本的日志功能，但是没有什么高级的功能，如果需要高级的特性，可以选择glog或log4go,K8s默认的日志输出就是用的glog。</p><p>glog是google提供的，类似于google的c++ log库，使用起来非常简单，下面介绍一下；log4go的用法和log4j一样，可配置性比较高。</p><p>日志输出格式是固定的(Lmmdd hh:mm:ss.uuuuuu threadid file:line] msg…)</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序名.电脑名.用户名<span class="selector-class">.log</span><span class="selector-class">.xxx</span><span class="selector-class">.YYYYMMDD-HHMMSS</span><span class="selector-class">.pid</span></span><br></pre></td></tr></table></figure><p>glog只提供了少数几个选项，通过命令行控制，例如：</p><p>-log_dir: 日志文件保存目录</p><p>-alsologtostderr: 日志写入文件的同时，输出到stderr</p><p>-v：配置V输出的等级。</p><p>glog使用非常简单，只需要import就可以了。glog package的init函数会初始化并启动一个glog 的flushDaemon协程，你只需要使用glog.Info, glog.Warning, glog.Error或glog.Fatal即可。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get github.com/golang/glog</span><br></pre></td></tr></table></figure><h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>//godoc<span class="meta">.org</span>/github.com/golang/glog</span><br></pre></td></tr></table></figure><p>日志级别</p><ul><li>INFO：普通日志；</li><li>WARNING：告警日志；</li><li>ERROR：错误日志；</li><li>FATAL：严重错误日志，打印完日志后程序将会推出 os.Exit()</li></ul><p>使用方式参考：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">glog.Info(<span class="string">"Prepare to repel boarders"</span>)</span><br><span class="line"></span><br><span class="line">glog.Fatalf(<span class="string">"Initialization failed: %s"</span>, err)</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> glog.Flush()</span><br><span class="line"></span><br><span class="line">glog.Info(<span class="string">"This is info message"</span>)</span><br><span class="line">glog.Infof(<span class="string">"This is info message: %v"</span>, <span class="number">12345</span>)</span><br><span class="line">glog.InfoDepth(<span class="number">1</span>, <span class="string">"This is info message"</span>, <span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">glog.Warning(<span class="string">"This is warning message"</span>)</span><br><span class="line">glog.Warningf(<span class="string">"This is warning message: %v"</span>, <span class="number">12345</span>)</span><br><span class="line">glog.WarningDepth(<span class="number">1</span>, <span class="string">"This is warning message"</span>, <span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">glog.Error(<span class="string">"This is error message"</span>)</span><br><span class="line">glog.Errorf(<span class="string">"This is error message: %v"</span>, <span class="number">12345</span>)</span><br><span class="line">glog.ErrorDepth(<span class="number">1</span>, <span class="string">"This is error message"</span>, <span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">glog.Fatal(<span class="string">"This is fatal message"</span>)</span><br><span class="line">glog.Fatalf(<span class="string">"This is fatal message: %v"</span>, <span class="number">12345</span>)</span><br><span class="line">glog.FatalDepth(<span class="number">1</span>, <span class="string">"This is fatal message"</span>, <span class="number">12345</span>)</span><br></pre></td></tr></table></figure><p>日志级别<br>使用日志级别,在程序运行时可以使用-v=5打印这个级别以下定义的日志输出  -alsologtostderr 是将日志同时输出到控制台。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">glog.V(<span class="number">3</span>).Info(<span class="string">"LEVEL 3 message"</span>) <span class="comment">// 使用日志级别 3</span></span><br><span class="line">glog.V(<span class="number">4</span>).Info(<span class="string">"LEVEL 4 message"</span>) <span class="comment">// 使用日志级别 4</span></span><br><span class="line">glog.V(<span class="number">5</span>).Info(<span class="string">"LEVEL 5 message"</span>) <span class="comment">// 使用日志级别 5</span></span><br><span class="line">glog.V(<span class="number">8</span>).Info(<span class="string">"LEVEL 8 message"</span>) <span class="comment">// 使用日志级别 8</span></span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"flag"</span></span><br><span class="line"><span class="string">"github.com/golang/glog"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ConfigData <span class="keyword">struct</span> &#123;</span><br><span class="line">ServerID                    <span class="keyword">uint8</span></span><br><span class="line">ServerPort                  <span class="keyword">int32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(conf *ConfigData)</span> <span class="title">LoadFromFile</span><span class="params">(file <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">configJSON, err := ioutil.ReadFile(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">err = json.Unmarshal(configJSON, conf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//程序退出时确保写入文件中</span></span><br><span class="line"><span class="keyword">defer</span> glog.Flush()</span><br><span class="line"></span><br><span class="line">configFilePath := flag.String(<span class="string">"config"</span>, <span class="string">"./config.json"</span>, <span class="string">"Path of config file"</span>)</span><br><span class="line">flag.Parse()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag.NFlag() &lt; <span class="number">1</span> &#123; <span class="comment">//NFlag返回解析时进行了设置的flag的数量。</span></span><br><span class="line">flag.Usage() <span class="comment">//当参数小于1个打印flag的默认提示</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 读取配置文件</span></span><br><span class="line"><span class="keyword">var</span> configData ConfigData</span><br><span class="line">err := configData.LoadFromFile(*configFilePath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">glog.Fatal(<span class="string">"加载配置文件失败: "</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">glog.Info(<span class="string">"配置加载正确"</span>)</span><br><span class="line">glog.Info(<span class="string">"程序开始启动&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span><br><span class="line">fmt.Println(configData.ServerID,configData.ServerPort)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>会在log文件下生成</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GoLogMain.exe -config=<span class="string">"./config.json"</span> -log_dir=<span class="string">"./log"</span> -alsologtostderr</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django Admin常用命令</title>
      <link href="2020/05/21/django-Admin%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>2020/05/21/django-Admin%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="Django-Admin"><a href="#Django-Admin" class="headerlink" title="Django Admin"></a>Django Admin</h3><p>django-admin 是Django的命令行工具集，用于处理系统相关操作，比如创建管理员账户，忘记密码，应用数据库等等。如果某工程安装了相关app，那么在使用工程命令时只有django默认的命令行。</p><h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>help命令主要用户获取帮助信息，显示django可用的命令，如果要显示某个命令使用python manage.py help  shell </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py help</span><br><span class="line"></span><br><span class="line">Type 'manage.py help &lt;subcommand&gt;' for help on a specific subcommand.</span><br><span class="line"></span><br><span class="line">Available subcommands:</span><br><span class="line"></span><br><span class="line">[auth]                         #安装了auth app</span><br><span class="line">    changepassword</span><br><span class="line">    createsuperuser</span><br><span class="line"></span><br><span class="line">[captcha]                      #captcha app</span><br><span class="line">    captcha_clean</span><br><span class="line">    captcha_create_pool</span><br><span class="line"></span><br><span class="line">[contenttypes]</span><br><span class="line">    remove_stale_contenttypes</span><br><span class="line"></span><br><span class="line">[django]</span><br><span class="line">    check</span><br><span class="line">    compilemessages</span><br><span class="line">    createcachetable</span><br><span class="line">    dbshell</span><br><span class="line">    diffsettings</span><br><span class="line">    dumpdata</span><br><span class="line">    flush</span><br><span class="line">    inspectdb</span><br><span class="line">    loaddata</span><br><span class="line">    makemessages</span><br><span class="line">    makemigrations</span><br><span class="line">    migrate</span><br><span class="line">    sendtestemail</span><br><span class="line">    shell</span><br><span class="line">    showmigrations</span><br><span class="line">    sqlflush</span><br><span class="line">    sqlmigrate</span><br><span class="line">    sqlsequencereset</span><br><span class="line">    squashmigrations</span><br><span class="line">    startapp</span><br><span class="line">    startproject</span><br><span class="line">    test</span><br><span class="line">    testserver</span><br><span class="line"></span><br><span class="line">[sessions]     </span><br><span class="line">    clearsessions</span><br><span class="line"></span><br><span class="line">[staticfiles]</span><br><span class="line">    collectstatic</span><br><span class="line">    findstatic</span><br><span class="line">    runserver</span><br></pre></td></tr></table></figure><p>显示单个命令用法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py help shell</span><br><span class="line">usage: manage.py shell [-h] [--no-startup] [-i &#123;ipython,bpython,python&#125;]</span><br><span class="line">                       [-c COMMAND] [--version] [-v &#123;0,1,2,3&#125;]</span><br><span class="line">                       [--settings SETTINGS] [--pythonpath PYTHONPATH]</span><br><span class="line">                       [--traceback] [--no-color]</span><br><span class="line"></span><br><span class="line">Runs a Python interactive interpreter. Tries to use IPython or bpython, if one</span><br><span class="line">of them is available. Any standard input is executed as code.</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  --no-startup          When using plain Python, ignore the PYTHONSTARTUP</span><br><span class="line">                        environment variable and ~/.pythonrc.py script.</span><br><span class="line">  -i &#123;ipython,bpython,python&#125;, --interface &#123;ipython,bpython,python&#125;</span><br><span class="line">                        Specify an interactive interpreter interface.</span><br><span class="line">                        Available options: "ipython", "bpython", and "python"</span><br><span class="line">  -c COMMAND, --command COMMAND</span><br><span class="line">                        Instead of opening an interactive shell, run a command</span><br><span class="line">                        as Django and exit.</span><br><span class="line">  --version             show program's version number and exit</span><br><span class="line">  -v &#123;0,1,2,3&#125;, --verbosity &#123;0,1,2,3&#125;</span><br><span class="line">                        Verbosity level; 0=minimal output, 1=normal output,</span><br><span class="line">                        2=verbose output, 3=very verbose output</span><br><span class="line">  --settings SETTINGS   The Python path to a settings module, e.g.</span><br><span class="line">                        "myproject.settings.main". If this isn't provided, the</span><br><span class="line">                        DJANGO_SETTINGS_MODULE environment variable will be</span><br><span class="line">                        used.</span><br><span class="line">  --pythonpath PYTHONPATH</span><br><span class="line">                        A directory to add to the Python path, e.g.</span><br><span class="line">                        "/home/djangoprojects/myproject".</span><br><span class="line">  --traceback           Raise on CommandError exceptions</span><br><span class="line">  --no-color            Don't colorize the command output.</span><br></pre></td></tr></table></figure><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><p>显示当前django版本</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@localhost</span><span class="symbol">:/data/djangosite</span><span class="comment"># python manage.py version</span></span><br><span class="line"><span class="number">2.1</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="changepassword"><a href="#changepassword" class="headerlink" title="changepassword"></a>changepassword</h3><p>修改项目中的用户名和密码，前提需要安装auth库并且正确配置用户信息。 输入两次密码即可修改admin用户的密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py changepassword admin</span><br><span class="line">Changing password for user 'admin'</span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br></pre></td></tr></table></figure><h3 id="createsuperuser"><a href="#createsuperuser" class="headerlink" title="createsuperuser"></a>createsuperuser</h3><p>创建项目中的管理员账户，前提需要安装auth库并且正确配置数据库。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py createsuperuser</span><br><span class="line">username:admin</span><br><span class="line">email:admin@qq.com</span><br><span class="line">password:xxxxxxxx</span><br></pre></td></tr></table></figure><h3 id="check"><a href="#check" class="headerlink" title="check"></a>check</h3><p>用于检查工程中是否存在错误，用法：python manage.py check  [app_lable….]</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite#python manage.py check</span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line">root@localhost:/data/djangosite#</span><br></pre></td></tr></table></figure><p>此时修改一下将url.py改成错误的配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite#python manage.py check</span><br><span class="line">.........</span><br><span class="line">  File "/data/djangosite/apps/users/urls.py", line 24</span><br><span class="line">    path('logout/', users_view.LogoutView.as_view(), name="logout"),</span><br><span class="line">       ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure><h3 id="dbshell"><a href="#dbshell" class="headerlink" title="dbshell"></a>dbshell</h3><p>Django 会自动进入在settings.py中设置的数据库,这个就和sql终端是一样的<br>manage.py dbshell  or manage.py dbshell  –database db1  如果配置多数据库的情况下，可以指定进入哪个数据库</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py dbshell </span><br><span class="line">mysql: [<span class="builtin-name">Warning</span>] Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table <span class="keyword">and</span> column names</span><br><span class="line">You can turn off this feature <span class="keyword">to</span> <span class="builtin-name">get</span> a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands end with ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL<span class="built_in"> connection </span>id is 10365662</span><br><span class="line">Server version: 5.7.26-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> <span class="keyword">or</span> <span class="string">'\h'</span> <span class="keyword">for</span> help.<span class="built_in"> Type </span><span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h3 id="migrate"><a href="#migrate" class="headerlink" title="migrate"></a>migrate</h3><p>将修改应用到数据库，如果不加任何参数默认会将所有应用程序的models.py更新到数据库，可以单独指定app更新到数据库。默认应用到数据库后会记录到django_migrations数据表中。</p><p>手动指定撤销到指定的migration文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate users 0002_account_user</span><br></pre></td></tr></table></figure><p>如果手动更新了数据库可以什么–fake参数</p><p>解决migrate命令报错的解决方法：</p><ol><li>终极解决方案原理：就是将之前的那些迁移脚本都不用了。重新来过。要将出问题的app下的所有模型和数据库中表保持一致，重新映射。</li><li>将出问题的app下的所有模型，都和数据库中的表保持一致。</li><li>将出问题的app下的所有迁移脚本文件都删掉。再在django_migrations表中将出问题的app相关的迁移记录都删掉。</li><li>使用makemigrations，重新将模型生成一个迁移脚本。</li><li>使用migrate –fake-initial参数，将刚刚生成的迁移脚本，标记为已经完成（因为这些模型相对应的表，其实都已经在数据库中存在了，不需要重复执行了。）</li><li>可以做其他的映射了。</li></ol><h3 id="makemigrations"><a href="#makemigrations" class="headerlink" title="makemigrations"></a>makemigrations</h3><p>根据model的变化生成对应的python代码，该代码用于更新数据库。代码会存放于每个工程目录下的migrations 目录下。该目录默认包含<strong>init</strong>.py文件。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">migrations/</span><br><span class="line">├── <span class="number">0001</span>_initial.py</span><br><span class="line">├── <span class="number">0002</span>_account_user.py</span><br><span class="line">├── <span class="number">0003</span>_auto_20181129_1941.py</span><br></pre></td></tr></table></figure><h3 id="sqlmigrate"><a href="#sqlmigrate" class="headerlink" title="sqlmigrate"></a>sqlmigrate</h3><p>输出某一migrate所对应的SQL语句。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py sqlmigrate users 0001_initial</span><br><span class="line">2018-12-01 10:00:00</span><br><span class="line">2018-12-01 10:00:00</span><br><span class="line">BEGIN;</span><br><span class="line">--</span><br><span class="line">-- Create model User</span><br><span class="line">--</span><br><span class="line">CREATE TABLE `users_user` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `password` varchar(128) NOT NULL, `last_login` datetime(6) NULL, `is_superuser` bool NOT NULL, `username` varchar(150) NOT NULL UNIQUE, `first_name` varchar(30) NOT NULL, `last_name` varchar(150) NOT NULL, `email` varchar(254) NOT NULL, `is_staff` bool NOT NULL, `is_active` bool NOT NULL, `date_joined` datetime(6) NOT NULL, `mobile` varchar(20) NOT NULL, `PIN` varchar(20) NOT NULL);</span><br><span class="line">CREATE TABLE `users_user_groups` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `user_id` integer NOT NULL, `group_id` integer NOT NULL);</span><br><span class="line">CREATE TABLE `users_user_user_permissions` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `user_id` integer NOT NULL, `permission_id` integer NOT NULL);</span><br><span class="line">--</span><br><span class="line">-- Create model History</span><br><span class="line">--</span><br><span class="line">CREATE TABLE `users_history` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `user` varchar(50) NULL, `login_time` datetime(6) NOT NULL, `logout_time` datetime(6) NOT NULL, `login_status` varchar(11) NULL, `user_ip` char(39) NOT NULL, `create_time` datetime(6) NOT NULL, `update_time` datetime(6) NOT NULL);</span><br><span class="line">ALTER TABLE `users_user_groups` ADD CONSTRAINT `users_user_groups_user_id_5f6f5a90_fk_users_user_id` FOREIGN KEY (`user_id`) REFERENCES `users_user` (`id`);</span><br><span class="line">ALTER TABLE `users_user_groups` ADD CONSTRAINT `users_user_groups_group_id_9afc8d0e_fk_auth_group_id` FOREIGN KEY (`group_id`) REFERENCES `auth_group` (`id`);</span><br><span class="line">ALTER TABLE `users_user_groups` ADD CONSTRAINT users_user_groups_user_id_group_id_b88eab82_uniq UNIQUE (`user_id`, `group_id`);</span><br><span class="line">ALTER TABLE `users_user_user_permissions` ADD CONSTRAINT `users_user_user_permissions_user_id_20aca447_fk_users_user_id` FOREIGN KEY (`user_id`) REFERENCES `users_user` (`id`);</span><br><span class="line">ALTER TABLE `users_user_user_permissions` ADD CONSTRAINT `users_user_user_perm_permission_id_0b93982e_fk_auth_perm` FOREIGN KEY (`permission_id`) REFERENCES `auth_permission` (`id`);</span><br><span class="line">ALTER TABLE `users_user_user_permissions` ADD CONSTRAINT users_user_user_permissions_user_id_permission_id_43338c45_uniq UNIQUE (`user_id`, `permission_id`);</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><h3 id="showmigrations"><a href="#showmigrations" class="headerlink" title="showmigrations"></a>showmigrations</h3><p>显示migrations记录<br>如果已经应用到数据库中前面[]后显示[X],否则为[] 使用-p显示所有记录  -l 按应用程序显示记录。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data/djangosite# python manage.py showmigrations<span class="built_in"> users </span></span><br><span class="line"></span><br><span class="line">users</span><br><span class="line"> [X] 0001_initial</span><br><span class="line"> [X] 0002_auto_20181223_1302</span><br><span class="line"> [X] 0003_auto_20181223_1316</span><br><span class="line"> [X] 0004_verifycode</span><br><span class="line"> [X] 0005_auto_20190104_1141</span><br><span class="line"> [X] 0006_auto_20190216_1647</span><br><span class="line"> [X] 0007_user_region</span><br></pre></td></tr></table></figure><h3 id="startproject"><a href="#startproject" class="headerlink" title="startproject"></a>startproject</h3><p>创建django工程，会在当前目录创建一个文件夹，文件夹下包含manage.py文件以及工程文件夹，同时在工程文件夹下包含settings.py文件及其它文件夹</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@localhost</span><span class="symbol">:/djangodir</span><span class="comment"># django-admin startproject djangosite</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:/djangodir</span><span class="comment"># ls</span></span><br><span class="line">djangosite</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:/djangodir</span><span class="comment"># tree djangosite</span></span><br><span class="line">djangosite</span><br><span class="line">├── djangosite</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── settings.py</span><br><span class="line">│   ├── urls.py</span><br><span class="line">│   └── wsgi.py</span><br><span class="line">└── manage.py</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> directory, <span class="number">5</span> files</span><br></pre></td></tr></table></figure><h3 id="startapp"><a href="#startapp" class="headerlink" title="startapp"></a>startapp</h3><p>创建django app应用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/djangodir/djangosite# python manage.py startapp users</span><br><span class="line">root@localhost:/djangodir/djangosite# dir</span><br><span class="line">djangosite  manage.py  users</span><br><span class="line">root@localhost:/djangodir/djangosite# tree</span><br><span class="line">.</span><br><span class="line">├── djangosite</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── __pycache__</span><br><span class="line">│   │   ├── __init__.cpython-36.pyc</span><br><span class="line">│   │   └── settings.cpython-36.pyc</span><br><span class="line">│   ├── settings.py</span><br><span class="line">│   ├── urls.py</span><br><span class="line">│   └── wsgi.py</span><br><span class="line">├── manage.py</span><br><span class="line">└── users</span><br><span class="line">    ├── admin.py</span><br><span class="line">    ├── apps.py</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── migrations</span><br><span class="line">    │   └── __init__.py</span><br><span class="line">    ├── models.py</span><br><span class="line">    ├── tests.py</span><br><span class="line">    └── views.py</span><br><span class="line"></span><br><span class="line">4 directories, 14 files</span><br></pre></td></tr></table></figure><h3 id="collectstatic"><a href="#collectstatic" class="headerlink" title="collectstatic"></a>collectstatic</h3><p>python manage.py collectstatic在执行时，django默认会去查看定义在STATICFILES_DIRS里的目录，以及在INSTALLED_APPS里定义了的app的static目录。如果这些目录下有文件，则把文件全部收集起来，拷贝到STATIC_ROOT目录下。当使用django的runserver时，如果请求的是一个静态文件，django也是会默认查看上述的ROOT、DIRS和static目录。但是，在部署到服务器上时，此规则就不使用了。</p><p>配置setting.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS = [ </span><br><span class="line">            os.path.join(BASE_DIR, <span class="string">"static/"</span>),</span><br><span class="line">]</span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span>   </span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">"staticfiles/"</span>)</span><br></pre></td></tr></table></figure><p>执行命令后会去收集静态资源文件放于STATIC_ROOT文件夹下</p><p>STATIC_ROOT 是在部署的时候才发挥作用, 而实际情况下,静态文件的一般安放位置有两种:</p><p>1.一种就是在每个app里面新建一个static文件夹,将静态文件放到里面,在加载静态文件时,比如要在模板中用到静态文件,django会自动在每个app里面搜索static文件夹(所以,不要把文件夹的名字写错哦, 否则django就找不到你的文件夹了)</p><p>2.另一种,就是在所有的app文件外面,建立一个公共的文件夹, 因为有些静态文件不是某个app独有的,那么就可以把它放到一个公共文件夹里面,方便管理(注意,建立一个公共的静态文件的文件夹只是一种易于管理的做法,但是不是必须的,app是可以跨app应用静态文件的,因为最后所有的静态文件都会在STATIC_ROOT里面存在)<br>那现在的问题是如何让django知道你把一些静态文件放到app以外的公共文件夹中呢,那就需要配置STATICFILES_DIRS了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/djangodir/djangosite# python manage.py collectstatic</span><br></pre></td></tr></table></figure><h3 id="runserver"><a href="#runserver" class="headerlink" title="runserver"></a>runserver</h3><p>在当前机器上启动工程，默认是一个轻量的web服务器，只作为测试用，默认端口为8000，默认监听127.0.0.1:8000<br>修改默认监听和端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/djangodir/djangosite# python manage.py runserver 0.0.0.0:8001  #修改默认监听</span><br><span class="line">Performing system checks...</span><br><span class="line"></span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line">Django version 2.1.1, using settings 'djangosite.settings'</span><br><span class="line">Starting development server at http://0.0.0.0:8001/</span><br><span class="line">Quit the server with CONTROL-C.</span><br></pre></td></tr></table></figure><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p>启动django工程交互，默认情况下使用ipython启动的交互默认，可以自动补全，需要提前安装。在交互窗口下可import 测试相关语法等</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/djangodir/djangosite# python manage.py shell</span><br><span class="line">Python 3.6.7 (default, Oct 25 2018, 09:16:13) </span><br><span class="line">[GCC 5.4.0 20160609] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">(InteractiveConsole)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 读取XML配置文件</title>
      <link href="2020/05/21/golang-%E8%AF%BB%E5%8F%96XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/21/golang-%E8%AF%BB%E5%8F%96XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="XML配置文件"><a href="#XML配置文件" class="headerlink" title="XML配置文件"></a>XML配置文件</h3><p>解析xml使用”encoding/xml”包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">smtpServer</span>&gt;</span>smtp.163.com<span class="tag">&lt;/<span class="name">smtpServer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">smtpPort</span>&gt;</span>25<span class="tag">&lt;/<span class="name">smtpPort</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sender</span>&gt;</span>user@163.com<span class="tag">&lt;/<span class="name">sender</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">senderPasswd</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">senderPasswd</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">receivers</span> <span class="attr">flag</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>29<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">user</span>&gt;</span>roddy@qq.com<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">user</span>&gt;</span>test1@qq.com<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">receivers</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>xml.Unmarshal()</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data, err := ioutil.ReadAll(file)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"读取文件失败: %v"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">v := ConfigXML&#123;&#125;</span><br><span class="line">err = xml.Unmarshal(data, &amp;v)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"解析XML失败: %v"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/xml"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SReceivers <span class="keyword">struct</span> &#123;</span><br><span class="line">Flag <span class="keyword">string</span> <span class="string">`xml:"flag,attr"`</span> <span class="comment">// 读取flag属性</span></span><br><span class="line">User []<span class="keyword">string</span> <span class="string">`xml:"user"`</span> <span class="comment">// 读取user数组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ConfigXML <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">XMLName  xml.Name <span class="string">`xml:"config"`</span> <span class="comment">// 指定最外层的标签为config</span></span><br><span class="line">SmtpServer <span class="keyword">string</span> <span class="string">`xml:"smtpServer"`</span> <span class="comment">// 读取smtpServer配置项，并将结果保存到SmtpServer变量中</span></span><br><span class="line">SmtpPort <span class="keyword">int</span> <span class="string">`xml:"smtpPort"`</span></span><br><span class="line">Sender <span class="keyword">string</span> <span class="string">`xml:"sender"`</span></span><br><span class="line">SenderPasswd <span class="keyword">string</span> <span class="string">`xml:"senderPasswd"`</span></span><br><span class="line">Receivers SReceivers <span class="string">`xml:"receivers"`</span> <span class="comment">// 读取receivers标签下的内容，以结构方式获取</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">file, err := os.Open(<span class="string">"config.xml"</span>) <span class="comment">// For read access.</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"配置文件错误: %v"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line">data, err := ioutil.ReadAll(file)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"读取文件失败: %v"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">v := ConfigXML&#123;&#125;</span><br><span class="line">err = xml.Unmarshal(data, &amp;v)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"解析XML失败: %v"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(v)</span><br><span class="line">fmt.Println(<span class="string">"SmtpServer : "</span>,v.SmtpServer)</span><br><span class="line">fmt.Println(<span class="string">"SmtpPort : "</span>,v.SmtpPort)</span><br><span class="line">fmt.Println(<span class="string">"Sender : "</span>,v.Sender)</span><br><span class="line">fmt.Println(<span class="string">"SenderPasswd : "</span>,v.SenderPasswd)</span><br><span class="line">fmt.Println(<span class="string">"Receivers.Flag : "</span>,v.Receivers.Flag)</span><br><span class="line"><span class="keyword">for</span> i,element := <span class="keyword">range</span> v.Receivers.User &#123;</span><br><span class="line">fmt.Println(i,element)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 读取YAML配置文件</title>
      <link href="2020/05/21/golang-%E8%AF%BB%E5%8F%96YAML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/21/golang-%E8%AF%BB%E5%8F%96YAML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="YAML配置"><a href="#YAML配置" class="headerlink" title="YAML配置"></a>YAML配置</h3><p>参考配置文件config.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">languages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ruby</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Perl</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Python</span></span><br><span class="line"><span class="attr">Nginx:</span></span><br><span class="line">  <span class="attr">Port:</span> <span class="number">443</span></span><br><span class="line">  <span class="attr">LogPath:</span>  <span class="string">"/var/log//nginx/nginx.log"</span></span><br><span class="line">  <span class="attr">Path:</span> <span class="string">"/opt/nginx/"</span></span><br></pre></td></tr></table></figure><h3 id="安装yaml包"><a href="#安装yaml包" class="headerlink" title="安装yaml包"></a>安装yaml包</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">go</span> <span class="built_in">get</span> gopkg.<span class="keyword">in</span>/yaml.v2</span><br></pre></td></tr></table></figure><h3 id="结构体解析"><a href="#结构体解析" class="headerlink" title="结构体解析"></a>结构体解析</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Nginx <span class="keyword">struct</span> &#123;</span><br><span class="line">Port <span class="keyword">int</span> <span class="string">`yaml:"Port"`</span></span><br><span class="line">LogPath <span class="keyword">string</span> <span class="string">`yaml:"LogPath"`</span></span><br><span class="line">Path <span class="keyword">string</span> <span class="string">`yaml:"Path"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> language <span class="keyword">struct</span> &#123;</span><br><span class="line">Languages []<span class="keyword">string</span></span><br><span class="line">SiteNginx  Nginx <span class="string">`yaml:"Nginx"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="解析YAML"><a href="#解析YAML" class="headerlink" title="解析YAML"></a>解析YAML</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> language language</span><br><span class="line"></span><br><span class="line">file, err := ioutil.ReadFile(<span class="string">"config.yaml"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">"yamlFile.Get err   #%v "</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = yaml.Unmarshal(file, &amp;language)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">"Unmarshal: %v"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"gopkg.in/yaml.v2"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Nginx <span class="keyword">struct</span> &#123;</span><br><span class="line">Port <span class="keyword">int</span> <span class="string">`yaml:"Port"`</span></span><br><span class="line">LogPath <span class="keyword">string</span> <span class="string">`yaml:"LogPath"`</span></span><br><span class="line">Path <span class="keyword">string</span> <span class="string">`yaml:"Path"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> language <span class="keyword">struct</span> &#123;</span><br><span class="line">Languages []<span class="keyword">string</span></span><br><span class="line">SiteNginx  Nginx <span class="string">`yaml:"Nginx"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> language language</span><br><span class="line"></span><br><span class="line">file, err := ioutil.ReadFile(<span class="string">"config.yaml"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">"读取配置文件失败   #%v "</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = yaml.Unmarshal(file, &amp;language)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">"解析失败: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(language.Languages)</span><br><span class="line">fmt.Println(language.SiteNginx.Port)</span><br><span class="line">fmt.Println(language.SiteNginx.LogPath)</span><br><span class="line">fmt.Println(language.SiteNginx.Path)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 读取ini配置文件</title>
      <link href="2020/05/21/golang-%E8%AF%BB%E5%8F%96ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/21/golang-%E8%AF%BB%E5%8F%96ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="ini配置文件"><a href="#ini配置文件" class="headerlink" title="ini配置文件"></a>ini配置文件</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Host]</span></span><br><span class="line"><span class="attr">host</span>=<span class="string">"127.0.0.1"</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">"roddy"</span></span><br><span class="line"><span class="attr">dbpath</span>=<span class="string">"/user/local/mysql/bin/"</span></span><br></pre></td></tr></table></figure><h3 id="安装gcfg-v1"><a href="#安装gcfg-v1" class="headerlink" title="安装gcfg.v1"></a>安装gcfg.v1</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get gopkg.in/gcfg.v1</span><br></pre></td></tr></table></figure><h3 id="解析ini"><a href="#解析ini" class="headerlink" title="解析ini"></a>解析ini</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">config := <span class="keyword">struct</span> &#123;</span><br><span class="line">Host <span class="keyword">struct</span>&#123;</span><br><span class="line">Host <span class="keyword">string</span></span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">DBPath <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err := gcfg.ReadFileInto(&amp;config, <span class="string">"config.ini"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"读取文件失败,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多Section解析"><a href="#多Section解析" class="headerlink" title="多Section解析"></a>多Section解析</h3><p>多节点配置文件</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Host]</span></span><br><span class="line"><span class="attr">host</span>=<span class="string">"127.0.0.1"</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">"roddy"</span></span><br><span class="line"><span class="attr">dbpath</span>=<span class="string">"/user/local/mysql/bin/"</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Config]</span></span><br><span class="line"><span class="attr">path</span>=<span class="string">"/etc/sys.ini"</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">"roddy"</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3388</span></span><br></pre></td></tr></table></figure><p>解析</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">config := <span class="keyword">struct</span> &#123;</span><br><span class="line">Host <span class="keyword">struct</span>&#123;</span><br><span class="line">Host <span class="keyword">string</span></span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">DBPath <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Config <span class="keyword">struct</span>&#123;</span><br><span class="line">Path <span class="keyword">string</span></span><br><span class="line">User <span class="keyword">string</span></span><br><span class="line">Port <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="完整实例"><a href="#完整实例" class="headerlink" title="完整实例"></a>完整实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"gopkg.in/gcfg.v1"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config := <span class="keyword">struct</span> &#123;</span><br><span class="line">Host <span class="keyword">struct</span>&#123;</span><br><span class="line">Host <span class="keyword">string</span></span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">DBPath <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Config <span class="keyword">struct</span>&#123;</span><br><span class="line">Path <span class="keyword">string</span></span><br><span class="line">User <span class="keyword">string</span></span><br><span class="line">Port <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"xxx"</span>)</span><br><span class="line">err := gcfg.ReadFileInto(&amp;config, <span class="string">"config.ini"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"读取文件失败,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(config.Host.Host)</span><br><span class="line">fmt.Println(config.Host.Name)</span><br><span class="line">fmt.Println(config.Host.DBPath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"----------------"</span>)</span><br><span class="line">fmt.Println(config.Config.Path)</span><br><span class="line">fmt.Println(config.Config.Port)</span><br><span class="line">fmt.Println(config.Config.User)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 读取JSON配置文件</title>
      <link href="2020/05/21/golang-%E8%AF%BB%E5%8F%96json%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/21/golang-%E8%AF%BB%E5%8F%96json%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>配置文件叫config.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Host"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="attr">"Port"</span>: <span class="number">4569</span>,</span><br><span class="line">  <span class="attr">"Path"</span>: <span class="string">"/user/local/cc.conf"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建结构体"><a href="#创建结构体" class="headerlink" title="创建结构体"></a>创建结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置文件结构体</span></span><br><span class="line"><span class="keyword">type</span> configFile <span class="keyword">struct</span> &#123;</span><br><span class="line">Host <span class="keyword">string</span></span><br><span class="line">Port <span class="keyword">int</span></span><br><span class="line">Path <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="解析JSON文件"><a href="#解析JSON文件" class="headerlink" title="解析JSON文件"></a>解析JSON文件</h3><p>Decoder 主要负责将 JSON 数据解析成结构对象，JSON-对象</p><p>Encoder 主要负责将结构对象编码成 JSON 数据，对象-JSON</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// json解析文件</span></span><br><span class="line">decoder := json.NewDecoder(file)</span><br><span class="line"></span><br><span class="line">conf := configFile&#123;&#125;</span><br><span class="line"></span><br><span class="line">decodeErr := decoder.Decode(&amp;conf)</span><br></pre></td></tr></table></figure><p>以上代码可以简写成</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// json解析文件</span></span><br><span class="line"><span class="keyword">conf</span> := configFile&#123;&#125;</span><br><span class="line">decoder := json.NewDecoder(<span class="keyword">file</span>).<span class="keyword">Decode</span>(&amp;<span class="keyword">conf</span>)</span><br></pre></td></tr></table></figure><h3 id="完整实例"><a href="#完整实例" class="headerlink" title="完整实例"></a>完整实例</h3><p>读取配置文件config.json的配置属性</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 配置文件结构体</span></span><br><span class="line"><span class="keyword">type</span> configFile <span class="keyword">struct</span> &#123;</span><br><span class="line">Host <span class="keyword">string</span></span><br><span class="line">Port <span class="keyword">int</span></span><br><span class="line">Path <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">file, err := os.Open(<span class="string">"./config.json"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"读取文件失败,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭文件</span></span><br><span class="line"><span class="keyword">defer</span>  file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// json解析文件</span></span><br><span class="line">conf := configFile&#123;&#125;</span><br><span class="line">decoder := json.NewDecoder(file).Decode(&amp;conf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> decoder !=<span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"解析配置文件失败,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取配置并赋值到变量</span></span><br><span class="line">host := conf.Host</span><br><span class="line"></span><br><span class="line">port := conf.Port</span><br><span class="line"></span><br><span class="line">path :=  conf.Path</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"IP:%v,端口:%v,配置文件:%v"</span>,host,port,path)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 端口扫描</title>
      <link href="2020/05/20/golang-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/"/>
      <url>2020/05/20/golang-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><p>简要端口扫描程序代码,可通过用户输入及端口扫描并获得状态。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>  main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"flag"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"net"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义flag</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">serverIp   = flag.String(<span class="string">"ip"</span>, <span class="string">""</span>, <span class="string">"Server Ip address"</span>)</span><br><span class="line">startPort = flag.Int(<span class="string">"s"</span>, <span class="number">0</span>, <span class="string">"Start Port"</span>)</span><br><span class="line">endPort = flag.Int(<span class="string">"n"</span>, <span class="number">0</span>, <span class="string">"End Port"</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkPort 检查端口状态</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkPort</span><span class="params">(ip <span class="keyword">string</span>,port <span class="keyword">int</span>,wg *sync.WaitGroup)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span>  wg.Done()</span><br><span class="line">conn, err := net.DialTimeout(<span class="string">"tcp"</span>, fmt.Sprintf(<span class="string">"%s:%d"</span>, ip, port), time.Second * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"端口打开-------------:%v\n"</span>,port)</span><br><span class="line">conn.Close()  <span class="comment">//关闭连接</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析flag输入</span></span><br><span class="line">flag.Parse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag.NFlag() &lt;= <span class="number">1</span> &#123; <span class="comment">//Flag返回解析时进行了设置的flag的数量。</span></span><br><span class="line">flag.Usage() <span class="comment">//当参数小于1个打印flag的默认提示</span></span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=*startPort;i&lt;*endPort;i++&#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> checkPort(*serverIp,i,&amp;wg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wg.Wait()</span><br><span class="line">fmt.Printf(<span class="string">"扫描完毕\n"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><p>编译</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build GoPortScan.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p>使用方法</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage of GoPortScan.exe:</span><br><span class="line">  -ip string</span><br><span class="line">       <span class="built_in"> Server Ip </span>address</span><br><span class="line">  -n int</span><br><span class="line">        End Port</span><br><span class="line">  -s int</span><br><span class="line">        Start Port</span><br></pre></td></tr></table></figure><p>执行结果</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GoPortScan.exe -ip <span class="number">36.110</span><span class="number">.236</span><span class="number">.68</span> -s <span class="number">1</span> -n <span class="number">9090</span></span><br><span class="line">端口打开-------------:<span class="number">80</span></span><br><span class="line">端口打开-------------:<span class="number">443</span></span><br><span class="line">扫描完毕</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang goroutine与channel</title>
      <link href="2020/05/19/golang-goroutine%E4%B8%8Echannel/"/>
      <url>2020/05/19/golang-goroutine%E4%B8%8Echannel/</url>
      
        <content type="html"><![CDATA[<h3 id="并发与并行"><a href="#并发与并行" class="headerlink" title="并发与并行"></a>并发与并行</h3><p>并发:同一时间段内执行多个任务<br>并行:同一时刻执行多个任务</p><p>golang的并发使用goroutine来实现。goroutine类似于线程，属于用户态的线程，可以根据需要创建成千上万个goroutine并发工作。</p><p>Go还提供channel在多个goroutine间通信。goroutine和channel是GO CSP 并发模式的重要实现基础。</p><h3 id="启动goroutine"><a href="#启动goroutine" class="headerlink" title="启动goroutine"></a>启动goroutine</h3><p>开启goroutine 只需要在函数前面加go 关键字即可。</p><h3 id="并发实例"><a href="#并发实例" class="headerlink" title="并发实例"></a>并发实例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"HELLO"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;  <span class="comment">//开启一个主goroutine去执行main函数</span></span><br><span class="line"><span class="keyword">go</span> hello() <span class="comment">//开启一个goroutine去执行hello函数 有可能不输出Hello</span></span><br><span class="line">fmt.Println(<span class="string">"start"</span>)</span><br><span class="line"><span class="comment">//time.Sleep(time.Second * 1)  不建议使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="匿名函数goroutine"><a href="#匿名函数goroutine" class="headerlink" title="匿名函数goroutine"></a>匿名函数goroutine</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;  <span class="comment">// 开启一个主goroutine去执行main函数</span></span><br><span class="line"></span><br><span class="line">wg.Add(<span class="number">100</span>) <span class="comment">//计数</span></span><br><span class="line"><span class="comment">// 启动100个线程</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++ &#123;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"hello"</span>,i)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">"start"</span>)</span><br><span class="line">wg.Wait()  <span class="comment">//等待所有线程都执行完才结束 是阻塞状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过GOMAXPROCS可以设置当前GO占用CPU的核心数</p><p>Go语言中的操作系统线程和goroutine的关系：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>一个操作系统线程对应用户态多个goroutine.</span><br><span class="line"><span class="number">2.</span>go程序可以同时使用多个操作系统线程.</span><br><span class="line"><span class="number">3.</span>goroutine和OS线程是多对多的关系</span><br></pre></td></tr></table></figure><h3 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h3><p>channel是一种类型</p><p>不同的goroutine之间的数据交互采用channel(通道)。通道像一个传送带或者队列，遵循先入先出(FIFO)的规则，保证数据的顺序。</p><h3 id="声明channel类型"><a href="#声明channel类型" class="headerlink" title="声明channel类型"></a>声明channel类型</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// var 变量  chan  元素类型</span></span><br><span class="line"><span class="keyword">var</span> ch1 <span class="keyword">chan</span>  <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">fmt.Println(ch1)  <span class="comment">//默认是nil</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建通道使用make方法"><a href="#创建通道使用make方法" class="headerlink" title="创建通道使用make方法"></a>创建通道使用make方法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">string</span>,<span class="number">20</span>)  <span class="comment">//20为缓存区大小</span></span><br><span class="line">fmt.Println(ch2)</span><br></pre></td></tr></table></figure><h3 id="channel操作"><a href="#channel操作" class="headerlink" title="channel操作"></a>channel操作</h3><h4 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch1&lt;<span class="number">-10</span></span><br></pre></td></tr></table></figure><h4 id="接收"><a href="#接收" class="headerlink" title="接收"></a>接收</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x:= &lt;- ch1</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// var 变量  chan  元素类型</span></span><br><span class="line"><span class="keyword">var</span> ch1  <span class="keyword">chan</span>  <span class="keyword">int</span></span><br><span class="line">ch1 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">10</span>)  <span class="comment">//ch1 = make(chan int) 无缓冲区通道</span></span><br><span class="line">ch1 &lt;- <span class="number">20</span>  <span class="comment">//将20发送到ch1</span></span><br><span class="line">x := &lt;- ch1</span><br><span class="line">fmt.Println(x)</span><br><span class="line"><span class="built_in">close</span>(ch1)   <span class="comment">//关闭通道</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是无缓冲区通道发送时会阻塞，只有当另一个通道去获取通道数据后才可以。<br>带缓存区通道可以存放缓冲区大小的数据，并不会阻塞，是个异步通道。</p><p>实例:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch1 <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++&#123;</span><br><span class="line"></span><br><span class="line">ch1 &lt;- i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(ch1,ch2 <span class="keyword">chan</span>  <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"><span class="comment">//从通道中取值1</span></span><br><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line">tmp,ok := &lt;-ch1</span><br><span class="line"><span class="keyword">if</span> !ok&#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">ch2 &lt;- tmp * tmp</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(ch2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// var 变量  chan  元素类型</span></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">100</span>)</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> f1(ch1)</span><br><span class="line"><span class="keyword">go</span> f2(ch1,ch2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//从通道中取值2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ret:=<span class="keyword">range</span> ch2&#123;</span><br><span class="line">fmt.Println(ret)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="单向通道"><a href="#单向通道" class="headerlink" title="单向通道"></a>单向通道</h4><p>一般用在给函数传递参数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch1 <span class="keyword">chan</span> &lt;- <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++&#123;</span><br><span class="line"></span><br><span class="line">ch1 &lt;- i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="worker-pool-goroutine池"><a href="#worker-pool-goroutine池" class="headerlink" title="worker pool(goroutine池)"></a>worker pool(goroutine池)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="keyword">int</span>,jobs&lt;-<span class="keyword">chan</span> <span class="keyword">int</span>,results <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> job := <span class="keyword">range</span> jobs&#123;</span><br><span class="line">fmt.Printf(<span class="string">"worker:%d,start job:%d\n"</span>,id,job)</span><br><span class="line">results &lt;- job*<span class="number">2</span></span><br><span class="line"></span><br><span class="line">time.Sleep(time.Millisecond* <span class="number">500</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">jobs :=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">100</span>)</span><br><span class="line">results :=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3个goroutine</span></span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++&#123;</span><br><span class="line"><span class="keyword">go</span> worker(j,jobs,results)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5个任务</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++&#123;</span><br><span class="line">jobs &lt;- i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(jobs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++&#123;</span><br><span class="line">ret := &lt;- results</span><br><span class="line">fmt.Println(ret)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="select-多路复用"><a href="#select-多路复用" class="headerlink" title="select 多路复用"></a>select 多路复用</h3><p>select 随机执行一个可运行的 case。如果没有 case 可运行，它将阻塞，直到有 case 可运行。一个默认的子句应该总是可运行的。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">每个 case 都必须是一个通信</span><br><span class="line">所有 channel 表达式都会被求值</span><br><span class="line">所有被发送的表达式都会被求值</span><br><span class="line">如果任意某个通信可以进行，它就执行，其他被忽略。</span><br><span class="line">如果有多个 case 都可以运行，Select 会随机公平地选出一个执行。其他不会执行。</span><br><span class="line"></span><br><span class="line">否则：</span><br><span class="line">1.如果有<span class="built_in"> default </span>子句，则执行该语句。</span><br><span class="line">2.如果没有<span class="built_in"> default </span>子句，select 将阻塞，直到某个通信可以运行；Go 不会重新对 channel 或值进行求值。</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">ch :=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> x:=&lt;-ch:</span><br><span class="line">fmt.Println(x)</span><br><span class="line"><span class="keyword">case</span> ch&lt;-i:</span><br><span class="line">fmt.Println(i,<span class="string">"232323"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">"不做操作"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 反射</title>
      <link href="2020/05/19/golang-%E5%8F%8D%E5%B0%84/"/>
      <url>2020/05/19/golang-%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<p>参考:<a href="https://blog.csdn.net/u011957758/article/details/81193806" target="_blank" rel="noopener">https://blog.csdn.net/u011957758/article/details/81193806</a></p><h3 id="Golang反射"><a href="#Golang反射" class="headerlink" title="Golang反射"></a>Golang反射</h3><p>Golang提供了一种机制，在编译时不知道类型的情况下，可更新变量、运行时查看值、调用方法以及直接对他们的布局进行操作的机制，称为反射。</p><h3 id="为什么需要反射"><a href="#为什么需要反射" class="headerlink" title="为什么需要反射"></a>为什么需要反射</h3><p>打个比方，有时候我们需要一个函数可以处理各种类型的值。在不知道类型的情况下，你可能会这么写。</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码</span></span><br><span class="line"><span class="keyword">switch</span> <span class="keyword">value</span> := <span class="keyword">value</span>.(type) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line"><span class="comment">// ...一些操作</span></span><br><span class="line"><span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line"><span class="comment">// ...一些操作</span></span><br><span class="line"><span class="keyword">case</span> cbsStruct: <span class="comment">// 自定义的结构体</span></span><br><span class="line"><span class="comment">// ...一些操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有没发现什么问题？<br>这边存在一个问题：类型很多，这个函数会写的非常长，而且还可能存在自定的类型，也就是说这个判断日后可能还要一直改，因为无法知道未知值到底属于什么类型。</p><p>无法透视一个未知类型的时候，以上代码其实不是很合理，这时候就需要有反射来帮忙你处理，反射使用TypeOf和ValueOf函数从接口中获取目标对象的信息，轻松完成目的</p><h3 id="reflect"><a href="#reflect" class="headerlink" title="reflect"></a>reflect</h3><p>他提供了两种类型来进行访问接口变量的内容:1.reflect.ValueOf(),2.reflect.TypeOf()</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverName = <span class="string">"web服务器"</span></span><br><span class="line"></span><br><span class="line">fmt.Println(serverName)</span><br><span class="line"></span><br><span class="line">reflectType := reflect.TypeOf(serverName)</span><br><span class="line">reflectValue := reflect.ValueOf(serverName)</span><br><span class="line">fmt.Println(reflectType,reflectValue)</span><br></pre></td></tr></table></figure><p>输出结果为:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> web服务器</span><br></pre></td></tr></table></figure><p>Go语言中反射中数组、切片、Map、指针等类型的变量，它们的.Name()都是返回为空。</p><h3 id="结构体反射"><a href="#结构体反射" class="headerlink" title="结构体反射"></a>结构体反射</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:"name" ini:"s_name"`</span></span><br><span class="line">Score <span class="keyword">int</span> <span class="string">`json:"score" ini:"s_score"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">stu1 := student&#123;</span><br><span class="line"><span class="string">"roddy"</span>,</span><br><span class="line"><span class="number">90</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过反射获取结构体中的所有字段信息</span></span><br><span class="line"></span><br><span class="line">t:=reflect.TypeOf(stu1)</span><br><span class="line">fmt.Println(t.Name(),t.Kind())</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历结构体变量的所有字段</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;t.NumField();i++&#123;</span><br><span class="line">fileObj := t.Field(i)</span><br><span class="line"><span class="comment">//fmt.Println(fileObj.Name,fileObj.PkgPath,fileObj.Tag,fileObj.Type)</span></span><br><span class="line"></span><br><span class="line">fmt.Println(fileObj.Tag.Get(<span class="string">"json"</span>),fileObj.Tag.Get(<span class="string">"ini"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据名字去获取结构体字段</span></span><br><span class="line"></span><br><span class="line">filedObj2,ok :=t.FieldByName(<span class="string">"Score"</span>)</span><br><span class="line"><span class="keyword">if</span> ok&#123;</span><br><span class="line">fmt.Println(filedObj2.Tag.Get(<span class="string">"json"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 结构体与json</title>
      <link href="2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8Ejson/"/>
      <url>2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8Ejson/</url>
      
        <content type="html"><![CDATA[<h3 id="结构体可见性"><a href="#结构体可见性" class="headerlink" title="结构体可见性"></a>结构体可见性</h3><p>如果一个Go语言中定义的标识符是首字母大写的,那么对外可见</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Miners <span class="keyword">struct</span> &#123;</span><br><span class="line">WorkerName <span class="keyword">string</span>  <span class="comment">//首字母大写</span></span><br><span class="line">Cgminer  <span class="keyword">string</span></span><br><span class="line">Pool  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结构体与JSON"><a href="#结构体与JSON" class="headerlink" title="结构体与JSON"></a>结构体与JSON</h3><p>JSON一种轻量级的数据交换格式，易于阅读，通过使用前后端分离项目。利用API获取数据并解析，主要用于数据交互。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Book <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span>     <span class="comment">//字段名必须是大写否则不可见 定制化展示tag  `json:"student_id"`</span></span><br><span class="line">Sn <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">t := Book&#123;<span class="string">"百世go"</span>,<span class="string">"SN2323232323232323"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//json 序列化数据</span></span><br><span class="line"></span><br><span class="line">data,err:=json.Marshal(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"json 格式化错误,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>格式输出:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"Name"</span>:<span class="string">"百世go"</span>,<span class="attr">"Sn"</span>:<span class="string">"SN2323232323232323"</span>&#125;</span><br></pre></td></tr></table></figure><p>Make10条数据并且以array格式输出</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Book <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Sn <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//book的构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBook</span><span class="params">(name,sn <span class="keyword">string</span>)</span> <span class="title">Book</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> Book&#123;</span><br><span class="line">Name:name,</span><br><span class="line">Sn:sn,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">book_list := <span class="built_in">make</span>([]Book,<span class="number">0</span>,<span class="number">20</span>)  <span class="comment">//make一个slice序列</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line"></span><br><span class="line">b1:=NewBook(fmt.Sprintf(<span class="string">"django%v"</span>,i),fmt.Sprintf(<span class="string">"232344422%v"</span>,i))</span><br><span class="line">book_list = <span class="built_in">append</span>(book_list,b1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//json 序列化数据</span></span><br><span class="line"></span><br><span class="line">data,err:=json.Marshal(book_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"json 格式化错误,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="attr">"Name"</span>:<span class="string">"django0"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444220"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django1"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444221"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django2"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444222"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django3"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444223"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django4"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444224"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django5"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444225"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django6"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444226"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django7"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444227"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django8"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444228"</span>&#125;,&#123;<span class="attr">"Name"</span>:<span class="string">"django9"</span>,<span class="attr">"Sn"</span>:<span class="string">"2323444229"</span>&#125;]</span><br></pre></td></tr></table></figure><h3 id="反序列成JSON"><a href="#反序列成JSON" class="headerlink" title="反序列成JSON"></a>反序列成JSON</h3><p>使用json.Unmarshal</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//json反序列化</span></span><br><span class="line"></span><br><span class="line">Jsostr := <span class="string">`&#123;"Name":"百世go","Sn":"SN2323232323232323"&#125;`</span></span><br><span class="line"><span class="keyword">var</span> c2 Book</span><br><span class="line">err =json.Unmarshal([]<span class="keyword">byte</span>(Jsostr),&amp;c2)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"json 解析失败 err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(c2)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 结构体嵌套</title>
      <link href="2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E5%B5%8C%E5%A5%97/"/>
      <url>2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E5%B5%8C%E5%A5%97/</url>
      
        <content type="html"><![CDATA[<h3 id="结构体匿名字段"><a href="#结构体匿名字段" class="headerlink" title="结构体匿名字段"></a>结构体匿名字段</h3><p>如果不给结构体声明字段名,那该字段为匿名字段</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="keyword">string</span></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//匿名字段类型不能重复</span></span><br><span class="line">p1 := User&#123;</span><br><span class="line"><span class="string">"roddy"</span>,</span><br><span class="line"><span class="number">18</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//直接使用类型访问值即可</span></span><br><span class="line">fmt.Println(p1,p1.<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结构体嵌套"><a href="#结构体嵌套" class="headerlink" title="结构体嵌套"></a>结构体嵌套</h3><p>结构体可以嵌套另一个结构体以作关联，下面以服务器和IDC为例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IDC <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">address <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CloudServer <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">ip <span class="keyword">string</span></span><br><span class="line">cpu <span class="keyword">int8</span></span><br><span class="line">disk <span class="keyword">int32</span></span><br><span class="line">mem <span class="keyword">int8</span></span><br><span class="line">net <span class="keyword">float32</span></span><br><span class="line">idc IDC    <span class="comment">//嵌套另外的结构体</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">s1 := CloudServer&#123;</span><br><span class="line"><span class="string">"webserver"</span>,</span><br><span class="line"><span class="string">"10.10.1.1"</span>,</span><br><span class="line"><span class="number">4</span>,</span><br><span class="line"><span class="number">500</span>,</span><br><span class="line"><span class="number">8</span>,</span><br><span class="line"><span class="number">8</span>,</span><br><span class="line">IDC&#123;</span><br><span class="line"><span class="string">"北京1区"</span>,</span><br><span class="line"><span class="string">"北京xxxxx路"</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(s1.idc.name,s1)</span><br><span class="line">fmt.Println(s1.name)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匿名嵌套结构体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> IDC <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">address <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CloudServer <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">ip <span class="keyword">string</span></span><br><span class="line">cpu <span class="keyword">int8</span></span><br><span class="line">disk <span class="keyword">int32</span></span><br><span class="line">mem <span class="keyword">int8</span></span><br><span class="line">net <span class="keyword">float32</span></span><br><span class="line">IDC    <span class="comment">//匿名嵌套另外的结构体   不声明字段名</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">s1 := CloudServer&#123;</span><br><span class="line"><span class="string">"webserver"</span>,</span><br><span class="line"><span class="string">"10.10.1.1"</span>,</span><br><span class="line"><span class="number">4</span>,</span><br><span class="line"><span class="number">500</span>,</span><br><span class="line"><span class="number">8</span>,</span><br><span class="line"><span class="number">8</span>,</span><br><span class="line">IDC&#123;</span><br><span class="line"><span class="string">"北京1区"</span>,</span><br><span class="line"><span class="string">"北京xxxxx路"</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//fmt.Println(s1.idc.name,s1)</span></span><br><span class="line">fmt.Println(s1.address)        <span class="comment">//直接可访问嵌套结构体里的字段 如果嵌套结构体中使用多个重名字段话需要声明访问哪个结构体</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 方法和接收者</title>
      <link href="2020/05/18/golang-%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E6%94%B6%E8%80%85/"/>
      <url>2020/05/18/golang-%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E6%94%B6%E8%80%85/</url>
      
        <content type="html"><![CDATA[<h3 id="方法和接收者"><a href="#方法和接收者" class="headerlink" title="方法和接收者"></a>方法和接收者</h3><p>Go语言中的方法是一种作用于特定类型变量的函数。这种特定类型变量叫做接收者。接收者的概念类似于其它语言中的this 或者self。</p><p>接收者的参数在命名时，官方建议使用接收者类型名的第一个小写字母。<br>接收者类型：接收者类型和参数类似，可以是指针类型和非指针类型。<br>方法名、参数列表、返回参数:具体格式与函数定义相同</p><p>例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Server是一个结构体</span></span><br><span class="line"><span class="keyword">type</span> server <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">ip <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造一个Server的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(name,ip <span class="keyword">string</span>)</span> *<span class="title">server</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &amp;server&#123;</span><br><span class="line">name:name,</span><br><span class="line">ip:ip,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数不属于任何类型,可以在任何地方调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方法属于具体类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义方法 Check and Ping</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s server)</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"%s\n"</span>,s.ip)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s server)</span> <span class="title">Ping</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"正在检查ping %s\n"</span>,s.ip)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">server1 := NewServer(<span class="string">"news"</span>,<span class="string">"192.168.1.2"</span>)</span><br><span class="line">server1.Check()</span><br><span class="line"><span class="comment">//(*server1).Ping()</span></span><br><span class="line">server1.Ping()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="指针类型的接收者"><a href="#指针类型的接收者" class="headerlink" title="指针类型的接收者"></a>指针类型的接收者</h3><p>指针类型的接收者由一个结构体指针组成，由于指针特性，调用方法时修改接收者指针的任意成员变量，在方法结束后，修改都是有效的。例如修改服务器IP</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指针接收者,类型是指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *server)</span> <span class="title">ChangeIp</span><span class="params">(ip <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"修改前的IP:"</span>,s.ip)</span><br><span class="line"></span><br><span class="line">s.ip=ip</span><br><span class="line">fmt.Println(<span class="string">"修改后的IP:"</span>,s.ip)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">server1 := NewServer(<span class="string">"news"</span>,<span class="string">"192.168.1.2"</span>)</span><br><span class="line">server1.Check()</span><br><span class="line"><span class="comment">//(*server1).Ping()</span></span><br><span class="line">server1.Ping()</span><br><span class="line">server1.ChangeIp(<span class="string">"10.10.10.2"</span>)     <span class="comment">// 修改IP</span></span><br></pre></td></tr></table></figure><p><strong><em>值类型的接收者</em></strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//值接收者不会修改原来的值,只作用于当前函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s server)</span> <span class="title">ChangeValueIp</span><span class="params">(ip <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"修改前的IP:"</span>,s.ip)</span><br><span class="line"></span><br><span class="line">s.ip=ip</span><br><span class="line">fmt.Println(<span class="string">"修改后的IP:"</span>,s.ip)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用情况下使用指针类型</p><p>1.需要修改接收者中的值<br>2.接收者是拷贝代价比较大的对象<br>3.保证一致性，如果某个方法使用了指针接收者，那么其它的方法也应该使用指针接收者。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 结构体构造函数</title>
      <link href="2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/"/>
      <url>2020/05/18/golang-%E7%BB%93%E6%9E%84%E4%BD%93%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="构造体函数"><a href="#构造体函数" class="headerlink" title="构造体函数"></a>构造体函数</h3><p>构造一个结构体实例的函数就叫结构体构造函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name,city <span class="keyword">string</span></span><br><span class="line">age <span class="keyword">int8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造一个结构体函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newPerson</span><span class="params">(name,city <span class="keyword">string</span>,age <span class="keyword">int8</span>)</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回person结构体</span></span><br><span class="line"><span class="keyword">return</span> Person&#123;</span><br><span class="line">name:name,</span><br><span class="line">city:city,</span><br><span class="line">age:age,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果结构体数据过大，建议优化成结构体指针的方式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newPerson01</span><span class="params">(name,city <span class="keyword">string</span>,age <span class="keyword">int8</span>)</span> *<span class="title">Person</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回person结构体指针程序优化</span></span><br><span class="line"><span class="keyword">return</span> &amp;Person&#123;</span><br><span class="line">name:name,</span><br><span class="line">city:city,</span><br><span class="line">age:age,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">a :=newPerson(<span class="string">"roddy"</span>,<span class="string">"成都"</span>,<span class="number">29</span>)</span><br><span class="line">av :=newPerson01(<span class="string">"roddy01"</span>,<span class="string">"成都2"</span>,<span class="number">29</span>)</span><br><span class="line">fmt.Printf(<span class="string">"%#v\n"</span>,a)</span><br><span class="line">fmt.Println(av)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 标准库time</title>
      <link href="2020/05/15/golang-%E6%A0%87%E5%87%86%E5%BA%93time/"/>
      <url>2020/05/15/golang-%E6%A0%87%E5%87%86%E5%BA%93time/</url>
      
        <content type="html"><![CDATA[<h3 id="Time标准库"><a href="#Time标准库" class="headerlink" title="Time标准库"></a>Time标准库</h3><p>golang 时间显示和格式化等等操作主要是使用time包，日历的计算采用的是公历时间。</p><p>标准库用法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Now()</span><br><span class="line">Unix()</span><br><span class="line">Date()</span><br><span class="line">UnixNano()</span><br></pre></td></tr></table></figure><p>1.显示当前时间,返回的是Time类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">now := time.Now() <span class="comment">//时间对象</span></span><br><span class="line">fmt.Println(now)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果为</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-15</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">29.0136499</span> +<span class="number">0800</span> CST m=+<span class="number">0.004986301</span></span><br></pre></td></tr></table></figure><p>2.通过Time对象获取当前时间的年、月、日 小时、分钟等</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">now := time.Now() <span class="comment">//时间对象</span></span><br><span class="line">year := now.Year()  <span class="comment">//年</span></span><br><span class="line">month := now.Month()  <span class="comment">//月</span></span><br><span class="line">day := now.Day()     <span class="comment">//日</span></span><br><span class="line">hour := now.Hour()   <span class="comment">//小时</span></span><br><span class="line">minute := now.Minute() <span class="comment">//分钟</span></span><br><span class="line">second := now.Second()  <span class="comment">//秒</span></span><br></pre></td></tr></table></figure><p>3.Sleep沉睡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.Sleep(time.Second * <span class="number">1</span>)  <span class="comment">//沉睡1秒</span></span><br></pre></td></tr></table></figure><h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>1.获取当前的时间戳，从1970 01 01到现在的时间的秒数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">timeStamp1 := now.Unix()</span><br><span class="line">timeStamp2 := now.UnixNano()</span><br><span class="line">fmt.Println(timeStamp1)  <span class="comment">//当前世间戳</span></span><br><span class="line">fmt.Println(timeStamp2)  <span class="comment">//当前世间戳微秒，纳秒</span></span><br></pre></td></tr></table></figure><p>输出时间戳</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1589526157</span></span><br><span class="line"><span class="number">1589526157438067900</span></span><br></pre></td></tr></table></figure><p>2.通过时间戳转成Time时间格式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t:=time.Unix(<span class="number">1589514825</span>,<span class="number">0</span>) <span class="comment">//0纳秒</span></span><br><span class="line">fmt.Println(t)</span><br><span class="line">fmt.Printf(<span class="string">"%v年%v月%v日\n"</span>,t.Year(),t.Month(),t.Day())</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-15</span> <span class="number">11</span>:<span class="number">53</span>:<span class="number">45</span> +<span class="number">0800</span> CST</span><br><span class="line"><span class="number">2020</span>年May月<span class="number">15</span>日</span><br></pre></td></tr></table></figure><h3 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h3><p>定时器使用time.Tick()方法,可以用于写循环执行的定时任务。当使用Tick()时会返回一个channel。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> tmp  := <span class="keyword">range</span>  time.Tick(time.Second * <span class="number">3</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//do something</span></span><br><span class="line">fmt.Println(tmp)  <span class="comment">//每隔3秒打印当前时间</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tmp:= time.Tick(time.Second * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-tmp:</span><br><span class="line">fmt.Println(<span class="string">"执行任务"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取之后或者之前的时间"><a href="#获取之后或者之前的时间" class="headerlink" title="获取之后或者之前的时间"></a>获取之后或者之前的时间</h3><p>1.获取未来5小时的时间</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">currentTime := time.Now()</span><br><span class="line">newTime := currentTime.Add(time.Hour * <span class="number">5</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>获取昨日时间</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">currentTime := time.Now()</span><br><span class="line">oldTime := currentTime.AddDate(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>)  <span class="comment">//之前就是-1</span></span><br></pre></td></tr></table></figure><p>3.获取7天前的时间</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">currentTime := time.Now()</span><br><span class="line">oldTime := currentTime.AddDate(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-7</span>)</span><br></pre></td></tr></table></figure><p>4.获取5天后的时间</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">currentTime := time.Now()</span><br><span class="line">newTime := currentTime.AddDate(<span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>)   <span class="comment">//5天后的日期就是正整数</span></span><br></pre></td></tr></table></figure><p>5.两个时间相减</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">currentTime := time.Now()</span><br><span class="line">newTime := currentTime.Add(time.Hour * <span class="number">5</span>)</span><br><span class="line">t8:=newTime.Sub(currentTime)   </span><br><span class="line">fmt.Println(t8)</span><br></pre></td></tr></table></figure><h3 id="时间格式化"><a href="#时间格式化" class="headerlink" title="时间格式化"></a>时间格式化</h3><p>golang的时间格式化和其它语言格式化非常不一样，可以说独具一格。其它语言基本上为Y-m-d 或者YYYY-MM-DD这种类似。golang以是”2006 01 02 15 04 05”分别来代表<br>年、月、日、时、分、秒。记录口诀就是2006 1 2 3(下午的3点) 4 5 </p><table><thead><tr><th>类型</th><th>表示</th></tr></thead><tbody><tr><td>年</td><td>2006</td></tr><tr><td>月</td><td>01</td></tr><tr><td>日</td><td>02</td></tr><tr><td>时</td><td>15</td></tr><tr><td>分</td><td>04</td></tr><tr><td>秒</td><td>05</td></tr></tbody></table><p>样例<br>1.将当前时间格式成”2020/02/03 15:21:00”这种类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">currentTime := time.Now()</span><br><span class="line">currentStr := currentTime.Format(<span class="string">"2006/01/02 15:04:05"</span>)</span><br><span class="line">fmt.Println(currentStr)</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>/<span class="number">05</span>/<span class="number">15</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">13</span></span><br></pre></td></tr></table></figure><p>2.格式化精确到毫秒<br>在秒后面加上.000即可</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">currentTime := <span class="type">time</span>.Now()</span><br><span class="line">currentStr := currentTime.Format("2006/01/02 15:04:05.000")</span><br><span class="line">fmt.Println(currentStr)</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>/<span class="number">05</span>/<span class="number">15</span> <span class="number">15</span>:<span class="number">34</span>:<span class="number">52.040</span></span><br></pre></td></tr></table></figure><h3 id="解析字符串时间"><a href="#解析字符串时间" class="headerlink" title="解析字符串时间"></a>解析字符串时间</h3><p>如果解析一个字符串时间呢？比如我们现在要解析字符串”2020-03-25 05:02:00”<br>使用Parse会根据当前时区来解析</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">timeStr := <span class="string">"2020-03-25 05:02:00"</span></span><br><span class="line"></span><br><span class="line">strToTime,_ := time.Parse(<span class="string">"2006-01-02 15:04:05"</span>,timeStr)</span><br><span class="line">fmt.Println(strToTime,reflect.TypeOf(strToTime))</span><br></pre></td></tr></table></figure><p>将字符串时间解析成指定时区时间</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载时区</span></span><br><span class="line">loc,err := time.LoadLocation(<span class="string">"America/New_York"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeStr := <span class="string">"2020-03-25 05:02:00"</span></span><br><span class="line"></span><br><span class="line">strToTime,_ := time.ParseInLocation(<span class="string">"2006-01-02 15:04:05"</span>,timeStr,loc)  <span class="comment">//指定时区变量</span></span><br><span class="line">fmt.Println(strToTime,reflect.TypeOf(strToTime))</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">***将UTC时间"2020-05-14 02:08:23"转成当前时间***</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span> <span class="keyword">go</span> </span><br><span class="line">utcTime := <span class="string">"2020-05-14 02:08:23"</span></span><br><span class="line"></span><br><span class="line">tm,_:=time.Parse(<span class="string">"2006-01-02 15:04:05"</span>,utcTime)  <span class="comment">//先格式化成UTC的时间 </span></span><br><span class="line"></span><br><span class="line">timeStamp3:=tm.Unix()     <span class="comment">//获得时间戳</span></span><br><span class="line">tLocal:=time.Unix(timeStamp3,<span class="number">0</span>)  <span class="comment">//将时间戳转成Time类型</span></span><br><span class="line">fmt.Println(tLocal)    <span class="comment">//输出</span></span><br></pre></td></tr></table></figure><h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//时间类型比较,是否在Time之后</span></span><br><span class="line">After(u Time) <span class="keyword">bool</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//时间类型比较,是否在Time之前</span></span><br><span class="line">Before(u Time) <span class="keyword">bool</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//比较两个时间是否相等</span></span><br><span class="line">Equal(u Time) <span class="keyword">bool</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//判断时间是否为零值,如果sec和nsec两个属性都是0的话,则该时间类型为0</span></span><br><span class="line">IsZero() <span class="keyword">bool</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回年月日,三个参数</span></span><br><span class="line">Date() (year <span class="keyword">int</span>, month Month, day <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回年份</span></span><br><span class="line">Year() <span class="keyword">int</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回月份.是Month类型</span></span><br><span class="line">Month() Month </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回多少号</span></span><br><span class="line">Day() <span class="keyword">int</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回星期几,是Weekday类型</span></span><br><span class="line">Weekday() Weekday </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回年份,和该填是在这年的第几周.</span></span><br><span class="line">ISOWeek() (year, week <span class="keyword">int</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回小时,分钟,秒</span></span><br><span class="line">Clock() (hour, min, sec <span class="keyword">int</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回小时</span></span><br><span class="line">Hour() <span class="keyword">int</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回分钟</span></span><br><span class="line">Minute() <span class="keyword">int</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回秒数</span></span><br><span class="line">Second() <span class="keyword">int</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回纳秒</span></span><br><span class="line">Nanosecond() <span class="keyword">int</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 文件写入</title>
      <link href="2020/05/14/golang-%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/"/>
      <url>2020/05/14/golang-%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="Write写入"><a href="#Write写入" class="headerlink" title="Write写入"></a>Write写入</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">func write()&#123;</span><br><span class="line">//os.O_TRUNC 会清空原来的文件</span><br><span class="line">//os.O_APPEND  在原来文件中追加</span><br><span class="line">fileObj,err:=os.OpenFile("xx.txt",os.O_CREATE|os.O_WRONLY|os.O_APPEND,0644)</span><br><span class="line"></span><br><span class="line">if err !=nil&#123;</span><br><span class="line">fmt.Printf("open file failed, err:%v\n",err)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">str := "成都"</span><br><span class="line">fileObj.Write([]byte(str))</span><br><span class="line">fileObj.WriteString("\n")</span><br><span class="line">fileObj.WriteString("哈哈哈")</span><br><span class="line">fileObj.WriteString("\n")</span><br><span class="line"></span><br><span class="line">defer fileObj.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bufio写入"><a href="#Bufio写入" class="headerlink" title="Bufio写入"></a>Bufio写入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeByBufio</span><span class="params">()</span></span>&#123;</span><br><span class="line">fileObj,err:=os.OpenFile(<span class="string">"xx.txt"</span>,os.O_CREATE|os.O_WRONLY|os.O_APPEND,<span class="number">0644</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"open file failed, err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> fileObj.Close()</span><br><span class="line">writer := bufio.NewWriter(fileObj)</span><br><span class="line">writer.WriteString(<span class="string">"xxxxxx"</span>)  <span class="comment">//将内容写入到缓冲区</span></span><br><span class="line">writer.Flush()  <span class="comment">//将缓存区内容写入磁盘</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ioutil写入"><a href="#Ioutil写入" class="headerlink" title="Ioutil写入"></a>Ioutil写入</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">func</span> <span class="selector-tag">writeByIoutil</span>()&#123;</span><br><span class="line"><span class="attribute">str </span>:= <span class="string">"测试123554434"</span></span><br><span class="line">err:=ioutil.<span class="built_in">WriteFile</span>(<span class="string">"./xx.txt"</span>,[]byte(str),<span class="number">0644</span>)</span><br><span class="line">if err != nil&#123;</span><br><span class="line"></span><br><span class="line">fmt.<span class="built_in">Printf</span>(<span class="string">"write file failed,err:%v\n"</span>,err)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 文件读取</title>
      <link href="2020/05/14/golang-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>2020/05/14/golang-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<p>golang文件读取3种方式</p><ul><li>1.按行读取</li><li>2.读取整个内容</li><li>3.分段读取</li></ul><h3 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h3><p>打开文件使用os模块,使用os.Open(文件路径)</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.<span class="keyword">Open</span>(<span class="string">"./xx.txt"</span>)</span><br></pre></td></tr></table></figure><p>参考实例</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fileObj,<span class="keyword">err</span> := os.<span class="keyword">Open</span>(<span class="string">"./test.txt"</span>) <span class="comment">//相对目录打开文件</span></span><br></pre></td></tr></table></figure><h3 id="按行读取文件"><a href="#按行读取文件" class="headerlink" title="按行读取文件"></a>按行读取文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"bufio"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fileObj,err:=os.Open(<span class="string">"./xx.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"read file failed,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> fileObj.Close()  <span class="comment">//defer关闭文件</span></span><br><span class="line">s :=bufio.NewReader(fileObj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;   <span class="comment">//for循环逐行读取文件</span></span><br><span class="line">reader,err := s.ReadString(<span class="string">'\n'</span>)  <span class="comment">//指定文件每行的换行符号</span></span><br><span class="line"></span><br><span class="line">fmt.Print(reader)    <span class="comment">//打印内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == io.EOF&#123;           <span class="comment">//如果是文件结尾会抛EOF错误</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="读取整个文件"><a href="#读取整个文件" class="headerlink" title="读取整个文件"></a>读取整个文件</h3><p>使用ioutil来读取整个文件内容，如果文件过大则不建议使用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">content,err:=ioutil.ReadFile(<span class="string">"./xx.txt"</span>)</span><br><span class="line"><span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"read file failed, err:%v\n"</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Print(<span class="keyword">string</span>(content))  <span class="comment">//将内容转成string输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="分块读取文件"><a href="#分块读取文件" class="headerlink" title="分块读取文件"></a>分块读取文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">fileObj,err := os.Open(<span class="string">"./xx.txt"</span>) <span class="comment">//相对目录打开文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"open file failed,err:%v\n"</span>,err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span>  fileObj.Close()  <span class="comment">//关闭文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp  = <span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">128</span>)   <span class="comment">//按字节数读取文件内容</span></span><br><span class="line">n,err:=fileObj.Read(tmp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == io.EOF&#123;</span><br><span class="line">fmt.Print(<span class="keyword">string</span>(tmp[:n]))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"read  from file failed, err:%v\n"</span>,err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Print(<span class="keyword">string</span>(tmp))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 函数学习(三)</title>
      <link href="2020/05/07/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%B8%89/"/>
      <url>2020/05/07/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%B8%89/</url>
      
        <content type="html"><![CDATA[<h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><p>panic主要用于作异常处理，是一个内建的停止控制流函数。相当于其它编程语言的抛异常。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getname</span><span class="params">()</span> <span class="title">string</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"name"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"starting......!"</span>)</span><br><span class="line"></span><br><span class="line">a :=<span class="number">23</span></span><br><span class="line"><span class="keyword">if</span> a == <span class="number">23</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">"crash"</span>) <span class="comment">//手动触发宕机</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(getname())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="recover"><a href="#recover" class="headerlink" title="recover"></a>recover</h3><p>recover是内建函数，可以让进入宕机流程恢复回来，同时recover仅在defer中有效。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getname</span><span class="params">()</span> <span class="title">string</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"name"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">err:=<span class="built_in">recover</span>()</span><br><span class="line"><span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"触发宕机捕获异常:"</span>,err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()  <span class="comment">//recover只能在defer中</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"starting......!"</span>)</span><br><span class="line"></span><br><span class="line">a :=<span class="number">23</span></span><br><span class="line"><span class="keyword">if</span> a == <span class="number">23</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">"crash"</span>) <span class="comment">//手动触发宕机,后面的代码不会执行</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(getname())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 指针</title>
      <link href="2020/05/07/golang-%E6%8C%87%E9%92%88/"/>
      <url>2020/05/07/golang-%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<h3 id="Golang-指针"><a href="#Golang-指针" class="headerlink" title="Golang 指针"></a>Golang 指针</h3><p>指针就是一个变量，用于存储另一个变量的内存地址。这个内存地址往往是在内存中存储的另一个变量的值的起始位置。</p><p><strong>指针特点</strong></p><ul><li>默认值是nil，没有NULL常量</li><li>操作符”&amp;”用于获取变量地址,”*” 通过指针目标对象</li><li>不支持指针运算</li></ul><p><strong>实例</strong><br>声明一个变量x 并且设置值为1, 声明变量p 值为x的地址 </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">x := <span class="number">1</span></span><br><span class="line">p := &amp;x  <span class="comment">//&amp;获取x的地址</span></span><br><span class="line">fmt.Println(p) <span class="comment">//打印地址</span></span><br><span class="line">fmt.Println(x,*p) <span class="comment">//*p获取x所对应的值</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上输出结果为</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>通过指针修改变量的值</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">x := <span class="number">1</span></span><br><span class="line">p := &amp;x  <span class="comment">//&amp;获取x的地址</span></span><br><span class="line">fmt.Println(x,*p) <span class="comment">//*p获取x所对应的值</span></span><br><span class="line"></span><br><span class="line">*p = <span class="number">3</span> <span class="comment">//修改变量的值</span></span><br><span class="line"></span><br><span class="line">fmt.Println(x,*p)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果为</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">3</span>   //*p指向x 修改*p等于修改x</span><br></pre></td></tr></table></figure><p><strong>指针作用函数参数</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incr</span><span class="params">(p,b *<span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">*p++</span><br><span class="line">*b=*b+<span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">x := <span class="number">1</span></span><br><span class="line">c :=<span class="number">2</span></span><br><span class="line">p := &amp;x  <span class="comment">//&amp;获取x的地址</span></span><br><span class="line">fmt.Println(x,*p) <span class="comment">//*p获取x所对应的值</span></span><br><span class="line"></span><br><span class="line">*p = <span class="number">3</span> <span class="comment">//修改变量的值</span></span><br><span class="line"></span><br><span class="line">fmt.Println(x,*p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//将x地址传递给incr函数，然后返回变量修改</span></span><br><span class="line">incr(&amp;x,&amp;c)</span><br><span class="line">fmt.Println(x,c)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果为</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">32</span></span><br></pre></td></tr></table></figure><h3 id="new和make"><a href="#new和make" class="headerlink" title="new和make"></a>new和make</h3><p>在golang中,make和new都是分配内存的，但是它们之间还是有些区别的，只有理解了它们之间的不同，才能在合适的场合使用。</p><p>简单来说  new只是分配内存，不初始化内存,而make即分配又初始化内存。所谓的初始化就是给类型赋初值，比如字符为空，整型为0, 逻辑值为false等。</p><p>备注</p><ol><li>make 仅用来分配及初始化类型为 slice、map、chan 的数据。new 可分配任意类型的数据.</li><li>new 分配返回的是指针，即类型 *Type。make 返回引用，即 Type.</li><li>new 分配的空间被清零, make 分配空间后，会进行初始化.</li></ol><p>new返回的是一个指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name := <span class="built_in">new</span>(<span class="keyword">string</span>)</span><br><span class="line">server := <span class="built_in">new</span>(<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(name,server) <span class="comment">//输出0xc0000421f0 0xc000042200</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang Interface</title>
      <link href="2020/05/07/golang-Interface/"/>
      <url>2020/05/07/golang-Interface/</url>
      
        <content type="html"><![CDATA[<h3 id="golang-接口"><a href="#golang-接口" class="headerlink" title="golang 接口"></a>golang 接口</h3><p>接口可以理解为某一个方面的抽象，可以是多对一的(多个类型实现一个接口)，是多态的体现。</p><p>接口是一组包含方法名、参数、返回值的未具体实现的方法的集合。</p><h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> interfaceName <span class="keyword">interface</span> &#123; </span><br><span class="line"><span class="comment">// 方法列表 </span></span><br><span class="line">    GetName() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> interfaceName <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// 方法列表</span></span><br><span class="line">GetName() <span class="keyword">string</span></span><br><span class="line">GetAge() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>  Name <span class="keyword">struct</span> &#123;   <span class="comment">//定义结构体</span></span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Name)</span> <span class="title">GetName</span><span class="params">()</span> <span class="title">string</span></span>  &#123;   <span class="comment">//实现两个方法</span></span><br><span class="line"><span class="keyword">return</span> s.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Name)</span> <span class="title">GetAge</span><span class="params">()</span> <span class="title">int</span></span>  &#123;</span><br><span class="line"><span class="keyword">return</span> s.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">s := Name&#123;<span class="string">"roddy"</span>,<span class="number">28</span>&#125;     <span class="comment">//声明一个对象</span></span><br><span class="line">a := s.GetName()         </span><br><span class="line">fmt.Println(a,s.GetAge(),s.age)  <span class="comment">//调用对象中的方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h3><p>空接口就是不包含任何方法的接口。<strong>所有类型都实现了空接口</strong>，并且空接口可以存任何类型的数据。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allData <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">allData = <span class="number">234</span></span><br><span class="line"></span><br><span class="line">fmt.Println(allData,reflect.TypeOf(allData))</span><br></pre></td></tr></table></figure><p>覆盖变量值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allData <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> allList <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">allData = <span class="number">234</span></span><br><span class="line"></span><br><span class="line">fmt.Println(allData,reflect.TypeOf(allData))</span><br><span class="line"></span><br><span class="line">m :=<span class="number">123</span></span><br><span class="line">ms := <span class="string">"check all"</span></span><br><span class="line"></span><br><span class="line">allList = m</span><br><span class="line">allList = ms    <span class="comment">//可覆盖此前的变量值</span></span><br><span class="line">fmt.Println(allList)   <span class="comment">//此时的输出就为check all</span></span><br></pre></td></tr></table></figure><h3 id="接口零值"><a href="#接口零值" class="headerlink" title="接口零值"></a>接口零值</h3><p>接口的默认值为nil</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DefaultI <span class="keyword">interface</span> &#123;</span><br><span class="line">GetName()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mk DefaultI</span><br><span class="line">fmt.Println(mk)  <span class="comment">//接口的默认值为nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu配置nginx htpasswd访问密码</title>
      <link href="2020/04/28/ubuntu%E9%85%8D%E7%BD%AEnginx-htpasswd%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81/"/>
      <url>2020/04/28/ubuntu%E9%85%8D%E7%BD%AEnginx-htpasswd%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h3 id="Ubuntu-16-4-Nginx设置访问密码"><a href="#Ubuntu-16-4-Nginx设置访问密码" class="headerlink" title="Ubuntu 16.4 Nginx设置访问密码"></a>Ubuntu 16.4 Nginx设置访问密码</h3><p>1.安装apache2-utils </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@rodddy:/# apt-<span class="builtin-name">get</span> install apache2-utils</span><br><span class="line">Reading package lists<span class="built_in">..</span>. Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information<span class="built_in">..</span>. Done</span><br><span class="line">The following packages were automatically installed <span class="keyword">and</span> are <span class="literal">no</span> longer required:</span><br><span class="line">  libopts25 python-meld3 python-pkg-resources</span><br><span class="line">Use <span class="string">'apt autoremove'</span> <span class="keyword">to</span> <span class="builtin-name">remove</span> them.</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  libapr1 libaprutil1</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  apache2-utils libapr1 libaprutil1</span><br><span class="line">0 upgraded, 3 newly installed, 0 <span class="keyword">to</span> <span class="builtin-name">remove</span> <span class="keyword">and</span> 199 <span class="keyword">not</span> upgraded.</span><br><span class="line">Need <span class="keyword">to</span> <span class="builtin-name">get</span> 82.1 kB/245 kB of archives.</span><br><span class="line">After this operation, 810 kB of additional disk space will be used.</span><br><span class="line"><span class="keyword">Do</span> you want <span class="keyword">to</span> continue? [Y/n] y</span><br></pre></td></tr></table></figure><p>2.创建用户名和密码，并把用户名和密码保存到指定文件中</p><p>创建用户admin  保存的文件位置/usr/local/src/nginx/passwd</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@roddy:~# htpasswd -c /usr/local/src/nginx/passwd admin</span><br><span class="line">New password: </span><br><span class="line">Re-type new password: </span><br><span class="line">Adding password <span class="keyword">for</span><span class="built_in"> user </span>admin</span><br></pre></td></tr></table></figure><p>3.修改nginx配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line">   <span class="attr">listen</span> <span class="string">80;</span></span><br><span class="line">   <span class="attr">server_name</span>  <span class="string">localhost;</span></span><br><span class="line">   <span class="attr">.......</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">   #新增两行</span></span><br><span class="line">   <span class="attr">auth_basic</span> <span class="string">"Please input password"; #这里是提示信息 </span></span><br><span class="line">   <span class="attr">auth_basic_user_file</span> <span class="string">/usr/local/src/nginx/passwd;</span></span><br><span class="line"> </span><br><span class="line">   <span class="attr">location</span> <span class="string">/&#123;</span></span><br><span class="line">   <span class="attr">.......</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure><p>4.先检查下配置文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@roddy:~# nginx -t</span><br><span class="line">nginx: the configuration <span class="keyword">file</span> /etc/nginx/nginx.<span class="keyword">conf</span> <span class="keyword">syntax</span> <span class="keyword">is</span> ok</span><br><span class="line">nginx: configuration <span class="keyword">file</span> /etc/nginx/nginx.<span class="keyword">conf</span> test <span class="keyword">is</span> successful</span><br><span class="line">root@roddy:~#</span><br></pre></td></tr></table></figure><p>5.重新加载配置文件</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:~</span><span class="comment"># systemctl  reload nginx.service</span></span><br></pre></td></tr></table></figure><p>备注:</p><p>htpasswd命令选项参数说明</p><p>-c 创建一个加密文件<br>-n 不更新加密文件，只将htpasswd命令加密后的用户名密码显示在屏幕上<br>-m 默认htpassswd命令采用MD5算法对密码进行加密<br>-d htpassswd命令采用CRYPT算法对密码进行加密<br>-p htpassswd命令不对密码进行进行加密，即明文密码<br>-s htpassswd命令采用SHA算法对密码进行加密<br>-b htpassswd命令行中一并输入用户名和密码而不是根据提示输入密码<br>-D 删除指定的用户</p><p>创建用户</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:~</span><span class="comment"># htpasswd -c /usr/local/src/nginx/passwd admin</span></span><br></pre></td></tr></table></figure><p>添加用户(在原文件下)</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:~</span><span class="comment"># htpasswd  -b /usr/local/src/nginx/passwd  roddy 123456</span></span><br></pre></td></tr></table></figure><p>删除用户</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:~</span><span class="comment"># htpasswd -D /usr/local/src/nginx/passwd admin</span></span><br></pre></td></tr></table></figure><p>修改密码</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:~</span><span class="comment"># htpasswd -b /usr/local/src/nginx/passwd admin 12345678</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu删除apt源</title>
      <link href="2020/04/28/ubuntu%E5%88%A0%E9%99%A4apt%E6%BA%90/"/>
      <url>2020/04/28/ubuntu%E5%88%A0%E9%99%A4apt%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<p>1.进入到源列表文件目录</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:/</span><span class="comment"># cd  /etc/apt/sources.list.d/</span></span><br></pre></td></tr></table></figure><p>2.编辑源列表文件</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@roddy</span><span class="symbol">:/etc/apt/sources</span>.list.d/<span class="comment"># vim  nginx.list</span></span><br></pre></td></tr></table></figure><p>3.删除或者注释其中源即可</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang struct 结构体</title>
      <link href="2020/04/27/golang-struct-%E7%BB%93%E6%9E%84%E4%BD%93/"/>
      <url>2020/04/27/golang-struct-%E7%BB%93%E6%9E%84%E4%BD%93/</url>
      
        <content type="html"><![CDATA[<h3 id="golang-结构体"><a href="#golang-结构体" class="headerlink" title="golang 结构体"></a>golang 结构体</h3><p>什么是结构体？</p><p>结构体可以存不同项定义的数据类型，它是一组数据的集合。我们可以将数据按指定的格式进行保存和读取。</p><p>下面以一台服务器参数作为例子:</p><p>服务器名: ServerName<br>CPU: CPU<br>内存: Mem<br>硬盘: Disk<br>IP地址: IP</p><p>定义一个SERVER的结构体：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 结构体名 <span class="keyword">struct</span> &#123;</span><br><span class="line">member <span class="keyword">string</span> <span class="comment">// 成员及成员类型</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SERVER <span class="keyword">struct</span> &#123;</span><br><span class="line">ServerName <span class="keyword">string</span></span><br><span class="line">CPU <span class="keyword">int</span></span><br><span class="line">MEM <span class="keyword">int</span></span><br><span class="line">DISK <span class="keyword">int</span></span><br><span class="line">IP <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建结构体"><a href="#创建结构体" class="headerlink" title="创建结构体"></a>创建结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SERVER <span class="keyword">struct</span> &#123;</span><br><span class="line">ServerName <span class="keyword">string</span></span><br><span class="line">CPU <span class="keyword">int</span></span><br><span class="line">MEM <span class="keyword">int</span></span><br><span class="line">DISK <span class="keyword">int</span></span><br><span class="line">IP <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//&#123;HOSTNAME 4 8 500 200.2.14.2&#125; 创建一个结构体，并赋予值</span></span><br><span class="line">fmt.Println(SERVER&#123;<span class="string">"DBSERVER"</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">500</span>,<span class="string">"200.2.14.2"</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以使用KEY-&gt;VALUE格式定义一个结构体</span></span><br><span class="line">serverInfo := SERVER&#123;ServerName:<span class="string">"web server"</span>,CPU:<span class="number">4</span>,MEM:<span class="number">8</span>,DISK:<span class="number">200</span>,IP:<span class="string">"47.23.23.1"</span>&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(serverInfo.IP)</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果没有赋值，将使用缺省默认值</span></span><br><span class="line">webInfo := SERVER&#123;ServerName:<span class="string">"web 2server"</span>,DISK:<span class="number">200</span>,IP:<span class="string">"47.23.23.2"</span>&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(webInfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="访问成员"><a href="#访问成员" class="headerlink" title="访问成员"></a>访问成员</h3><p>使用方法为struct.xxxx 赋值或者访问</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SERVER <span class="keyword">struct</span> &#123;</span><br><span class="line">ServerName <span class="keyword">string</span></span><br><span class="line">CPU <span class="keyword">int</span></span><br><span class="line">MEM <span class="keyword">int</span></span><br><span class="line">DISK <span class="keyword">int</span></span><br><span class="line">IP <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line">newServer.ServerName = <span class="string">"new server"</span></span><br><span class="line">newServer.DISK = <span class="number">500</span></span><br><span class="line">newServer.MEM = <span class="number">4</span></span><br><span class="line">newServer.CPU = <span class="number">2</span></span><br><span class="line">newServer.IP = <span class="string">"2.2.3.2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"服务器名%s,磁盘:%d,内存:%d,CPU:%d,IP:%s"</span>, newServer.ServerName,</span><br><span class="line">newServer.DISK, newServer.MEM,</span><br><span class="line">newServer.CPU, newServer.IP,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结构体传递"><a href="#结构体传递" class="headerlink" title="结构体传递"></a>结构体传递</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetServerInfo</span><span class="params">(server SERVER)</span></span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"server ip:%s\n"</span>,server.IP)  <span class="comment">//访问结构体中的成员信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newServer SERVER</span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line">newServer.ServerName = <span class="string">"new server"</span></span><br><span class="line">newServer.DISK = <span class="number">500</span></span><br><span class="line">newServer.MEM = <span class="number">6</span></span><br><span class="line">newServer.CPU = <span class="number">2</span></span><br><span class="line">newServer.IP = <span class="string">"2.2.3.2"</span></span><br><span class="line"></span><br><span class="line">GetServerInfo(newServer)  <span class="comment">//将结构体传递给GetServerInfo函数</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结构体指针"><a href="#结构体指针" class="headerlink" title="结构体指针"></a>结构体指针</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结构体做为参数传递，如果要修改数据，需要用结构体指针方式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeServer</span><span class="params">(server *SERVER)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> server.MEM &gt; <span class="number">4</span>&#123;</span><br><span class="line">server.MEM = <span class="number">8</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newServer SERVER</span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line">newServer.ServerName = <span class="string">"new server"</span></span><br><span class="line">newServer.DISK = <span class="number">500</span></span><br><span class="line">newServer.MEM = <span class="number">6</span></span><br><span class="line">newServer.CPU = <span class="number">2</span></span><br><span class="line">newServer.IP = <span class="string">"2.2.3.2"</span></span><br><span class="line"></span><br><span class="line">changeServer(&amp;newServer) <span class="comment">//结构体指针传递</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"服务器名%s,磁盘:%d,内存:%d,CPU:%d,IP:%s"</span>, newServer.ServerName,</span><br><span class="line">newServer.DISK, newServer.MEM,</span><br><span class="line">newServer.CPU, newServer.IP,</span><br><span class="line">)</span><br><span class="line"><span class="comment">//结果server.MEM =8</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django vue 跨域问题解决</title>
      <link href="2020/04/27/django-vue-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
      <url>2020/04/27/django-vue-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<p>一直在做python后端开发，之前一直会遇见django 和vue结合后的垮域问题。现特记录下解决方法</p><h3 id="什么是跨域"><a href="#什么是跨域" class="headerlink" title="什么是跨域"></a>什么是跨域</h3><p>解释来源链接：<a href="https://www.jianshu.com/p/3961366f9ce9" target="_blank" rel="noopener">https://www.jianshu.com/p/3961366f9ce9</a></p><p>跨域是指一个域下的文档或脚本试图去请求另一个域下的资源，这里跨域是广义的。<br>其实我们通常所说的跨域是狭义的，是由浏览器同源策略限制的一类请求场景。</p><p>什么是同源策略？</p><p>同源策略/SOP（Same origin policy）是一种约定，由Netscape公司1995年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。所谓同源是指”协议+域名+端口”三者相同，即便两个不同的域名指向同一个ip地址，也非同源。</p><p>同源策略限制以下几种行为：</p><ul><li>Cookie、LocalStorage 和 IndexDB 无法读取</li><li>DOM 和 Js对象无法获得</li><li>AJAX 请求不能发送</li></ul><p>1.安装django-cors-headers</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> django-cors-headers</span><br></pre></td></tr></table></figure><p>2.配置settings.py文件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//将corsheaders添加到apps中</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">...</span><br><span class="line">    'corsheaders',</span><br><span class="line">    ....</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#跨域增加忽略</span></span><br><span class="line">CORS_ALLOW_CREDENTIALS = True</span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = True</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">    'http://localhost:8000',</span><br><span class="line">    'http://127.0.0.1:8000',</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_METHODS = (</span><br><span class="line">    '<span class="keyword">DELETE</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">GET</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span>OPTIONS<span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">PATCH</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span>POST<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>PUT<span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">VIEW</span><span class="string">',</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CORS_ALLOW_HEADERS = (</span></span><br><span class="line"><span class="string">    '</span>XMLHttpRequest<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>X_FILENAME<span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">accept</span>-<span class="keyword">encoding</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span>authorization<span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">content</span>-<span class="keyword">type</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span>dnt<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>origin<span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">user</span>-<span class="keyword">agent</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span>x-csrftoken<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>x-requested-<span class="keyword">with</span><span class="string">',</span></span><br><span class="line"><span class="string">    '</span><span class="keyword">Pragma</span><span class="string">',</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MIDDLEWARE = [</span></span><br><span class="line"><span class="string">    '</span>django.middleware.security.SecurityMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django.contrib.sessions.middleware.SessionMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>corsheaders.middleware.CorsMiddleware<span class="string">',  //将corshaders添加到common之上</span></span><br><span class="line"><span class="string">    '</span>django.middleware.common.CommonMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django.middleware.csrf.CsrfViewMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django.contrib.auth.middleware.AuthenticationMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django.contrib.messages.middleware.MessageMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django.middleware.clickjacking.XFrameOptionsMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>django_user_agents.middleware.UserAgentMiddleware<span class="string">',</span></span><br><span class="line"><span class="string">]</span></span><br></pre></td></tr></table></figure><p>3.重新启动项目即可</p>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 函数学习(二)</title>
      <link href="2020/04/27/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%BA%8C/"/>
      <url>2020/04/27/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>匿名函数就是一个没有名字的函数，只有函数体，函数可以被作为一种类型被赋值给函数类型的变量，匿名函数往往是以变量方式被传递。</p><p><strong>匿名函数的定义</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(参数列表)</span><span class="params">(返回值列表)</span> &#123;</span></span><br><span class="line">函数体</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调用方式</strong></p><ul><li>声明时直接调用</li><li>赋值给变量进行调用</li></ul><p>实例：匿名函数调用</p><p>1.声明时直接调用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//func (参数列表)(返回值列表) &#123;</span></span><br><span class="line"><span class="comment">//函数体</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(userId,age <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">"用户ID:%d,年龄:%d\n"</span>,userId,age)</span><br><span class="line">&#125;(<span class="number">1</span>,<span class="number">24</span>)<span class="comment">//声明时直接调用</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.赋值给变量调用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//func (参数列表)(返回值列表) &#123;</span></span><br><span class="line"><span class="comment">//函数体</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">result :=<span class="function"><span class="keyword">func</span> <span class="params">(a,b <span class="keyword">int</span> )</span><span class="title">int</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(result(<span class="number">2</span>,<span class="number">6</span>))   <span class="comment">//直接赋值给result，然后调用即可</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="全局匿名函数"><a href="#全局匿名函数" class="headerlink" title="全局匿名函数"></a>全局匿名函数</h3><p>以上我们的函数调用都是一个局部调用，如何进行全局调用呢，可以将匿名函数赋值给一个全局变量，就可以程序中使用了。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">//全局匿名函数</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">getResult = <span class="function"><span class="keyword">func</span><span class="params">(a,b <span class="keyword">int</span>,meth_type <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> meth_type == <span class="string">"+"</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a + b</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> meth_type == <span class="string">"-"</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a -b</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> meth_type == <span class="string">"*"</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a *b</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcMethod</span><span class="params">(a,b <span class="keyword">int</span>)</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加法</span></span><br><span class="line">add := getResult(a,b,<span class="string">"+"</span>)   <span class="comment">//函数中调用全局匿名函数</span></span><br><span class="line"><span class="comment">//减法</span></span><br><span class="line">sub := getResult(a,b,<span class="string">"-"</span>)</span><br><span class="line"><span class="comment">//乘法</span></span><br><span class="line">mul := getResult(a,b,<span class="string">"*"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> add,sub,mul</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">fmt.Println(funcMethod(<span class="number">1</span>,<span class="number">23</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数闭包"><a href="#函数闭包" class="headerlink" title="函数闭包"></a>函数闭包</h3><p>闭包就是一个函数与其相关的引用环境组成的一个整体。它本质上是一个函数,但是这个函数会用于函数外的变量，它们共同组成的整体称为闭包。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//累积数据,返回值是一个func  </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUpper</span><span class="params">()</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">n := <span class="number">10</span></span><br><span class="line">n -= <span class="number">1</span></span><br><span class="line">c := <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c -= <span class="number">2</span></span><br><span class="line">fmt.Println(c)</span><br><span class="line"></span><br><span class="line">n = n +x</span><br><span class="line"><span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">t := addUpper()  <span class="comment">//t变量用于接收返回的函数 </span></span><br><span class="line"></span><br><span class="line">fmt.Println(t(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="defer（延迟函数）"><a href="#defer（延迟函数）" class="headerlink" title="defer（延迟函数）"></a>defer（延迟函数）</h3><p>defer用来声明一个延迟函数，并把这个函数放到一个栈上，当外部的包含方法return之前，放回参数到调用方法之前调用。通常用于做资源释放，比如关闭io等。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//defer 用于程序释放资源,用于延迟操作。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//延迟调用，采用FILO(先进后出原则)  延迟函数执行按后进先出顺序执行，即先出现的defer后执行</span></span><br><span class="line">i:=<span class="number">0</span></span><br><span class="line"><span class="keyword">defer</span>  fmt.Println(i)</span><br><span class="line">i++</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">f()  <span class="comment">//结果是1 后是0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关闭文件io</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">closeFile</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">f, _ := os.Open(<span class="string">"Godefer.go"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//将文件名交给带有缓存的IO Reader</span></span><br><span class="line">r := bufio.NewReader(f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">line, err := r.ReadString(<span class="string">'\n'</span>) <span class="comment">//指定分割符</span></span><br><span class="line"><span class="comment">//判断是否是文件结尾</span></span><br><span class="line"><span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Print(line)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span>  f.Close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数作用域"><a href="#函数作用域" class="headerlink" title="函数作用域"></a>函数作用域</h3><p>1.在函数内部声明/定义的变量叫局部变量,<strong>作用域仅限于函数内部</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">change</span><span class="params">()</span></span>&#123;  </span><br><span class="line">a := <span class="number">124</span>    <span class="comment">//在change函数体内部声明的变量叫局部变量</span></span><br><span class="line">fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.函数外部声明/定义的变量叫全局变量,<strong>作用于在整个包内</strong>。如果变量的首字母大写，则可以外部访问调用(作用域为整个程序)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 外部变量</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">Name <span class="keyword">string</span> = <span class="string">"default"</span></span><br><span class="line">Age <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">change</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//修改的就是全局变量</span></span><br><span class="line">Name = <span class="string">"1234"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line"></span><br><span class="line">Age = <span class="number">100</span></span><br><span class="line">fmt.Println(Name,Age)</span><br><span class="line"></span><br><span class="line">change()</span><br><span class="line">Age = <span class="number">100</span></span><br><span class="line">fmt.Println(Name,Age)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 函数学习(一)</title>
      <link href="2020/04/26/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%B8%80/"/>
      <url>2020/04/26/golang-%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p>golang 的函数声明包含func关键字、函数名、形式参数列表（可省略）、返回值列表及函数体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncName</span><span class="params">(username <span class="keyword">string</span>,age <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最简单的函数定义如果，以func开头及函数名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Simple</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//表示该函数不需要输入参数，以及没有返回值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面通过两个实例来介绍下函数的使用</p><p>1.计算两个数相加。定义一下funcAdd 函数，接收两个参数a,b 类型为int  返回值为int。函数调用时，以函数名()的形式进行调用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcAdd</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span><span class="title">int</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(funcAdd(<span class="number">3</span>,<span class="number">5</span>))  <span class="comment">//输出结果为8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数返回时还可以直接以变量的形式进行返回</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcAdd</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="params">(result <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">result=a+b</span><br><span class="line"><span class="keyword">return</span>                  <span class="comment">//直接输入return进行返回即可</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(funcAdd(<span class="number">7</span>,<span class="number">8</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.计算商品价格。定义一个函数名加ShopPrice,接收几个参数，并且返回商品价格。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ShopPrice</span><span class="params">(s_price,number,sale <span class="keyword">float64</span>)</span><span class="params">(price <span class="keyword">float64</span>)</span></span>&#123;</span><br><span class="line"><span class="comment">//商品原价 * 数量 * 折扣</span></span><br><span class="line"><span class="comment">// 999.88 * 2 * 98/100</span></span><br><span class="line">price = s_price * number * sale / <span class="number">100.00</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(ShopPrice(<span class="number">999.25</span>,<span class="number">2</span>,<span class="number">98</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以返回多个数据,传入商品名、价格、数量。最后返回商品及计算结果</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ShopDetail</span><span class="params">(s_price,number,sale <span class="keyword">float64</span>,name <span class="keyword">string</span>)</span><span class="params">(<span class="keyword">float64</span>, <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line"><span class="comment">//商品原价 * 数量 * 折扣</span></span><br><span class="line"><span class="comment">// 999.88 * 2 * 98/100</span></span><br><span class="line">price := s_price * number * sale / <span class="number">100.00</span></span><br><span class="line"><span class="keyword">return</span> price,name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">price,name := ShopDetail(<span class="number">999.25</span>,<span class="number">2</span>,<span class="number">98</span>,<span class="string">"大衣"</span>)</span><br><span class="line">fmt.Println(<span class="string">"商品:"</span>,name,<span class="string">"价格:"</span>,price)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数多返回值"><a href="#函数多返回值" class="headerlink" title="函数多返回值"></a>函数多返回值</h3><p>在go中，一个函数可以接收多个参数列表，同时也可以返回多个值，便于我们进行处理。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AbcFunc</span><span class="params">(a,b,c <span class="keyword">int</span>)</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>&#123;   <span class="comment">//返回值为3个int数值</span></span><br><span class="line"><span class="keyword">return</span> c,b,a   <span class="comment">//将123 转成321输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">c,b,a := AbcFunc(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">fmt.Println(c,b,a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="空白符号的使用"><a href="#空白符号的使用" class="headerlink" title="空白符号的使用"></a>空白符号的使用</h3><p>如果在接收参数时，有不想使用的变量数值，可以使用_进行代替,程序不作处理。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nullValue</span><span class="params">(username <span class="keyword">string</span>,age <span class="keyword">int</span>,address <span class="keyword">string</span>)</span><span class="params">(<span class="keyword">string</span>,<span class="keyword">int</span>,<span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> username,age,address</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//_用于接收任何类型的任何值，如果以“_”表示，那将省略，可以理解为垃圾桶</span></span><br><span class="line">username,age,_ := nullValue(<span class="string">"roddy"</span>,<span class="number">27</span>,<span class="string">"sichuan"</span>)</span><br><span class="line">fmt.Println(username,age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数可变参数"><a href="#函数可变参数" class="headerlink" title="函数可变参数"></a>函数可变参数</h3><p>向函数传递一个未知数量的参数值时，可以使用…来代替，下面样例就是传递一个数字序列，然后分别打印出来例子。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func MultipleNumber(args ...<span class="built_in">int</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;len(args);i++&#123;</span><br><span class="line">fmt.Println(args[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line"></span><br><span class="line">MultipleNumber(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>输入一列数据，返回这组数据的最小值与最大值</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">package</span> main</span><br><span class="line"></span><br><span class="line">import <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">func MinMax(<span class="built_in">input</span> ...int)(<span class="built_in">min</span>,<span class="built_in">max</span> int)&#123;</span><br><span class="line"><span class="built_in">min</span> = <span class="built_in">input</span>[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">max</span> = <span class="built_in">input</span>[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i :=<span class="number">0</span>;i&lt;<span class="built_in">len</span>(<span class="built_in">input</span>);i++&#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>[i] &lt; <span class="built_in">min</span>&#123;</span><br><span class="line"><span class="built_in">min</span> = <span class="built_in">input</span>[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>[i] &gt;<span class="built_in">max</span> &#123;</span><br><span class="line"><span class="built_in">max</span> = <span class="built_in">input</span>[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line"><span class="built_in">min</span>,<span class="built_in">max</span> :=MinMax(<span class="number">1</span>,<span class="number">2</span>,<span class="number">34</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)</span><br><span class="line">fmt.Println(<span class="string">"最小值为:"</span>,<span class="built_in">min</span>,<span class="string">"最大值为:"</span>,<span class="built_in">max</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang 打印乘法表</title>
      <link href="2020/04/22/golang-%E6%89%93%E5%8D%B0%E4%B9%98%E6%B3%95%E8%A1%A8/"/>
      <url>2020/04/22/golang-%E6%89%93%E5%8D%B0%E4%B9%98%E6%B3%95%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="如何使用golang打印一个乘法表"><a href="#如何使用golang打印一个乘法表" class="headerlink" title="如何使用golang打印一个乘法表"></a>如何使用golang打印一个乘法表</h3><p>使用模块fmt，语法使用for循环嵌套，然后使用fmt.Printf格式化输出结果。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>;i&lt;=<span class="number">9</span>;i++ &#123;</span><br><span class="line"><span class="keyword">for</span> c:=<span class="number">1</span>;c&lt;=i;c++&#123;</span><br><span class="line">fmt.Printf(<span class="string">"%d * %d = %d "</span>,i,c,i*c)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时输出结果发现，细微发现数字没有对齐</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> * <span class="number">1</span> = <span class="number">1</span> </span><br><span class="line"><span class="number">2</span> * <span class="number">1</span> = <span class="number">2</span> <span class="number">2</span> * <span class="number">2</span> = <span class="number">4</span> </span><br><span class="line"><span class="number">3</span> * <span class="number">1</span> = <span class="number">3</span> <span class="number">3</span> * <span class="number">2</span> = <span class="number">6</span> <span class="number">3</span> * <span class="number">3</span> = <span class="number">9</span> </span><br><span class="line"><span class="number">4</span> * <span class="number">1</span> = <span class="number">4</span> <span class="number">4</span> * <span class="number">2</span> = <span class="number">8</span> <span class="number">4</span> * <span class="number">3</span> = <span class="number">12</span> <span class="number">4</span> * <span class="number">4</span> = <span class="number">16</span> </span><br><span class="line"><span class="number">5</span> * <span class="number">1</span> = <span class="number">5</span> <span class="number">5</span> * <span class="number">2</span> = <span class="number">10</span> <span class="number">5</span> * <span class="number">3</span> = <span class="number">15</span> <span class="number">5</span> * <span class="number">4</span> = <span class="number">20</span> <span class="number">5</span> * <span class="number">5</span> = <span class="number">25</span> </span><br><span class="line"><span class="number">6</span> * <span class="number">1</span> = <span class="number">6</span> <span class="number">6</span> * <span class="number">2</span> = <span class="number">12</span> <span class="number">6</span> * <span class="number">3</span> = <span class="number">18</span> <span class="number">6</span> * <span class="number">4</span> = <span class="number">24</span> <span class="number">6</span> * <span class="number">5</span> = <span class="number">30</span> <span class="number">6</span> * <span class="number">6</span> = <span class="number">36</span> </span><br><span class="line"><span class="number">7</span> * <span class="number">1</span> = <span class="number">7</span> <span class="number">7</span> * <span class="number">2</span> = <span class="number">14</span> <span class="number">7</span> * <span class="number">3</span> = <span class="number">21</span> <span class="number">7</span> * <span class="number">4</span> = <span class="number">28</span> <span class="number">7</span> * <span class="number">5</span> = <span class="number">35</span> <span class="number">7</span> * <span class="number">6</span> = <span class="number">42</span> <span class="number">7</span> * <span class="number">7</span> = <span class="number">49</span> </span><br><span class="line"><span class="number">8</span> * <span class="number">1</span> = <span class="number">8</span> <span class="number">8</span> * <span class="number">2</span> = <span class="number">16</span> <span class="number">8</span> * <span class="number">3</span> = <span class="number">24</span> <span class="number">8</span> * <span class="number">4</span> = <span class="number">32</span> <span class="number">8</span> * <span class="number">5</span> = <span class="number">40</span> <span class="number">8</span> * <span class="number">6</span> = <span class="number">48</span> <span class="number">8</span> * <span class="number">7</span> = <span class="number">56</span> <span class="number">8</span> * <span class="number">8</span> = <span class="number">64</span> </span><br><span class="line"><span class="number">9</span> * <span class="number">1</span> = <span class="number">9</span> <span class="number">9</span> * <span class="number">2</span> = <span class="number">18</span> <span class="number">9</span> * <span class="number">3</span> = <span class="number">27</span> <span class="number">9</span> * <span class="number">4</span> = <span class="number">36</span> <span class="number">9</span> * <span class="number">5</span> = <span class="number">45</span> <span class="number">9</span> * <span class="number">6</span> = <span class="number">54</span> <span class="number">9</span> * <span class="number">7</span> = <span class="number">63</span> <span class="number">9</span> * <span class="number">8</span> = <span class="number">72</span> <span class="number">9</span> * <span class="number">9</span> = <span class="number">81</span></span><br></pre></td></tr></table></figure><p>改进代码在=%d改成%-2d  2d表示2位数字。-标识缺省</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.<span class="constructor">Printf(<span class="string">"%d * %d = %-2d "</span>,<span class="params">i</span>,<span class="params">c</span>,<span class="params">i</span><span class="operator">*</span><span class="params">c</span>)</span></span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> * <span class="number">1</span> = <span class="number">1</span>  </span><br><span class="line"><span class="number">2</span> * <span class="number">1</span> = <span class="number">2</span>  <span class="number">2</span> * <span class="number">2</span> = <span class="number">4</span>  </span><br><span class="line"><span class="number">3</span> * <span class="number">1</span> = <span class="number">3</span>  <span class="number">3</span> * <span class="number">2</span> = <span class="number">6</span>  <span class="number">3</span> * <span class="number">3</span> = <span class="number">9</span>  </span><br><span class="line"><span class="number">4</span> * <span class="number">1</span> = <span class="number">4</span>  <span class="number">4</span> * <span class="number">2</span> = <span class="number">8</span>  <span class="number">4</span> * <span class="number">3</span> = <span class="number">12</span> <span class="number">4</span> * <span class="number">4</span> = <span class="number">16</span> </span><br><span class="line"><span class="number">5</span> * <span class="number">1</span> = <span class="number">5</span>  <span class="number">5</span> * <span class="number">2</span> = <span class="number">10</span> <span class="number">5</span> * <span class="number">3</span> = <span class="number">15</span> <span class="number">5</span> * <span class="number">4</span> = <span class="number">20</span> <span class="number">5</span> * <span class="number">5</span> = <span class="number">25</span> </span><br><span class="line"><span class="number">6</span> * <span class="number">1</span> = <span class="number">6</span>  <span class="number">6</span> * <span class="number">2</span> = <span class="number">12</span> <span class="number">6</span> * <span class="number">3</span> = <span class="number">18</span> <span class="number">6</span> * <span class="number">4</span> = <span class="number">24</span> <span class="number">6</span> * <span class="number">5</span> = <span class="number">30</span> <span class="number">6</span> * <span class="number">6</span> = <span class="number">36</span> </span><br><span class="line"><span class="number">7</span> * <span class="number">1</span> = <span class="number">7</span>  <span class="number">7</span> * <span class="number">2</span> = <span class="number">14</span> <span class="number">7</span> * <span class="number">3</span> = <span class="number">21</span> <span class="number">7</span> * <span class="number">4</span> = <span class="number">28</span> <span class="number">7</span> * <span class="number">5</span> = <span class="number">35</span> <span class="number">7</span> * <span class="number">6</span> = <span class="number">42</span> <span class="number">7</span> * <span class="number">7</span> = <span class="number">49</span> </span><br><span class="line"><span class="number">8</span> * <span class="number">1</span> = <span class="number">8</span>  <span class="number">8</span> * <span class="number">2</span> = <span class="number">16</span> <span class="number">8</span> * <span class="number">3</span> = <span class="number">24</span> <span class="number">8</span> * <span class="number">4</span> = <span class="number">32</span> <span class="number">8</span> * <span class="number">5</span> = <span class="number">40</span> <span class="number">8</span> * <span class="number">6</span> = <span class="number">48</span> <span class="number">8</span> * <span class="number">7</span> = <span class="number">56</span> <span class="number">8</span> * <span class="number">8</span> = <span class="number">64</span> </span><br><span class="line"><span class="number">9</span> * <span class="number">1</span> = <span class="number">9</span>  <span class="number">9</span> * <span class="number">2</span> = <span class="number">18</span> <span class="number">9</span> * <span class="number">3</span> = <span class="number">27</span> <span class="number">9</span> * <span class="number">4</span> = <span class="number">36</span> <span class="number">9</span> * <span class="number">5</span> = <span class="number">45</span> <span class="number">9</span> * <span class="number">6</span> = <span class="number">54</span> <span class="number">9</span> * <span class="number">7</span> = <span class="number">63</span> <span class="number">9</span> * <span class="number">8</span> = <span class="number">72</span> <span class="number">9</span> * <span class="number">9</span> = <span class="number">81</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
