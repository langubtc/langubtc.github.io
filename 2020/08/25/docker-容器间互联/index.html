<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.roddypy.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta name="description" content="Docker容器互联常见使用方式为。–link参数 （后面会被废弃）参考出处：- https:&#x2F;&#x2F;docs.docker.com&#x2F;network&#x2F;links&#x2F; Warning: The –link flag is a legacy feature of Docker. It may eventually be removed. Unless you absolutely need to conti">
<meta property="og:type" content="article">
<meta property="og:title" content="docker 容器间互联">
<meta property="og:url" content="http://www.roddypy.com/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/index.html">
<meta property="og:site_name" content="普拉多VX">
<meta property="og:description" content="Docker容器互联常见使用方式为。–link参数 （后面会被废弃）参考出处：- https:&#x2F;&#x2F;docs.docker.com&#x2F;network&#x2F;links&#x2F; Warning: The –link flag is a legacy feature of Docker. It may eventually be removed. Unless you absolutely need to conti">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-25T03:45:15.000Z">
<meta property="article:modified_time" content="2020-08-25T05:00:23.097Z">
<meta property="article:author" content="Roddy">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.roddypy.com/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>docker 容器间互联 | 普拉多VX</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">普拉多VX</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">人生一路，不问来时，不知归期</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.roddypy.com/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roddy">
      <meta itemprop="description" content="认认真真做事，踏踏实实做人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="普拉多VX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker 容器间互联
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-08-25 11:45:15 / 修改时间：13:00:23" itemprop="dateCreated datePublished" datetime="2020-08-25T11:45:15+08:00">2020-08-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/" class="post-meta-item leancloud_visitors" data-flag-title="docker 容器间互联" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/08/25/docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%92%E8%81%94/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Docker容器互联"><a href="#Docker容器互联" class="headerlink" title="Docker容器互联"></a>Docker容器互联</h2><p>常见使用方式为。–link参数 （后面会被废弃）<br>参考出处：- <a href="https://docs.docker.com/network/links/" target="_blank" rel="noopener">https://docs.docker.com/network/links/</a></p>
<p>Warning: The –link flag is a legacy feature of Docker. It may eventually be removed. Unless you absolutely need to continue using it, we recommend that you use user-defined networks to facilitate communication between two containers instead of using –link. One feature that user-defined networks do not support that you can do with –link is sharing environment variables between containers. However, you can use other mechanisms such as volumes to share environment variables between containers in a more controlled way.</p>
<h2 id="样例："><a href="#样例：" class="headerlink" title="样例："></a>样例：</h2><p><strong>启动容器1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]<span class="comment"># docker run -dit -p 80:80 --name selfnginx nginx</span></span><br><span class="line">Unable to find image <span class="string">'nginx:latest'</span> locally</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">bf5952930446: Pull complete </span><br><span class="line">cb9a6de05e5a: Pull complete </span><br><span class="line">9513ea0afb93: Pull complete </span><br><span class="line">b49ea07d2e93: Pull complete </span><br><span class="line">a5e4a503d449: Pull complete </span><br><span class="line">Digest: sha256:b0ad43f7ee5edbc0effbc14645ae7055e21bc1973aee5150745632a24a752661</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">2cfcbd9bb76cfe8445c74e8d9cd8ae39f1fab1850242978cb059b15b527beb98</span><br></pre></td></tr></table></figure>

<p><strong>启动容器2</strong></p>
<p><em>–link 目标容器:映射的别名</em></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit --link selfnginx:web  alpine</span><br><span class="line">Unable to find image <span class="string">'alpine:latest'</span> locally</span><br><span class="line">latest: Pulling <span class="keyword">from</span> library/alpine</span><br><span class="line">df20fa9351a1: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">185518070891758909</span>c9f839cf4ca393ee977ac378609f700f60a771a2dfe321</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> alpine:latest</span><br><span class="line">f6f87a55368d38781f6d10ef27bd31acf7b05b62c38b283f55a1e7723489d4bf</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# </span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# </span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker ps  <span class="comment">//检查启动的容器</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                <span class="number">7</span> seconds ago       Up <span class="number">6</span> seconds                             elastic_yalow</span><br><span class="line"><span class="number">2</span>cfcbd9bb76c        nginx               <span class="string">"/docker-entrypoint.…"</span>   <span class="number">2</span> minutes ago       Up <span class="number">2</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">80</span>-&gt;<span class="number">80</span>/tcp   selfnginx</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure>



<p><strong>测试</strong></p>
<p>安装curl</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker exec -it f6f  sh    <span class="comment">//进入容器</span></span><br><span class="line">/ # </span><br><span class="line">/ # </span><br><span class="line">/ # apk add curl    <span class="comment">// 安装curl工具</span></span><br><span class="line">fetch http:<span class="comment">//dl-cdn.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz</span></span><br><span class="line">fetch http:<span class="comment">//dl-cdn.alpinelinux.org/alpine/v3.12/community/x86_64/APKINDEX.tar.gz</span></span><br><span class="line">(<span class="number">1</span>/<span class="number">4</span>) Installing ca-certificates (<span class="number">20191127</span>-r4)</span><br><span class="line">(<span class="number">2</span>/<span class="number">4</span>) Installing nghttp2-libs (<span class="number">1.41</span><span class="number">.0</span>-r0)</span><br><span class="line">(<span class="number">3</span>/<span class="number">4</span>) Installing libcurl (<span class="number">7.69</span><span class="number">.1</span>-r0)</span><br><span class="line">(<span class="number">4</span>/<span class="number">4</span>) Installing curl (<span class="number">7.69</span><span class="number">.1</span>-r0)</span><br><span class="line">Executing busybox<span class="number">-1.31</span><span class="number">.1</span>-r16.trigger</span><br><span class="line">Executing ca-certificates<span class="number">-20191127</span>-r4.trigger</span><br><span class="line">OK: <span class="number">7</span> MiB <span class="keyword">in</span> <span class="number">18</span> packages</span><br></pre></td></tr></table></figure>

<p>ping 测试。ping web // web表示–link 容器使用的别名</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/ #<span class="built_in"> ping </span>web</span><br><span class="line">PING web (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.067 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.066 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.064 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.17.0.2: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.066 ms</span><br><span class="line">^C</span><br><span class="line">--- web<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.064/0.065/0.067 ms</span><br></pre></td></tr></table></figure>

<p>curl 测试</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/ # curl web</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/"</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.com/"</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>

<p>–link 连接会在/etc/hosts文件中添加关系映射</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/ # cat /etc/hosts </span><br><span class="line"><span class="number">127.0.0.1</span>       localhost</span><br><span class="line">::<span class="number">1</span>     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span> ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span> ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span> ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span> ip6-allrouters</span><br><span class="line"><span class="number">172.17.0.2</span>      web 2cfcbd9bb76c selfnginx</span><br><span class="line"><span class="number">172.17.0.3</span>      f6f87a55368d</span><br></pre></td></tr></table></figure>

<h2 id="容器互联-自定义网络）"><a href="#容器互联-自定义网络）" class="headerlink" title="容器互联 (自定义网络）"></a>容器互联 (自定义网络）</h2><ul>
<li>用户定义的网桥可在容器之间提供自动DNS解析。<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">缺省桥接网络上的容器只能通过<span class="built_in">IP</span>地址相互访问，除非您使用被认为是传统的--link选项。在用户定义的网桥网络上，容器可以通过名称或别名相互解析。</span><br><span class="line"></span><br><span class="line">想象一个具有Web前端和数据库后端的应用程序。如果调用容器web和<span class="built_in">db</span>，则<span class="built_in">db</span>无论应用程序堆栈在哪个Docker主机上运行，Web容器都可以通过连接到<span class="built_in">db</span>容器。</span><br><span class="line"></span><br><span class="line">如果在默认网桥网络上运行相同的应用程序堆栈，则需要在容器之间手动创建链接（使用旧式--link 标志）。这些链接需要双向创建，因此您可以看到，要进行通信的容器超过两个，这将变得很复杂。或者，您可以操作/etc/hosts容器中的文件，但这会产生难以调试的问题。</span><br></pre></td></tr></table></figure></li>
<li>用户定义的桥可提供更好的隔离。<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">所有未<span class="comment">--network指定的容器都将连接到默认网桥网络。这可能是一种风险，因为不相关的堆栈/服务/容器随后能够进行通信。</span></span><br><span class="line"></span><br><span class="line">使用用户定义的网络可提供作用域网络，其中只有连接到该网络的容器才能通信。</span><br></pre></td></tr></table></figure></li>
<li>容器可以随时随地从用户定义的网络连接和分离。<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在容器的生存期内，您可以即时将其与用户定义的网络连接或断开连接。要从默认桥接网络中删除容器，您需要停止容器并使用其他网络选项重新创建它。</span><br><span class="line"></span><br><span class="line">每个用户定义的网络都会创建一个可配置的网桥。</span><br><span class="line"></span><br><span class="line">如果您的容器使用默认的桥接网络，则可以对其进行配置，但是所有容器都使用相同的设置，例如MTU和iptables规则。另外，配置默认桥接网络发生在Docker本身之外，并且需要重新启动Docker。</span><br><span class="line"></span><br><span class="line">用户定义的桥接网络是使用创建和配置的 docker<span class="built_in"> network </span>create。如果不同的应用程序组具有不同的网络要求，则可以在创建时分别配置每个用户定义的网桥。</span><br></pre></td></tr></table></figure></li>
<li>默认网桥网络上的链接容器共享环境变量。<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">最初，在两个容器之间共享环境变量的唯一方法是使用<span class="comment">--linkflag链接它们。用户定义的网络无法进行这种类型的变量共享。但是，存在共享环境变量的高级方法。一些想法：</span></span><br><span class="line"></span><br><span class="line">多个容器可以使用Docker卷挂载包含共享信息的文件或目录。</span><br><span class="line"></span><br><span class="line">可以使用一起启动多个容器docker-compose，并且compose文件可以定义共享变量。</span><br><span class="line"></span><br><span class="line">您可以使用群体服务来代替独立容器，并利用共享机密和 配置。</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>创建自定义网络</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># docker network create my-net</span></span><br><span class="line">[root<span class="symbol">@iZ2zedqqdtca3xspuss20zZ</span> ~]<span class="meta"># docker network ls    //列出当前所有网络</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">cd68d9fe5349        bridge              bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">995338</span>bf73a4        harbor_harbor       bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">683</span>eaf141ac7        host                host                <span class="keyword">local</span></span><br><span class="line"><span class="number">244</span>fc6228c1a        my-net              bridge              <span class="keyword">local</span></span><br><span class="line">c5dd972001d9        none                <span class="literal">null</span>                <span class="keyword">local</span></span><br></pre></td></tr></table></figure>

<p>创建容器并连接到自定义网络中</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit -p <span class="number">8000</span>:<span class="number">80</span> --name netnginx  --network my-net nginx</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker run -dit --name testping --network my-net alpine</span><br></pre></td></tr></table></figure>

<p>检查启动容器</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                <span class="number">4</span> minutes ago       Up <span class="number">4</span> minutes                               testping</span><br><span class="line"><span class="number">6f</span>0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   <span class="number">6</span> minutes ago       Up <span class="number">6</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span>-&gt;<span class="number">80</span>/tcp   netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                <span class="number">32</span> minutes ago      Up <span class="number">32</span> minutes                              elastic_yalow</span><br><span class="line">[<span class="symbol">root@</span>iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure>

<p>容器只要连接到同一个网络中，那会自动</p>
<h3 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h3><p>将已经运行的容器连接到自定义网络</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>connect my-net elastic_yalow</span><br></pre></td></tr></table></figure>

<p>参看容器详情发现会有两个网络</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">"Networks": &#123;</span><br><span class="line">    "bridge": &#123;</span><br><span class="line">        "IPAMConfig": null,</span><br><span class="line">        "Links": null,</span><br><span class="line">        "Aliases": null,</span><br><span class="line">        "NetworkID": "cd68d9fe5349d9962d48e78d1f8d2e2c4e36a7a038104bd2fa9bca7ea1526c66",</span><br><span class="line">        "EndpointID": "865d76e5ea4a11abe73110c6d6c22f65f014c36c4bdd2a478b8ae422464fc912",</span><br><span class="line">        "Gateway": "172.17.0.1",</span><br><span class="line">        "IPAddress": "172.17.0.3",</span><br><span class="line">        "IPPrefixLen": 16,</span><br><span class="line">        "IPv6Gateway": "",</span><br><span class="line">        "GlobalIPv6Address": "",</span><br><span class="line">        "GlobalIPv6PrefixLen": 0,</span><br><span class="line">        "MacAddress": "02:42:ac:11:00:03",</span><br><span class="line">        "DriverOpts": null</span><br><span class="line">    &#125;,</span><br><span class="line">    "my-net": &#123;</span><br><span class="line">        "IPAMConfig": &#123;&#125;,</span><br><span class="line">        "Links": null,</span><br><span class="line">        "Aliases": [</span><br><span class="line">            <span class="string">"f6f87a55368d"</span></span><br><span class="line">        ],</span><br><span class="line">        "NetworkID": "244fc6228c1adddd45eecac66c7e0652171ddf293750c03ea3ff53946098da4a",</span><br><span class="line">        "EndpointID": "6ebff1aa65af5ed4b0172164b4dd101934e6d73cc6381886f23f88ed0d453377",</span><br><span class="line">        "Gateway": "172.20.0.1",</span><br><span class="line">        "IPAddress": "172.20.0.4",</span><br><span class="line">        "IPPrefixLen": 16,</span><br><span class="line">        "IPv6Gateway": "",</span><br><span class="line">        "GlobalIPv6Address": "",</span><br><span class="line">        "GlobalIPv6PrefixLen": 0,</span><br><span class="line">        "MacAddress": "02:42:ac:14:00:04",</span><br><span class="line">        "DriverOpts": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>断开容器网络</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>disconnect my-net elastic_yalow</span><br></pre></td></tr></table></figure>


<p><strong><em>如果断开只有一个网络的容器会发生什么？</em></strong></p>
<p>创建netnginx指定了使用自定义网络，如果断开他唯一的网络后，那该容器会是一个没有网卡状态。同时容器暴露的端口将会被取消，直到重新加入网络后恢复。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>disconnect my-net netnginx</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                17 minutes ago      Up 17 minutes                           testping</span><br><span class="line">6f0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   18 minutes ago      Up 18 minutes                           netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                44 minutes ago      Up 44 minutes                           elastic_yalow</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker<span class="built_in"> network </span>connect my-net netnginx</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">f146229807ba        alpine              <span class="string">"/bin/sh"</span>                17 minutes ago      Up 17 minutes                              testping</span><br><span class="line">6f0dd91d3f40        nginx               <span class="string">"/docker-entrypoint.…"</span>   18 minutes ago      Up 18 minutes       0.0.0.0:8000-&gt;80/tcp   netnginx</span><br><span class="line">f6f87a55368d        alpine              <span class="string">"/bin/sh"</span>                45 minutes ago      Up 45 minutes                              elastic_yalow</span><br><span class="line">[root@iZ2zedqqdtca3xspuss20zZ ~]#</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://docs.docker.com/network/bridge/#differences-between-user-defined-bridges-and-the-default-bridge" target="_blank" rel="noopener">https://docs.docker.com/network/bridge/#differences-between-user-defined-bridges-and-the-default-bridge</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/20/Harbor%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/" rel="prev" title="Harbor私有仓库部署">
      <i class="fa fa-chevron-left"></i> Harbor私有仓库部署
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/28/docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%9B%86/" rel="next" title="docker 常用命令集">
      docker 常用命令集 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker容器互联"><span class="nav-number">1.</span> <span class="nav-text">Docker容器互联</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#样例："><span class="nav-number">2.</span> <span class="nav-text">样例：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器互联-自定义网络）"><span class="nav-number">3.</span> <span class="nav-text">容器互联 (自定义网络）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用法"><span class="nav-number">3.1.</span> <span class="nav-text">用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他用法"><span class="nav-number">3.2.</span> <span class="nav-text">其他用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考资料"><span class="nav-number">3.3.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Roddy</p>
  <div class="site-description" itemprop="description">认认真真做事，踏踏实实做人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/langubtc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;langubtc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:923401910@qq.com" title="E-Mail → mailto:923401910@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友链
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.liwenzhou.com/" title="https:&#x2F;&#x2F;www.liwenzhou.com" rel="noopener" target="_blank">李文周</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.rainbowei.com/" title="http:&#x2F;&#x2F;www.rainbowei.com" rel="noopener" target="_blank">孙科伟</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://xiaorui.cc/" title="http:&#x2F;&#x2F;xiaorui.cc" rel="noopener" target="_blank">丙峰云</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.simlinux.com/" title="http:&#x2F;&#x2F;www.simlinux.com" rel="noopener" target="_blank">Geekwolf</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ttxsgoto.github.io/" title="https:&#x2F;&#x2F;ttxsgoto.github.io" rel="noopener" target="_blank">钟强博客</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roddy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?547d989a7055abbbc8faf5fc9e5fb90a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'OkYu0hJfOxyBXYDjgnYWA3m2-gzGzoHsz',
      appKey     : 'z3bkXuLWL3R5uos7A5zbBsUV',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
